/* esm.sh - esbuild bundle(@supabase/supabase-js@2.21.0) deno production */
import{FunctionsClient as D}from"/v117/@supabase/functions-js@2.1.1/deno/functions-js.mjs";import{PostgrestClient as j}from"/v117/@supabase/postgrest-js@1.6.0/deno/postgrest-js.mjs";import{RealtimeClient as L}from"/v117/@supabase/realtime-js@2.7.2/deno/realtime-js.mjs";import{StorageClient as I}from"/v117/@supabase/storage-js@2.5.1/deno/storage-js.mjs";var x="2.21.0";var _={"X-Client-Info":`supabase-js/${x}`};import S,{Headers as y}from"/v117/cross-fetch@3.1.5/deno/cross-fetch.mjs";var E=function(o,t,e,s){function l(n){return n instanceof e?n:new e(function(i){i(n)})}return new(e||(e=Promise))(function(n,i){function h(a){try{r(s.next(a))}catch(u){i(u)}}function c(a){try{r(s.throw(a))}catch(u){i(u)}}function r(a){a.done?n(a.value):l(a.value).then(h,c)}r((s=s.apply(o,t||[])).next())})},w=o=>{let t;return o?t=o:typeof fetch>"u"?t=S:t=fetch,(...e)=>t(...e)},U=()=>typeof Headers>"u"?y:Headers,v=(o,t,e)=>{let s=w(e),l=U();return(n,i)=>E(void 0,void 0,void 0,function*(){var h;let c=(h=yield t())!==null&&h!==void 0?h:o,r=new l(i?.headers);return r.has("apikey")||r.set("apikey",o),r.has("Authorization")||r.set("Authorization",`Bearer ${c}`),s(n,Object.assign(Object.assign({},i),{headers:r}))})};function b(o){return o.replace(/\/$/,"")}function O(o,t){let{db:e,auth:s,realtime:l,global:n}=o,{db:i,auth:h,realtime:c,global:r}=t;return{db:Object.assign(Object.assign({},i),e),auth:Object.assign(Object.assign({},h),s),realtime:Object.assign(Object.assign({},c),l),global:Object.assign(Object.assign({},r),n)}}import{GoTrueClient as C}from"/v117/@supabase/gotrue-js@2.23.0/deno/gotrue-js.mjs";var m=class extends C{constructor(t){super(t)}};var F=function(o,t,e,s){function l(n){return n instanceof e?n:new e(function(i){i(n)})}return new(e||(e=Promise))(function(n,i){function h(a){try{r(s.next(a))}catch(u){i(u)}}function c(a){try{r(s.throw(a))}catch(u){i(u)}}function r(a){a.done?n(a.value):l(a.value).then(h,c)}r((s=s.apply(o,t||[])).next())})},$={headers:_},H={schema:"public"},N={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},R={},p=class{constructor(t,e,s){var l,n,i,h,c,r,a,u;if(this.supabaseUrl=t,this.supabaseKey=e,!t)throw new Error("supabaseUrl is required.");if(!e)throw new Error("supabaseKey is required.");let d=b(t);if(this.realtimeUrl=`${d}/realtime/v1`.replace(/^http/i,"ws"),this.authUrl=`${d}/auth/v1`,this.storageUrl=`${d}/storage/v1`,d.match(/(supabase\.co)|(supabase\.in)/)){let g=d.split(".");this.functionsUrl=`${g[0]}.functions.${g[1]}.${g[2]}`}else this.functionsUrl=`${d}/functions/v1`;let T=`sb-${new URL(this.authUrl).hostname.split(".")[0]}-auth-token`,A={db:H,realtime:R,auth:Object.assign(Object.assign({},N),{storageKey:T}),global:$},f=O(s??{},A);this.storageKey=(n=(l=f.auth)===null||l===void 0?void 0:l.storageKey)!==null&&n!==void 0?n:"",this.headers=(h=(i=f.global)===null||i===void 0?void 0:i.headers)!==null&&h!==void 0?h:{},this.auth=this._initSupabaseAuthClient((c=f.auth)!==null&&c!==void 0?c:{},this.headers,(r=f.global)===null||r===void 0?void 0:r.fetch),this.fetch=v(e,this._getAccessToken.bind(this),(a=f.global)===null||a===void 0?void 0:a.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers},f.realtime)),this.rest=new j(`${d}/rest/v1`,{headers:this.headers,schema:(u=f.db)===null||u===void 0?void 0:u.schema,fetch:this.fetch}),this._listenForAuthEvents()}get functions(){return new D(this.functionsUrl,{headers:this.headers,customFetch:this.fetch})}get storage(){return new I(this.storageUrl,this.headers,this.fetch)}from(t){return this.rest.from(t)}rpc(t,e={},s){return this.rest.rpc(t,e,s)}channel(t,e={config:{}}){return this.realtime.channel(t,e)}getChannels(){return this.realtime.getChannels()}removeChannel(t){return this.realtime.removeChannel(t)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var t,e;return F(this,void 0,void 0,function*(){let{data:s}=yield this.auth.getSession();return(e=(t=s.session)===null||t===void 0?void 0:t.access_token)!==null&&e!==void 0?e:null})}_initSupabaseAuthClient({autoRefreshToken:t,persistSession:e,detectSessionInUrl:s,storage:l,storageKey:n,flowType:i},h,c){let r={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new m({url:this.authUrl,headers:Object.assign(Object.assign({},r),h),storageKey:n,autoRefreshToken:t,persistSession:e,detectSessionInUrl:s,storage:l,flowType:i,fetch:c})}_initRealtimeClient(t){return new L(this.realtimeUrl,Object.assign(Object.assign({},t),{params:Object.assign({apikey:this.supabaseKey},t?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((e,s)=>{this._handleTokenChanged(e,s?.access_token,"CLIENT")})}_handleTokenChanged(t,e,s){(t==="TOKEN_REFRESHED"||t==="SIGNED_IN")&&this.changedAccessToken!==e?(this.realtime.setAuth(e??null),this.changedAccessToken=e):t==="SIGNED_OUT"&&(this.realtime.setAuth(this.supabaseKey),s=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}};export*from"/v117/@supabase/gotrue-js@2.23.0/deno/gotrue-js.mjs";import{FunctionsHttpError as ht,FunctionsFetchError as lt,FunctionsRelayError as ct,FunctionsError as ut}from"/v117/@supabase/functions-js@2.1.1/deno/functions-js.mjs";export*from"/v117/@supabase/realtime-js@2.7.2/deno/realtime-js.mjs";var nt=(o,t,e)=>new p(o,t,e);export{ut as FunctionsError,lt as FunctionsFetchError,ht as FunctionsHttpError,ct as FunctionsRelayError,p as SupabaseClient,nt as createClient};
//# sourceMappingURL=supabase-js.mjs.map