/* esm.sh - esbuild bundle(@supabase/storage-js@2.4.0) deno production */
var _=class extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}};function l(o){return typeof o=="object"&&o!==null&&"__isStorageError"in o}var $=class extends _{constructor(e,t){super(e),this.name="StorageApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}},y=class extends _{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}};var T=function(o,e,t,r){function i(n){return n instanceof t?n:new t(function(s){s(n)})}return new(t||(t=Promise))(function(n,s){function u(a){try{d(r.next(a))}catch(h){s(h)}}function c(a){try{d(r.throw(a))}catch(h){s(h)}}function d(a){a.done?n(a.value):i(a.value).then(u,c)}d((r=r.apply(o,e||[])).next())})},x=o=>{let e;return o?e=o:typeof fetch>"u"?e=(...t)=>T(void 0,void 0,void 0,function*(){return yield(yield import("/v114/cross-fetch@3.1.5/deno/cross-fetch.mjs")).fetch(...t)}):e=fetch,(...t)=>e(...t)},k=()=>T(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield import("/v114/cross-fetch@3.1.5/deno/cross-fetch.mjs")).Response:Response});var v=function(o,e,t,r){function i(n){return n instanceof t?n:new t(function(s){s(n)})}return new(t||(t=Promise))(function(n,s){function u(a){try{d(r.next(a))}catch(h){s(h)}}function c(a){try{d(r.throw(a))}catch(h){s(h)}}function d(a){a.done?n(a.value):i(a.value).then(u,c)}d((r=r.apply(o,e||[])).next())})},S=o=>o.msg||o.message||o.error_description||o.error||JSON.stringify(o),I=(o,e)=>v(void 0,void 0,void 0,function*(){let t=yield k();o instanceof t?o.json().then(r=>{e(new $(S(r),o.status||500))}).catch(r=>{e(new y(S(r),r))}):e(new y(S(o),o))}),P=(o,e,t,r)=>{let i={method:o,headers:e?.headers||{}};return o==="GET"?i:(i.headers=Object.assign({"Content-Type":"application/json"},e?.headers),i.body=JSON.stringify(r),Object.assign(Object.assign({},i),t))};function O(o,e,t,r,i,n){return v(this,void 0,void 0,function*(){return new Promise((s,u)=>{o(t,P(e,r,i,n)).then(c=>{if(!c.ok)throw c;return r?.noResolveJson?c:c.json()}).then(c=>s(c)).catch(c=>I(c,u))})})}function w(o,e,t,r){return v(this,void 0,void 0,function*(){return O(o,"GET",e,t,r)})}function p(o,e,t,r,i){return v(this,void 0,void 0,function*(){return O(o,"POST",e,r,i,t)})}function U(o,e,t,r,i){return v(this,void 0,void 0,function*(){return O(o,"PUT",e,r,i,t)})}function j(o,e,t,r,i){return v(this,void 0,void 0,function*(){return O(o,"DELETE",e,r,i,t)})}var f=function(o,e,t,r){function i(n){return n instanceof t?n:new t(function(s){s(n)})}return new(t||(t=Promise))(function(n,s){function u(a){try{d(r.next(a))}catch(h){s(h)}}function c(a){try{d(r.throw(a))}catch(h){s(h)}}function d(a){a.done?n(a.value):i(a.value).then(u,c)}d((r=r.apply(o,e||[])).next())})},L={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},C={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1},g=class{constructor(e,t={},r,i){this.url=e,this.headers=t,this.bucketId=r,this.fetch=x(i)}uploadOrUpdate(e,t,r,i){return f(this,void 0,void 0,function*(){try{let n,s=Object.assign(Object.assign({},C),i),u=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(s.upsert)});typeof Blob<"u"&&r instanceof Blob?(n=new FormData,n.append("cacheControl",s.cacheControl),n.append("",r)):typeof FormData<"u"&&r instanceof FormData?(n=r,n.append("cacheControl",s.cacheControl)):(n=r,u["cache-control"]=`max-age=${s.cacheControl}`,u["content-type"]=s.contentType);let c=this._removeEmptyFolders(t),d=this._getFinalPath(c),a=yield this.fetch(`${this.url}/object/${d}`,Object.assign({method:e,body:n,headers:u},s?.duplex?{duplex:s.duplex}:{}));return a.ok?{data:{path:c},error:null}:{data:null,error:yield a.json()}}catch(n){if(l(n))return{data:null,error:n};throw n}})}upload(e,t,r){return f(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,r)})}update(e,t,r){return f(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,r)})}move(e,t){return f(this,void 0,void 0,function*(){try{return{data:yield p(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t},{headers:this.headers}),error:null}}catch(r){if(l(r))return{data:null,error:r};throw r}})}copy(e,t){return f(this,void 0,void 0,function*(){try{return{data:{path:(yield p(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t},{headers:this.headers})).Key},error:null}}catch(r){if(l(r))return{data:null,error:r};throw r}})}createSignedUrl(e,t,r){return f(this,void 0,void 0,function*(){try{let i=this._getFinalPath(e),n=yield p(this.fetch,`${this.url}/object/sign/${i}`,Object.assign({expiresIn:t},r?.transform?{transform:r.transform}:{}),{headers:this.headers}),s=r?.download?`&download=${r.download===!0?"":r.download}`:"";return n={signedUrl:encodeURI(`${this.url}${n.signedURL}${s}`)},{data:n,error:null}}catch(i){if(l(i))return{data:null,error:i};throw i}})}createSignedUrls(e,t,r){return f(this,void 0,void 0,function*(){try{let i=yield p(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),n=r?.download?`&download=${r.download===!0?"":r.download}`:"";return{data:i.map(s=>Object.assign(Object.assign({},s),{signedUrl:s.signedURL?encodeURI(`${this.url}${s.signedURL}${n}`):null})),error:null}}catch(i){if(l(i))return{data:null,error:i};throw i}})}download(e,t){return f(this,void 0,void 0,function*(){let i=typeof t?.transform<"u"?"render/image/authenticated":"object",n=this.transformOptsToQueryString(t?.transform||{}),s=n?`?${n}`:"";try{let u=this._getFinalPath(e);return{data:yield(yield w(this.fetch,`${this.url}/${i}/${u}${s}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(u){if(l(u))return{data:null,error:u};throw u}})}getPublicUrl(e,t){let r=this._getFinalPath(e),i=[],n=t?.download?`download=${t.download===!0?"":t.download}`:"";n!==""&&i.push(n);let u=typeof t?.transform<"u"?"render/image":"object",c=this.transformOptsToQueryString(t?.transform||{});c!==""&&i.push(c);let d=i.join("&");return d!==""&&(d=`?${d}`),{data:{publicUrl:encodeURI(`${this.url}/${u}/public/${r}${d}`)}}}remove(e){return f(this,void 0,void 0,function*(){try{return{data:yield j(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(l(t))return{data:null,error:t};throw t}})}list(e,t,r){return f(this,void 0,void 0,function*(){try{let i=Object.assign(Object.assign(Object.assign({},L),t),{prefix:e||""});return{data:yield p(this.fetch,`${this.url}/object/list/${this.bucketId}`,i,{headers:this.headers},r),error:null}}catch(i){if(l(i))return{data:null,error:i};throw i}})}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){let t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}};var R="2.4.0";var F={"X-Client-Info":`storage-js/${R}`};var m=function(o,e,t,r){function i(n){return n instanceof t?n:new t(function(s){s(n)})}return new(t||(t=Promise))(function(n,s){function u(a){try{d(r.next(a))}catch(h){s(h)}}function c(a){try{d(r.throw(a))}catch(h){s(h)}}function d(a){a.done?n(a.value):i(a.value).then(u,c)}d((r=r.apply(o,e||[])).next())})},b=class{constructor(e,t={},r){this.url=e,this.headers=Object.assign(Object.assign({},F),t),this.fetch=x(r)}listBuckets(){return m(this,void 0,void 0,function*(){try{return{data:yield w(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(l(e))return{data:null,error:e};throw e}})}getBucket(e){return m(this,void 0,void 0,function*(){try{return{data:yield w(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(l(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return m(this,void 0,void 0,function*(){try{return{data:yield p(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(l(r))return{data:null,error:r};throw r}})}updateBucket(e,t){return m(this,void 0,void 0,function*(){try{return{data:yield U(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(l(r))return{data:null,error:r};throw r}})}emptyBucket(e){return m(this,void 0,void 0,function*(){try{return{data:yield p(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(l(t))return{data:null,error:t};throw t}})}deleteBucket(e){return m(this,void 0,void 0,function*(){try{return{data:yield j(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(l(t))return{data:null,error:t};throw t}})}};var E=class extends b{constructor(e,t={},r){super(e,t,r)}from(e){return new g(this.url,this.headers,e,this.fetch)}};export{$ as StorageApiError,E as StorageClient,_ as StorageError,y as StorageUnknownError,l as isStorageError};
//# sourceMappingURL=storage-js.mjs.map