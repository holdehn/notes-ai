/* esm.sh - esbuild bundle(sharp@0.32.1) deno production */
import __Process$ from "https://deno.land/std@0.177.0/node/process.ts";import  { Buffer as __Buffer$ } from "https://deno.land/std@0.177.0/node/buffer.ts";import * as _1$ from "/v124/semver@7.5.1/deno/functions/gte.js";const __1$ = _1$.default??_1$;import * as _2$ from "/v124/semver@7.5.1/deno/functions/coerce.js";const __2$ = _2$.default??_2$;import __3$ from "https://deno.land/std@0.177.0/node/child_process.ts";import __4$ from "https://deno.land/std@0.177.0/node/os.ts";import __5$ from "https://deno.land/std@0.177.0/node/stream.ts";import __6$ from "https://deno.land/std@0.177.0/node/util.ts";import * as _7$ from "/v124/detect-libc@2.0.1/deno/detect-libc.mjs";const __7$ = _7$.default??_7$;import __8$ from "https://deno.land/std@0.177.0/node/events.ts";import __9$ from "https://deno.land/std@0.177.0/node/path.ts";import __a$ from "https://deno.land/std@0.177.0/node/fs.ts";import * as _b$ from "/v124/color@4.2.3/deno/color.mjs";const __b$ = _b$.default??_b$;var Ye=Object.create;var C=Object.defineProperty;var Ke=Object.getOwnPropertyDescriptor;var Ze=Object.getOwnPropertyNames;var Oe=Object.getPrototypeOf,er=Object.prototype.hasOwnProperty;var h=(e=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(e,{get:(r,t)=>(typeof require<"u"?require:r)[t]}):e)(function(e){if(typeof require<"u")return require.apply(this,arguments);throw new Error('Dynamic require of "'+e+'" is not supported')});var d=(e,r)=>()=>(r||e((r={exports:{}}).exports,r),r.exports),rr=(e,r)=>{for(var t in r)C(e,t,{get:r[t],enumerable:!0})},R=(e,r,t,o)=>{if(r&&typeof r=="object"||typeof r=="function")for(let l of Ze(r))!er.call(e,l)&&l!==t&&C(e,l,{get:()=>r[l],enumerable:!(o=Ke(r,l))||o.enumerable});return e},P=(e,r,t)=>(R(e,r,"default"),t&&R(t,r,"default")),ee=(e,r,t)=>(t=e!=null?Ye(Oe(e)):{},R(r||!e||!e.__esModule?C(t,"default",{value:e,enumerable:!0}):t,e));var m=d((nt,ie)=>{"use strict";var re=function(e){return typeof e<"u"&&e!==null},ir=function(e){return typeof e=="object"},tr=function(e){return Object.prototype.toString.call(e)==="[object Object]"},nr=function(e){return typeof e=="function"},ar=function(e){return typeof e=="boolean"},or=function(e){return e instanceof __Buffer$},sr=function(e){if(re(e))switch(e.constructor){case Uint8Array:case Uint8ClampedArray:case Int8Array:case Uint16Array:case Int16Array:case Uint32Array:case Int32Array:case Float32Array:case Float64Array:return!0}return!1},lr=function(e){return e instanceof ArrayBuffer},fr=function(e){return typeof e=="string"&&e.length>0},hr=function(e){return typeof e=="number"&&!Number.isNaN(e)},dr=function(e){return Number.isInteger(e)},cr=function(e,r,t){return e>=r&&e<=t},ur=function(e,r){return r.includes(e)},mr=function(e,r,t){return new Error(`Expected ${r} for ${e} but received ${t} of type ${typeof t}`)};ie.exports={defined:re,object:ir,plainObject:tr,fn:nr,bool:ar,buffer:or,typedArray:sr,arrayBuffer:lr,string:fr,number:hr,integer:dr,inRange:cr,inArray:ur,invalidParameterError:mr}});var _=d((at,te)=>{"use strict";var z=__7$,B=__Process$.env;te.exports=function(){let e=B.npm_config_arch||__Process$.arch,r=B.npm_config_platform||__Process$.platform,t=__Process$.env.npm_config_libc||(z.isNonGlibcLinuxSync()?z.familySync():""),o=r!=="linux"||t===z.GLIBC?"":t,l=[`${r}${o}`];if(e==="arm"){let u=__Process$.versions.electron?"7":"6";l.push(`armv${B.npm_config_arm_version||__Process$.config.variables.arm_version||u}`)}else e==="arm64"?l.push(`arm64v${B.npm_config_arm_version||"8"}`):l.push(e);return l.join("-")}});var L=d((ot,gr)=>{gr.exports={name:"sharp",description:"High performance Node.js image processing, the fastest module to resize JPEG, PNG, WebP, GIF, AVIF and TIFF images",version:"0.32.1",author:"Lovell Fuller <npm@lovell.info>",homepage:"https://github.com/lovell/sharp",contributors:["Pierre Inglebert <pierre.inglebert@gmail.com>","Jonathan Ong <jonathanrichardong@gmail.com>","Chanon Sajjamanochai <chanon.s@gmail.com>","Juliano Julio <julianojulio@gmail.com>","Daniel Gasienica <daniel@gasienica.ch>","Julian Walker <julian@fiftythree.com>","Amit Pitaru <pitaru.amit@gmail.com>","Brandon Aaron <hello.brandon@aaron.sh>","Andreas Lind <andreas@one.com>","Maurus Cuelenaere <mcuelenaere@gmail.com>","Linus Unneb\xE4ck <linus@folkdatorn.se>","Victor Mateevitsi <mvictoras@gmail.com>","Alaric Holloway <alaric.holloway@gmail.com>","Bernhard K. Weisshuhn <bkw@codingforce.com>","Chris Riley <criley@primedia.com>","David Carley <dacarley@gmail.com>","John Tobin <john@limelightmobileinc.com>","Kenton Gray <kentongray@gmail.com>","Felix B\xFCnemann <Felix.Buenemann@gmail.com>","Samy Al Zahrani <samyalzahrany@gmail.com>","Chintan Thakkar <lemnisk8@gmail.com>","F. Orlando Galashan <frulo@gmx.de>","Kleis Auke Wolthuizen <info@kleisauke.nl>","Matt Hirsch <mhirsch@media.mit.edu>","Matthias Thoemmes <thoemmes@gmail.com>","Patrick Paskaris <patrick@paskaris.gr>","J\xE9r\xE9my Lal <kapouer@melix.org>","Rahul Nanwani <r.nanwani@gmail.com>","Alice Monday <alice0meta@gmail.com>","Kristo Jorgenson <kristo.jorgenson@gmail.com>","YvesBos <yves_bos@outlook.com>","Guy Maliar <guy@tailorbrands.com>","Nicolas Coden <nicolas@ncoden.fr>","Matt Parrish <matt.r.parrish@gmail.com>","Marcel Bretschneider <marcel.bretschneider@gmail.com>","Matthew McEachen <matthew+github@mceachen.org>","Jarda Kot\u011B\u0161ovec <jarda.kotesovec@gmail.com>","Kenric D'Souza <kenric.dsouza@gmail.com>","Oleh Aleinyk <oleg.aleynik@gmail.com>","Marcel Bretschneider <marcel.bretschneider@gmail.com>","Andrea Bianco <andrea.bianco@unibas.ch>","Rik Heywood <rik@rik.org>","Thomas Parisot <hi@oncletom.io>","Nathan Graves <nathanrgraves+github@gmail.com>","Tom Lokhorst <tom@lokhorst.eu>","Espen Hovlandsdal <espen@hovlandsdal.com>","Sylvain Dumont <sylvain.dumont35@gmail.com>","Alun Davies <alun.owain.davies@googlemail.com>","Aidan Hoolachan <ajhoolachan21@gmail.com>","Axel Eirola <axel.eirola@iki.fi>","Freezy <freezy@xbmc.org>","Daiz <taneli.vatanen@gmail.com>","Julian Aubourg <j@ubourg.net>","Keith Belovay <keith@picthrive.com>","Michael B. Klein <mbklein@gmail.com>","Jordan Prudhomme <jordan@raboland.fr>","Ilya Ovdin <iovdin@gmail.com>","Andargor <andargor@yahoo.com>","Paul Neave <paul.neave@gmail.com>","Brendan Kennedy <brenwken@gmail.com>","Brychan Bennett-Odlum <git@brychan.io>","Edward Silverton <e.silverton@gmail.com>","Roman Malieiev <aromaleev@gmail.com>","Tomas Szabo <tomas.szabo@deftomat.com>","Robert O'Rourke <robert@o-rourke.org>","Guillermo Alfonso Varela Chouci\xF1o <guillevch@gmail.com>","Christian Flintrup <chr@gigahost.dk>","Manan Jadhav <manan@motionden.com>","Leon Radley <leon@radley.se>","alza54 <alza54@thiocod.in>","Jacob Smith <jacob@frende.me>","Michael Nutt <michael@nutt.im>","Brad Parham <baparham@gmail.com>","Taneli Vatanen <taneli.vatanen@gmail.com>","Joris Dugu\xE9 <zaruike10@gmail.com>","Chris Banks <christopher.bradley.banks@gmail.com>","Ompal Singh <ompal.hitm09@gmail.com>","Brodan <christopher.hranj@gmail.com","Ankur Parihar <ankur.github@gmail.com>","Brahim Ait elhaj <brahima@gmail.com>","Mart Jansink <m.jansink@gmail.com>","Lachlan Newman <lachnewman007@gmail.com>"],scripts:{install:"(node install/libvips && node install/dll-copy && prebuild-install) || (node install/can-compile && node-gyp rebuild && node install/dll-copy)",clean:"rm -rf node_modules/ build/ vendor/ .nyc_output/ coverage/ test/fixtures/output.*",test:"npm run test-lint && npm run test-unit && npm run test-licensing && npm run test-types","test-lint":"semistandard && cpplint","test-unit":"nyc --reporter=lcov --reporter=text --check-coverage --branches=100 mocha","test-licensing":'license-checker --production --summary --onlyAllow="Apache-2.0;BSD;ISC;MIT"',"test-leak":"./test/leak/leak.sh","test-types":"tsd","docs-build":"node docs/build && node docs/search-index/build","docs-serve":"cd docs && npx serve","docs-publish":"cd docs && npx firebase-tools deploy --project pixelplumbing --only hosting:pixelplumbing-sharp"},main:"lib/index.js",types:"lib/index.d.ts",files:["binding.gyp","install/**","lib/**","src/**"],repository:{type:"git",url:"git://github.com/lovell/sharp"},keywords:["jpeg","png","webp","avif","tiff","gif","svg","jp2","dzi","image","resize","thumbnail","crop","embed","libvips","vips"],dependencies:{color:"^4.2.3","detect-libc":"^2.0.1","node-addon-api":"^6.1.0","prebuild-install":"^7.1.1",semver:"^7.5.0","simple-get":"^4.0.1","tar-fs":"^2.1.1","tunnel-agent":"^0.6.0"},devDependencies:{"@types/node":"*",async:"^3.2.4",cc:"^3.0.1","exif-reader":"^1.2.0","extract-zip":"^2.0.1",icc:"^3.0.0","jsdoc-to-markdown":"^8.0.0","license-checker":"^25.0.1",mocha:"^10.2.0","mock-fs":"^5.2.0",nyc:"^15.1.0",prebuild:"^11.0.4",semistandard:"^16.0.1",tsd:"^0.28.1"},license:"Apache-2.0",config:{libvips:"8.14.2",integrity:{"darwin-arm64v8":"sha512-eUuxg6H0tXgX4z2lsaGtZ4cbPAm7yoFgkvPDd4csxoiVt+QUB25pEJwiXw7oB53VlBFIp3O8lbydSFS5zH8MQQ==","darwin-x64":"sha512-cMT4v76IgzSR0VoXqLk/yftRyzMEZ+SBVMLzXCgqP/lmnYisrpmHHNqrWnoZbUUBXbPXLn6KMultYOJHe/c9ZQ==","linux-arm64v8":"sha512-OcDJ/ly80pxwaKnw0W91sSvZczPtWsjmzrY/+6NMiQZT84LkmeaRuwErbHhorKDxnl7iZuNn9Uj5V25Xmj+LDQ==","linux-armv6":"sha512-hk2ohSOYTJEtVQxEQFyQ+tuayKpYqx6NiXa7AE+8MF+yscxt+g+mLJ7TjDqtmb4ttFGH4IVfsEfU2YXIqWqkpg==","linux-armv7":"sha512-/5Ci2Cd+yLZmTaEt9lVJ89elxX3RMJpps0ESjj43X40yrwka51QfXeg1QV38uNzZpCDIZkrbXZK0lyKldjpLuA==","linux-x64":"sha512-wjCKmWfBb0uz1UB7rPDLvO0s+VWuoAY/Vv/YGCRFEQUkdSLQUgHExrOMMbOM3FleuYfQqznDYCXXphkl7X44+w==","linuxmusl-arm64v8":"sha512-QtD2n90yi+rLE65C0gksFUU5uMUFPICI/pS3A0bgthpIcoCejAOYs3ZjVWpZbHQuV/lWahIUYO78MB9CzY860A==","linuxmusl-x64":"sha512-TokQ/ETCJAsPYuxIMOPYDp25rlcwtpmIMtRUR9PB75TmZEJe7abRfCEInIPYeD8F/HxxnJSLiEdlbn1z1Jfzng==","win32-arm64v8":"sha512-IIuj4EAgLqEVAoOuYH79C61a7TcJXlU/RBwk+5JsGWc2mr4J/Ar5J01e6XBvU4Lu3eqcU+3GPaACZEa1511buA==","win32-ia32":"sha512-CsZi7lrReX3B6tmYgOGJ0IiAfcN5APDC6l+3gdosxfTfwpLLO+jXaSmyNwIGeMqrdgckG/gwwc+IrUZmkmjJ/A==","win32-x64":"sha512-J7znmNKUK4ZKo6SnSnEtzT1xRAwvkGXxIx9/QihAadu1TFdS06yNhcENmwC4973+KZBlAdVpWbZ8sLrEoWkdCA=="},runtime:"napi",target:7},engines:{node:">=14.15.0"},funding:{url:"https://opencollective.com/libvips"},binary:{napi_versions:[7]},semistandard:{env:["mocha"]},cc:{linelength:"120",filter:["build/include"]},tsd:{directory:"test/types/"}}});var de=d((st,he)=>{"use strict";var F=__a$,br=__4$,I=__9$,T=__3$.spawnSync,wr=__2$,vr=__1$,yr=_(),{config:ne}=L(),v=__Process$.env,ae=v.npm_package_config_libvips||ne.libvips,D=wr(ae).version,W={encoding:"utf8",shell:!0},oe=I.join("/_virtual/v124/sharp@0.32.1/deno","..","vendor",D,yr()),M=function(e){try{F.mkdirSync(e,{recursive:!0})}catch(r){if(r.code!=="EEXIST")throw r}},pr=function(){let e=v.npm_config_cache||(v.APPDATA?I.join(v.APPDATA,"npm-cache"):I.join(br.homedir(),".npm"));M(e);let r=I.join(e,"_libvips");return M(r),r},Er=function(e){return v[`npm_package_config_integrity_${e.replace("-","_")}`]||ne.integrity[e]},se=function(e){e instanceof Error?console.error(`sharp: Installation error: ${e.message}`):console.log(`sharp: ${e}`)},Pr=function(){return __Process$.platform==="darwin"&&__Process$.arch==="x64"?(T("sysctl sysctl.proc_translated",W).stdout||"").trim()==="sysctl.proc_translated: 1":!1},le=function(){return __Process$.platform!=="win32"?(T("pkg-config --modversion vips-cpp",{...W,env:{...v,PKG_CONFIG_PATH:fe()}}).stdout||"").trim():""},xr=function(){return F.existsSync(oe)},jr=function(){F.rmSync(oe,{recursive:!0,maxRetries:3,force:!0})},fe=function(){return __Process$.platform!=="win32"?[(T('which brew >/dev/null 2>&1 && brew environment --plain | grep PKG_CONFIG_LIBDIR | cut -d" " -f2',W).stdout||"").trim(),v.PKG_CONFIG_PATH,"/usr/local/lib/pkgconfig","/usr/lib/pkgconfig","/usr/local/libdata/pkgconfig","/usr/libdata/pkgconfig"].filter(Boolean).join(":"):""},kr=function(){if(v.SHARP_IGNORE_GLOBAL_LIBVIPS)return!1;if(Pr())return se("Detected Rosetta, skipping search for globally-installed libvips"),!1;let e=le();return!!e&&vr(e,D)};he.exports={minimumLibvipsVersion:D,minimumLibvipsVersionLabelled:ae,cachePath:pr,integrity:Er,log:se,globalLibvipsVersion:le,hasVendoredLibvips:xr,removeVendoredLibvips:jr,pkgConfigPath:fe,useGlobalLibvips:kr,mkdirSync:M}});var j=d((lt,ce)=>{"use strict";var Q=_()();try{ce.exports=h(`../build/Release/sharp-${Q}.node`)}catch(e){let r=["",'Something went wrong installing the "sharp" module',"",e.message,"","Possible solutions:"];if(/dylib/.test(e.message)&&/Incompatible library version/.test(e.message))r.push('- Update Homebrew: "brew update && brew upgrade vips"');else{let[t,o]=Q.split("-");t==="linux"&&/Module did not self-register/.test(e.message)&&r.push("- Using worker threads? See https://sharp.pixelplumbing.com/install#worker-threads"),r.push('- Install with verbose logging and look for errors: "npm install --ignore-scripts=false --foreground-scripts --verbose sharp"',`- Install for the current ${Q} runtime: "npm install --platform=${t} --arch=${o} sharp"`)}if(r.push("- Consult the installation documentation: https://sharp.pixelplumbing.com/install"),__Process$.platform==="win32"||/symbol/.test(e.message)){let t=Object.keys(h.cache).find(o=>/[\\/]build[\\/]Release[\\/]sharp(.*)\.node$/.test(o));if(t){let[,o]=t.match(/node_modules[\\/]([^\\/]+)[\\/]/);r.push(`- Ensure the version of sharp aligns with the ${o} package: "npm ls sharp"`)}}throw new Error(r.join(`
`))}});var me=d((ht,ue)=>{"use strict";var Ar=__6$,U=__5$,Br=m();de().hasVendoredLibvips();j();var _r=Ar.debuglog("sharp"),p=function(e,r){if(arguments.length===1&&!Br.defined(e))throw new Error("Invalid input");return this instanceof p?(U.Duplex.call(this),this.options={topOffsetPre:-1,leftOffsetPre:-1,widthPre:-1,heightPre:-1,topOffsetPost:-1,leftOffsetPost:-1,widthPost:-1,heightPost:-1,width:-1,height:-1,canvas:"crop",position:0,resizeBackground:[0,0,0,255],useExifOrientation:!1,angle:0,rotationAngle:0,rotationBackground:[0,0,0,255],rotateBeforePreExtract:!1,flip:!1,flop:!1,extendTop:0,extendBottom:0,extendLeft:0,extendRight:0,extendBackground:[0,0,0,255],extendWith:"background",withoutEnlargement:!1,withoutReduction:!1,affineMatrix:[],affineBackground:[0,0,0,255],affineIdx:0,affineIdy:0,affineOdx:0,affineOdy:0,affineInterpolator:this.constructor.interpolators.bilinear,kernel:"lanczos3",fastShrinkOnLoad:!0,tintA:128,tintB:128,flatten:!1,flattenBackground:[0,0,0],unflatten:!1,negate:!1,negateAlpha:!0,medianSize:0,blurSigma:0,sharpenSigma:0,sharpenM1:1,sharpenM2:2,sharpenX1:2,sharpenY2:10,sharpenY3:20,threshold:0,thresholdGrayscale:!0,trimBackground:[],trimThreshold:0,gamma:0,gammaOut:0,greyscale:!1,normalise:!1,normaliseLower:1,normaliseUpper:99,claheWidth:0,claheHeight:0,claheMaxSlope:3,brightness:1,saturation:1,hue:0,lightness:0,booleanBufferIn:null,booleanFileIn:"",joinChannelIn:[],extractChannel:-1,removeAlpha:!1,ensureAlpha:-1,colourspace:"srgb",colourspaceInput:"last",composite:[],fileOut:"",formatOut:"input",streamOut:!1,withMetadata:!1,withMetadataOrientation:-1,withMetadataDensity:0,withMetadataIcc:"",withMetadataStrs:{},resolveWithObject:!1,jpegQuality:80,jpegProgressive:!1,jpegChromaSubsampling:"4:2:0",jpegTrellisQuantisation:!1,jpegOvershootDeringing:!1,jpegOptimiseScans:!1,jpegOptimiseCoding:!0,jpegQuantisationTable:0,pngProgressive:!1,pngCompressionLevel:6,pngAdaptiveFiltering:!1,pngPalette:!1,pngQuality:100,pngEffort:7,pngBitdepth:8,pngDither:1,jp2Quality:80,jp2TileHeight:512,jp2TileWidth:512,jp2Lossless:!1,jp2ChromaSubsampling:"4:4:4",webpQuality:80,webpAlphaQuality:100,webpLossless:!1,webpNearLossless:!1,webpSmartSubsample:!1,webpEffort:4,webpMinSize:!1,webpMixed:!1,gifBitdepth:8,gifEffort:7,gifDither:1,gifInterFrameMaxError:0,gifInterPaletteMaxError:3,gifReuse:!0,gifProgressive:!1,tiffQuality:80,tiffCompression:"jpeg",tiffPredictor:"horizontal",tiffPyramid:!1,tiffBitdepth:8,tiffTile:!1,tiffTileHeight:256,tiffTileWidth:256,tiffXres:1,tiffYres:1,tiffResolutionUnit:"inch",heifQuality:50,heifLossless:!1,heifCompression:"av1",heifEffort:4,heifChromaSubsampling:"4:4:4",jxlDistance:1,jxlDecodingTier:0,jxlEffort:7,jxlLossless:!1,rawDepth:"uchar",tileSize:256,tileOverlap:0,tileContainer:"fs",tileLayout:"dz",tileFormat:"last",tileDepth:"last",tileAngle:0,tileSkipBlanks:-1,tileBackground:[255,255,255,255],tileCentre:!1,tileId:"https://example.com/iiif",tileBasename:"",timeoutSeconds:0,linearA:[],linearB:[],debuglog:t=>{this.emit("warning",t),_r(t)},queueListener:function(t){p.queue.emit("change",t)}},this.options.input=this._createInputDescriptor(e,r,{allowStream:!0}),this):new p(e,r)};Object.setPrototypeOf(p.prototype,U.Duplex.prototype);Object.setPrototypeOf(p,U.Duplex);function Ir(){let e=this.constructor.call();return e.options=Object.assign({},this.options),this._isStreamInput()&&this.on("finish",()=>{this._flattenBufferIn(),e.options.bufferIn=this.options.bufferIn,e.emit("finish")}),e}Object.assign(p.prototype,{clone:Ir});ue.exports=p});var we=d((dt,be)=>{"use strict";var qr=__b$,a=m(),y=j(),Sr={left:"low",center:"centre",centre:"centre",right:"high"};function ge(e){let{raw:r,density:t,limitInputPixels:o,ignoreIcc:l,unlimited:u,sequentialRead:$,failOn:V,failOnError:X,animated:Y,page:K,pages:Z,subifd:O}=e;return[r,t,o,l,u,$,V,X,Y,K,Z,O].some(a.defined)?{raw:r,density:t,limitInputPixels:o,ignoreIcc:l,unlimited:u,sequentialRead:$,failOn:V,failOnError:X,animated:Y,page:K,pages:Z,subifd:O}:void 0}function Rr(e,r,t){let o={failOn:"warning",limitInputPixels:Math.pow(16383,2),ignoreIcc:!1,unlimited:!1,sequentialRead:!0};if(a.string(e))o.file=e;else if(a.buffer(e)){if(e.length===0)throw Error("Input Buffer is empty");o.buffer=e}else if(a.arrayBuffer(e)){if(e.byteLength===0)throw Error("Input bit Array is empty");o.buffer=__Buffer$.from(e,0,e.byteLength)}else if(a.typedArray(e)){if(e.length===0)throw Error("Input Bit Array is empty");o.buffer=__Buffer$.from(e.buffer,e.byteOffset,e.byteLength)}else if(a.plainObject(e)&&!a.defined(r))r=e,ge(r)&&(o.buffer=[]);else if(!a.defined(e)&&!a.defined(r)&&a.object(t)&&t.allowStream)o.buffer=[];else throw new Error(`Unsupported input '${e}' of type ${typeof e}${a.defined(r)?` when also providing options of type ${typeof r}`:""}`);if(a.object(r)){if(a.defined(r.failOnError))if(a.bool(r.failOnError))o.failOn=r.failOnError?"warning":"none";else throw a.invalidParameterError("failOnError","boolean",r.failOnError);if(a.defined(r.failOn))if(a.string(r.failOn)&&a.inArray(r.failOn,["none","truncated","error","warning"]))o.failOn=r.failOn;else throw a.invalidParameterError("failOn","one of: none, truncated, error, warning",r.failOn);if(a.defined(r.density))if(a.inRange(r.density,1,1e5))o.density=r.density;else throw a.invalidParameterError("density","number between 1 and 100000",r.density);if(a.defined(r.ignoreIcc))if(a.bool(r.ignoreIcc))o.ignoreIcc=r.ignoreIcc;else throw a.invalidParameterError("ignoreIcc","boolean",r.ignoreIcc);if(a.defined(r.limitInputPixels))if(a.bool(r.limitInputPixels))o.limitInputPixels=r.limitInputPixels?Math.pow(16383,2):0;else if(a.integer(r.limitInputPixels)&&a.inRange(r.limitInputPixels,0,Number.MAX_SAFE_INTEGER))o.limitInputPixels=r.limitInputPixels;else throw a.invalidParameterError("limitInputPixels","positive integer",r.limitInputPixels);if(a.defined(r.unlimited))if(a.bool(r.unlimited))o.unlimited=r.unlimited;else throw a.invalidParameterError("unlimited","boolean",r.unlimited);if(a.defined(r.sequentialRead))if(a.bool(r.sequentialRead))o.sequentialRead=r.sequentialRead;else throw a.invalidParameterError("sequentialRead","boolean",r.sequentialRead);if(a.defined(r.raw))if(a.object(r.raw)&&a.integer(r.raw.width)&&r.raw.width>0&&a.integer(r.raw.height)&&r.raw.height>0&&a.integer(r.raw.channels)&&a.inRange(r.raw.channels,1,4))switch(o.rawWidth=r.raw.width,o.rawHeight=r.raw.height,o.rawChannels=r.raw.channels,o.rawPremultiplied=!!r.raw.premultiplied,e.constructor){case Uint8Array:case Uint8ClampedArray:o.rawDepth="uchar";break;case Int8Array:o.rawDepth="char";break;case Uint16Array:o.rawDepth="ushort";break;case Int16Array:o.rawDepth="short";break;case Uint32Array:o.rawDepth="uint";break;case Int32Array:o.rawDepth="int";break;case Float32Array:o.rawDepth="float";break;case Float64Array:o.rawDepth="double";break;default:o.rawDepth="uchar";break}else throw new Error("Expected width, height and channels for raw pixel input");if(a.defined(r.animated))if(a.bool(r.animated))o.pages=r.animated?-1:1;else throw a.invalidParameterError("animated","boolean",r.animated);if(a.defined(r.pages))if(a.integer(r.pages)&&a.inRange(r.pages,-1,1e5))o.pages=r.pages;else throw a.invalidParameterError("pages","integer between -1 and 100000",r.pages);if(a.defined(r.page))if(a.integer(r.page)&&a.inRange(r.page,0,1e5))o.page=r.page;else throw a.invalidParameterError("page","integer between 0 and 100000",r.page);if(a.defined(r.level))if(a.integer(r.level)&&a.inRange(r.level,0,256))o.level=r.level;else throw a.invalidParameterError("level","integer between 0 and 256",r.level);if(a.defined(r.subifd))if(a.integer(r.subifd)&&a.inRange(r.subifd,-1,1e5))o.subifd=r.subifd;else throw a.invalidParameterError("subifd","integer between -1 and 100000",r.subifd);if(a.defined(r.create))if(a.object(r.create)&&a.integer(r.create.width)&&r.create.width>0&&a.integer(r.create.height)&&r.create.height>0&&a.integer(r.create.channels)){if(o.createWidth=r.create.width,o.createHeight=r.create.height,o.createChannels=r.create.channels,a.defined(r.create.noise)){if(!a.object(r.create.noise))throw new Error("Expected noise to be an object");if(!a.inArray(r.create.noise.type,["gaussian"]))throw new Error("Only gaussian noise is supported at the moment");if(!a.inRange(r.create.channels,1,4))throw a.invalidParameterError("create.channels","number between 1 and 4",r.create.channels);if(o.createNoiseType=r.create.noise.type,a.number(r.create.noise.mean)&&a.inRange(r.create.noise.mean,0,1e4))o.createNoiseMean=r.create.noise.mean;else throw a.invalidParameterError("create.noise.mean","number between 0 and 10000",r.create.noise.mean);if(a.number(r.create.noise.sigma)&&a.inRange(r.create.noise.sigma,0,1e4))o.createNoiseSigma=r.create.noise.sigma;else throw a.invalidParameterError("create.noise.sigma","number between 0 and 10000",r.create.noise.sigma)}else if(a.defined(r.create.background)){if(!a.inRange(r.create.channels,3,4))throw a.invalidParameterError("create.channels","number between 3 and 4",r.create.channels);let l=qr(r.create.background);o.createBackground=[l.red(),l.green(),l.blue(),Math.round(l.alpha()*255)]}else throw new Error("Expected valid noise or background to create a new input image");delete o.buffer}else throw new Error("Expected valid width, height and channels to create a new input image");if(a.defined(r.text))if(a.object(r.text)&&a.string(r.text.text)){if(o.textValue=r.text.text,a.defined(r.text.height)&&a.defined(r.text.dpi))throw new Error("Expected only one of dpi or height");if(a.defined(r.text.font))if(a.string(r.text.font))o.textFont=r.text.font;else throw a.invalidParameterError("text.font","string",r.text.font);if(a.defined(r.text.fontfile))if(a.string(r.text.fontfile))o.textFontfile=r.text.fontfile;else throw a.invalidParameterError("text.fontfile","string",r.text.fontfile);if(a.defined(r.text.width))if(a.number(r.text.width))o.textWidth=r.text.width;else throw a.invalidParameterError("text.textWidth","number",r.text.width);if(a.defined(r.text.height))if(a.number(r.text.height))o.textHeight=r.text.height;else throw a.invalidParameterError("text.height","number",r.text.height);if(a.defined(r.text.align))if(a.string(r.text.align)&&a.string(this.constructor.align[r.text.align]))o.textAlign=this.constructor.align[r.text.align];else throw a.invalidParameterError("text.align","valid alignment",r.text.align);if(a.defined(r.text.justify))if(a.bool(r.text.justify))o.textJustify=r.text.justify;else throw a.invalidParameterError("text.justify","boolean",r.text.justify);if(a.defined(r.text.dpi))if(a.number(r.text.dpi)&&a.inRange(r.text.dpi,1,1e5))o.textDpi=r.text.dpi;else throw a.invalidParameterError("text.dpi","number between 1 and 100000",r.text.dpi);if(a.defined(r.text.rgba))if(a.bool(r.text.rgba))o.textRgba=r.text.rgba;else throw a.invalidParameterError("text.rgba","bool",r.text.rgba);if(a.defined(r.text.spacing))if(a.number(r.text.spacing))o.textSpacing=r.text.spacing;else throw a.invalidParameterError("text.spacing","number",r.text.spacing);if(a.defined(r.text.wrap))if(a.string(r.text.wrap)&&a.inArray(r.text.wrap,["word","char","wordChar","none"]))o.textWrap=r.text.wrap;else throw a.invalidParameterError("text.wrap","one of: word, char, wordChar, none",r.text.wrap);delete o.buffer}else throw new Error("Expected a valid string to create an image with text.")}else if(a.defined(r))throw new Error("Invalid input options "+r);return o}function Cr(e,r,t){Array.isArray(this.options.input.buffer)?a.buffer(e)?(this.options.input.buffer.length===0&&this.on("finish",()=>{this.streamInFinished=!0}),this.options.input.buffer.push(e),t()):t(new Error("Non-Buffer data on Writable Stream")):t(new Error("Unexpected data on Writable Stream"))}function zr(){this._isStreamInput()&&(this.options.input.buffer=__Buffer$.concat(this.options.input.buffer))}function Lr(){return Array.isArray(this.options.input.buffer)}function Mr(e){return a.fn(e)?(this._isStreamInput()?this.on("finish",()=>{this._flattenBufferIn(),y.metadata(this.options,e)}):y.metadata(this.options,e),this):this._isStreamInput()?new Promise((r,t)=>{let o=()=>{this._flattenBufferIn(),y.metadata(this.options,(l,u)=>{l?t(l):r(u)})};this.writableFinished?o():this.once("finish",o)}):new Promise((r,t)=>{y.metadata(this.options,(o,l)=>{o?t(o):r(l)})})}function Fr(e){return a.fn(e)?(this._isStreamInput()?this.on("finish",()=>{this._flattenBufferIn(),y.stats(this.options,e)}):y.stats(this.options,e),this):this._isStreamInput()?new Promise((r,t)=>{this.on("finish",function(){this._flattenBufferIn(),y.stats(this.options,(o,l)=>{o?t(o):r(l)})})}):new Promise((r,t)=>{y.stats(this.options,(o,l)=>{o?t(o):r(l)})})}be.exports=function(e){Object.assign(e.prototype,{_inputOptionsFromObject:ge,_createInputDescriptor:Rr,_write:Cr,_flattenBufferIn:zr,_isStreamInput:Lr,metadata:Mr,stats:Fr}),e.align=Sr}});var xe=d((ct,Pe)=>{"use strict";var s=m(),ye={center:0,centre:0,north:1,east:2,south:3,west:4,northeast:5,southeast:6,southwest:7,northwest:8},pe={top:1,right:2,bottom:3,left:4,"right top":5,"right bottom":6,"left bottom":7,"left top":8},ve={background:"background",copy:"copy",repeat:"repeat",mirror:"mirror"},Ee={entropy:16,attention:17},H={nearest:"nearest",cubic:"cubic",mitchell:"mitchell",lanczos2:"lanczos2",lanczos3:"lanczos3"},Tr={contain:"contain",cover:"cover",fill:"fill",inside:"inside",outside:"outside"},Dr={contain:"embed",cover:"crop",fill:"ignore_aspect",inside:"max",outside:"min"};function J(e){return e.angle%360!==0||e.useExifOrientation===!0||e.rotationAngle!==0}function q(e){return e.width!==-1||e.height!==-1}function Wr(e,r,t){if(q(this.options)&&this.options.debuglog("ignoring previous resize options"),s.defined(e))if(s.object(e)&&!s.defined(t))t=e;else if(s.integer(e)&&e>0)this.options.width=e;else throw s.invalidParameterError("width","positive integer",e);else this.options.width=-1;if(s.defined(r))if(s.integer(r)&&r>0)this.options.height=r;else throw s.invalidParameterError("height","positive integer",r);else this.options.height=-1;if(s.object(t)){if(s.defined(t.width))if(s.integer(t.width)&&t.width>0)this.options.width=t.width;else throw s.invalidParameterError("width","positive integer",t.width);if(s.defined(t.height))if(s.integer(t.height)&&t.height>0)this.options.height=t.height;else throw s.invalidParameterError("height","positive integer",t.height);if(s.defined(t.fit)){let o=Dr[t.fit];if(s.string(o))this.options.canvas=o;else throw s.invalidParameterError("fit","valid fit",t.fit)}if(s.defined(t.position)){let o=s.integer(t.position)?t.position:Ee[t.position]||pe[t.position]||ye[t.position];if(s.integer(o)&&(s.inRange(o,0,8)||s.inRange(o,16,17)))this.options.position=o;else throw s.invalidParameterError("position","valid position/gravity/strategy",t.position)}if(this._setBackgroundColourOption("resizeBackground",t.background),s.defined(t.kernel))if(s.string(H[t.kernel]))this.options.kernel=H[t.kernel];else throw s.invalidParameterError("kernel","valid kernel name",t.kernel);s.defined(t.withoutEnlargement)&&this._setBooleanOption("withoutEnlargement",t.withoutEnlargement),s.defined(t.withoutReduction)&&this._setBooleanOption("withoutReduction",t.withoutReduction),s.defined(t.fastShrinkOnLoad)&&this._setBooleanOption("fastShrinkOnLoad",t.fastShrinkOnLoad)}return J(this.options)&&q(this.options)&&(this.options.rotateBeforePreExtract=!0),this}function Qr(e){if(s.integer(e)&&e>0)this.options.extendTop=e,this.options.extendBottom=e,this.options.extendLeft=e,this.options.extendRight=e;else if(s.object(e)){if(s.defined(e.top))if(s.integer(e.top)&&e.top>=0)this.options.extendTop=e.top;else throw s.invalidParameterError("top","positive integer",e.top);if(s.defined(e.bottom))if(s.integer(e.bottom)&&e.bottom>=0)this.options.extendBottom=e.bottom;else throw s.invalidParameterError("bottom","positive integer",e.bottom);if(s.defined(e.left))if(s.integer(e.left)&&e.left>=0)this.options.extendLeft=e.left;else throw s.invalidParameterError("left","positive integer",e.left);if(s.defined(e.right))if(s.integer(e.right)&&e.right>=0)this.options.extendRight=e.right;else throw s.invalidParameterError("right","positive integer",e.right);if(this._setBackgroundColourOption("extendBackground",e.background),s.defined(e.extendWith))if(s.string(ve[e.extendWith]))this.options.extendWith=ve[e.extendWith];else throw s.invalidParameterError("extendWith","one of: background, copy, repeat, mirror",e.extendWith)}else throw s.invalidParameterError("extend","integer or object",e);return this}function Ur(e){let r=q(this.options)||this.options.widthPre!==-1?"Post":"Pre";return this.options[`width${r}`]!==-1&&this.options.debuglog("ignoring previous extract options"),["left","top","width","height"].forEach(function(t){let o=e[t];if(s.integer(o)&&o>=0)this.options[t+(t==="left"||t==="top"?"Offset":"")+r]=o;else throw s.invalidParameterError(t,"integer",o)},this),J(this.options)&&!q(this.options)&&(this.options.widthPre===-1||this.options.widthPost===-1)&&(this.options.rotateBeforePreExtract=!0),this}function Hr(e){if(!s.defined(e))this.options.trimThreshold=10;else if(s.string(e))this._setBackgroundColourOption("trimBackground",e),this.options.trimThreshold=10;else if(s.number(e))if(e>=0)this.options.trimThreshold=e;else throw s.invalidParameterError("threshold","positive number",e);else if(s.object(e))if(this._setBackgroundColourOption("trimBackground",e.background),!s.defined(e.threshold))this.options.trimThreshold=10;else if(s.number(e.threshold)&&e.threshold>=0)this.options.trimThreshold=e.threshold;else throw s.invalidParameterError("threshold","positive number",e);else throw s.invalidParameterError("trim","string, number or object",e);return J(this.options)&&(this.options.rotateBeforePreExtract=!0),this}Pe.exports=function(e){Object.assign(e.prototype,{resize:Wr,extend:Qr,extract:Ur,trim:Hr}),e.gravity=ye,e.strategy=Ee,e.kernel=H,e.fit=Tr,e.position=pe}});var ke=d((ut,je)=>{"use strict";var f=m(),G={clear:"clear",source:"source",over:"over",in:"in",out:"out",atop:"atop",dest:"dest","dest-over":"dest-over","dest-in":"dest-in","dest-out":"dest-out","dest-atop":"dest-atop",xor:"xor",add:"add",saturate:"saturate",multiply:"multiply",screen:"screen",overlay:"overlay",darken:"darken",lighten:"lighten","colour-dodge":"colour-dodge","color-dodge":"colour-dodge","colour-burn":"colour-burn","color-burn":"colour-burn","hard-light":"hard-light","soft-light":"soft-light",difference:"difference",exclusion:"exclusion"};function Jr(e){if(!Array.isArray(e))throw f.invalidParameterError("images to composite","array",e);return this.options.composite=e.map(r=>{if(!f.object(r))throw f.invalidParameterError("image to composite","object",r);let t=this._inputOptionsFromObject(r),o={input:this._createInputDescriptor(r.input,t,{allowStream:!1}),blend:"over",tile:!1,left:0,top:0,hasOffset:!1,gravity:0,premultiplied:!1};if(f.defined(r.blend))if(f.string(G[r.blend]))o.blend=G[r.blend];else throw f.invalidParameterError("blend","valid blend name",r.blend);if(f.defined(r.tile))if(f.bool(r.tile))o.tile=r.tile;else throw f.invalidParameterError("tile","boolean",r.tile);if(f.defined(r.left))if(f.integer(r.left))o.left=r.left;else throw f.invalidParameterError("left","integer",r.left);if(f.defined(r.top))if(f.integer(r.top))o.top=r.top;else throw f.invalidParameterError("top","integer",r.top);if(f.defined(r.top)!==f.defined(r.left))throw new Error("Expected both left and top to be set");if(o.hasOffset=f.integer(r.top)&&f.integer(r.left),f.defined(r.gravity))if(f.integer(r.gravity)&&f.inRange(r.gravity,0,8))o.gravity=r.gravity;else if(f.string(r.gravity)&&f.integer(this.constructor.gravity[r.gravity]))o.gravity=this.constructor.gravity[r.gravity];else throw f.invalidParameterError("gravity","valid gravity",r.gravity);if(f.defined(r.premultiplied))if(f.bool(r.premultiplied))o.premultiplied=r.premultiplied;else throw f.invalidParameterError("premultiplied","boolean",r.premultiplied);return o}),this}je.exports=function(e){e.prototype.composite=Jr,e.blend=G}});var Be=d((mt,Ae)=>{"use strict";var Gr=__b$,n=m();function Nr(e,r){if((this.options.useExifOrientation||this.options.angle||this.options.rotationAngle)&&this.options.debuglog("ignoring previous rotate options"),!n.defined(e))this.options.useExifOrientation=!0;else if(n.integer(e)&&!(e%90))this.options.angle=e;else if(n.number(e)){if(this.options.rotationAngle=e,n.object(r)&&r.background){let t=Gr(r.background);this.options.rotationBackground=[t.red(),t.green(),t.blue(),Math.round(t.alpha()*255)]}}else throw n.invalidParameterError("angle","numeric",e);return this}function $r(e){return this.options.flip=n.bool(e)?e:!0,this}function Vr(e){return this.options.flop=n.bool(e)?e:!0,this}function Xr(e,r){let t=[].concat(...e);if(t.length===4&&t.every(n.number))this.options.affineMatrix=t;else throw n.invalidParameterError("matrix","1x4 or 2x2 array",e);if(n.defined(r))if(n.object(r)){if(this._setBackgroundColourOption("affineBackground",r.background),n.defined(r.idx))if(n.number(r.idx))this.options.affineIdx=r.idx;else throw n.invalidParameterError("options.idx","number",r.idx);if(n.defined(r.idy))if(n.number(r.idy))this.options.affineIdy=r.idy;else throw n.invalidParameterError("options.idy","number",r.idy);if(n.defined(r.odx))if(n.number(r.odx))this.options.affineOdx=r.odx;else throw n.invalidParameterError("options.odx","number",r.odx);if(n.defined(r.ody))if(n.number(r.ody))this.options.affineOdy=r.ody;else throw n.invalidParameterError("options.ody","number",r.ody);if(n.defined(r.interpolator))if(n.inArray(r.interpolator,Object.values(this.constructor.interpolators)))this.options.affineInterpolator=r.interpolator;else throw n.invalidParameterError("options.interpolator","valid interpolator name",r.interpolator)}else throw n.invalidParameterError("options","object",r);return this}function Yr(e,r,t){if(!n.defined(e))this.options.sharpenSigma=-1;else if(n.bool(e))this.options.sharpenSigma=e?-1:0;else if(n.number(e)&&n.inRange(e,.01,1e4)){if(this.options.sharpenSigma=e,n.defined(r))if(n.number(r)&&n.inRange(r,0,1e4))this.options.sharpenM1=r;else throw n.invalidParameterError("flat","number between 0 and 10000",r);if(n.defined(t))if(n.number(t)&&n.inRange(t,0,1e4))this.options.sharpenM2=t;else throw n.invalidParameterError("jagged","number between 0 and 10000",t)}else if(n.plainObject(e)){if(n.number(e.sigma)&&n.inRange(e.sigma,1e-6,10))this.options.sharpenSigma=e.sigma;else throw n.invalidParameterError("options.sigma","number between 0.000001 and 10",e.sigma);if(n.defined(e.m1))if(n.number(e.m1)&&n.inRange(e.m1,0,1e6))this.options.sharpenM1=e.m1;else throw n.invalidParameterError("options.m1","number between 0 and 1000000",e.m1);if(n.defined(e.m2))if(n.number(e.m2)&&n.inRange(e.m2,0,1e6))this.options.sharpenM2=e.m2;else throw n.invalidParameterError("options.m2","number between 0 and 1000000",e.m2);if(n.defined(e.x1))if(n.number(e.x1)&&n.inRange(e.x1,0,1e6))this.options.sharpenX1=e.x1;else throw n.invalidParameterError("options.x1","number between 0 and 1000000",e.x1);if(n.defined(e.y2))if(n.number(e.y2)&&n.inRange(e.y2,0,1e6))this.options.sharpenY2=e.y2;else throw n.invalidParameterError("options.y2","number between 0 and 1000000",e.y2);if(n.defined(e.y3))if(n.number(e.y3)&&n.inRange(e.y3,0,1e6))this.options.sharpenY3=e.y3;else throw n.invalidParameterError("options.y3","number between 0 and 1000000",e.y3)}else throw n.invalidParameterError("sigma","number between 0.01 and 10000",e);return this}function Kr(e){if(!n.defined(e))this.options.medianSize=3;else if(n.integer(e)&&n.inRange(e,1,1e3))this.options.medianSize=e;else throw n.invalidParameterError("size","integer between 1 and 1000",e);return this}function Zr(e){if(!n.defined(e))this.options.blurSigma=-1;else if(n.bool(e))this.options.blurSigma=e?-1:0;else if(n.number(e)&&n.inRange(e,.3,1e3))this.options.blurSigma=e;else throw n.invalidParameterError("sigma","number between 0.3 and 1000",e);return this}function Or(e){return this.options.flatten=n.bool(e)?e:!0,n.object(e)&&this._setBackgroundColourOption("flattenBackground",e.background),this}function ei(){return this.options.unflatten=!0,this}function ri(e,r){if(!n.defined(e))this.options.gamma=2.2;else if(n.number(e)&&n.inRange(e,1,3))this.options.gamma=e;else throw n.invalidParameterError("gamma","number between 1.0 and 3.0",e);if(!n.defined(r))this.options.gammaOut=this.options.gamma;else if(n.number(r)&&n.inRange(r,1,3))this.options.gammaOut=r;else throw n.invalidParameterError("gammaOut","number between 1.0 and 3.0",r);return this}function ii(e){if(this.options.negate=n.bool(e)?e:!0,n.plainObject(e)&&"alpha"in e)if(n.bool(e.alpha))this.options.negateAlpha=e.alpha;else throw n.invalidParameterError("alpha","should be boolean value",e.alpha);return this}function ti(e){if(n.plainObject(e)){if(n.defined(e.lower))if(n.number(e.lower)&&n.inRange(e.lower,0,99))this.options.normaliseLower=e.lower;else throw n.invalidParameterError("lower","number between 0 and 99",e.lower);if(n.defined(e.upper))if(n.number(e.upper)&&n.inRange(e.upper,1,100))this.options.normaliseUpper=e.upper;else throw n.invalidParameterError("upper","number between 1 and 100",e.upper)}if(this.options.normaliseLower>=this.options.normaliseUpper)throw n.invalidParameterError("range","lower to be less than upper",`${this.options.normaliseLower} >= ${this.options.normaliseUpper}`);return this.options.normalise=!0,this}function ni(e){return this.normalise(e)}function ai(e){if(n.plainObject(e)){if(n.integer(e.width)&&e.width>0)this.options.claheWidth=e.width;else throw n.invalidParameterError("width","integer greater than zero",e.width);if(n.integer(e.height)&&e.height>0)this.options.claheHeight=e.height;else throw n.invalidParameterError("height","integer greater than zero",e.height);if(n.defined(e.maxSlope))if(n.integer(e.maxSlope)&&n.inRange(e.maxSlope,0,100))this.options.claheMaxSlope=e.maxSlope;else throw n.invalidParameterError("maxSlope","integer between 0 and 100",e.maxSlope)}else throw n.invalidParameterError("options","plain object",e);return this}function oi(e){if(!n.object(e)||!Array.isArray(e.kernel)||!n.integer(e.width)||!n.integer(e.height)||!n.inRange(e.width,3,1001)||!n.inRange(e.height,3,1001)||e.height*e.width!==e.kernel.length)throw new Error("Invalid convolution kernel");return n.integer(e.scale)||(e.scale=e.kernel.reduce(function(r,t){return r+t},0)),e.scale<1&&(e.scale=1),n.integer(e.offset)||(e.offset=0),this.options.convKernel=e,this}function si(e,r){if(!n.defined(e))this.options.threshold=128;else if(n.bool(e))this.options.threshold=e?128:0;else if(n.integer(e)&&n.inRange(e,0,255))this.options.threshold=e;else throw n.invalidParameterError("threshold","integer between 0 and 255",e);return!n.object(r)||r.greyscale===!0||r.grayscale===!0?this.options.thresholdGrayscale=!0:this.options.thresholdGrayscale=!1,this}function li(e,r,t){if(this.options.boolean=this._createInputDescriptor(e,t),n.string(r)&&n.inArray(r,["and","or","eor"]))this.options.booleanOp=r;else throw n.invalidParameterError("operator","one of: and, or, eor",r);return this}function fi(e,r){if(!n.defined(e)&&n.number(r)?e=1:n.number(e)&&!n.defined(r)&&(r=0),!n.defined(e))this.options.linearA=[];else if(n.number(e))this.options.linearA=[e];else if(Array.isArray(e)&&e.length&&e.every(n.number))this.options.linearA=e;else throw n.invalidParameterError("a","number or array of numbers",e);if(!n.defined(r))this.options.linearB=[];else if(n.number(r))this.options.linearB=[r];else if(Array.isArray(r)&&r.length&&r.every(n.number))this.options.linearB=r;else throw n.invalidParameterError("b","number or array of numbers",r);if(this.options.linearA.length!==this.options.linearB.length)throw new Error("Expected a and b to be arrays of the same length");return this}function hi(e){if(!Array.isArray(e)||e.length!==3||e[0].length!==3||e[1].length!==3||e[2].length!==3)throw new Error("Invalid recombination matrix");return this.options.recombMatrix=[e[0][0],e[0][1],e[0][2],e[1][0],e[1][1],e[1][2],e[2][0],e[2][1],e[2][2]].map(Number),this}function di(e){if(!n.plainObject(e))throw n.invalidParameterError("options","plain object",e);if("brightness"in e)if(n.number(e.brightness)&&e.brightness>=0)this.options.brightness=e.brightness;else throw n.invalidParameterError("brightness","number above zero",e.brightness);if("saturation"in e)if(n.number(e.saturation)&&e.saturation>=0)this.options.saturation=e.saturation;else throw n.invalidParameterError("saturation","number above zero",e.saturation);if("hue"in e)if(n.integer(e.hue))this.options.hue=e.hue%360;else throw n.invalidParameterError("hue","number",e.hue);if("lightness"in e)if(n.number(e.lightness))this.options.lightness=e.lightness;else throw n.invalidParameterError("lightness","number",e.lightness);return this}Ae.exports=function(e){Object.assign(e.prototype,{rotate:Nr,flip:$r,flop:Vr,affine:Xr,sharpen:Yr,median:Kr,blur:Zr,flatten:Or,unflatten:ei,gamma:ri,negate:ii,normalise:ti,normalize:ni,clahe:ai,convolve:oi,threshold:si,boolean:li,linear:fi,recomb:hi,modulate:di})}});var Se=d((gt,qe)=>{"use strict";var Ie=__b$,b=m(),_e={multiband:"multiband","b-w":"b-w",bw:"b-w",cmyk:"cmyk",srgb:"srgb"};function ci(e){let r=Ie(e);return this.options.tintA=r.a(),this.options.tintB=r.b(),this}function ui(e){return this.options.greyscale=b.bool(e)?e:!0,this}function mi(e){return this.greyscale(e)}function gi(e){if(!b.string(e))throw b.invalidParameterError("colourspace","string",e);return this.options.colourspaceInput=e,this}function bi(e){return this.pipelineColourspace(e)}function wi(e){if(!b.string(e))throw b.invalidParameterError("colourspace","string",e);return this.options.colourspace=e,this}function vi(e){return this.toColourspace(e)}function yi(e,r){if(b.defined(r))if(b.object(r)||b.string(r)){let t=Ie(r);this.options[e]=[t.red(),t.green(),t.blue(),Math.round(t.alpha()*255)]}else throw b.invalidParameterError("background","object or string",r)}qe.exports=function(e){Object.assign(e.prototype,{tint:ci,greyscale:ui,grayscale:mi,pipelineColourspace:gi,pipelineColorspace:bi,toColourspace:wi,toColorspace:vi,_setBackgroundColourOption:yi}),e.colourspace=_e,e.colorspace=_e}});var Ce=d((bt,Re)=>{"use strict";var g=m(),pi={and:"and",or:"or",eor:"eor"};function Ei(){return this.options.removeAlpha=!0,this}function Pi(e){if(g.defined(e))if(g.number(e)&&g.inRange(e,0,1))this.options.ensureAlpha=e;else throw g.invalidParameterError("alpha","number between 0 and 1",e);else this.options.ensureAlpha=1;return this}function xi(e){let r={red:0,green:1,blue:2,alpha:3};if(Object.keys(r).includes(e)&&(e=r[e]),g.integer(e)&&g.inRange(e,0,4))this.options.extractChannel=e;else throw g.invalidParameterError("channel","integer or one of: red, green, blue, alpha",e);return this}function ji(e,r){return Array.isArray(e)?e.forEach(function(t){this.options.joinChannelIn.push(this._createInputDescriptor(t,r))},this):this.options.joinChannelIn.push(this._createInputDescriptor(e,r)),this}function ki(e){if(g.string(e)&&g.inArray(e,["and","or","eor"]))this.options.bandBoolOp=e;else throw g.invalidParameterError("boolOp","one of: and, or, eor",e);return this}Re.exports=function(e){Object.assign(e.prototype,{removeAlpha:Ei,ensureAlpha:Pi,extractChannel:xi,joinChannel:ji,bandbool:ki}),e.bool=pi}});var We=d((wt,De)=>{"use strict";var ze=__9$,i=m(),x=j(),Le=new Map([["heic","heif"],["heif","heif"],["avif","avif"],["jpeg","jpeg"],["jpg","jpeg"],["jpe","jpeg"],["tile","tile"],["dz","tile"],["png","png"],["raw","raw"],["tiff","tiff"],["tif","tiff"],["webp","webp"],["gif","gif"],["jp2","jp2"],["jpx","jp2"],["j2k","jp2"],["j2c","jp2"],["jxl","jxl"]]),Ai=/\.jp[2x]|j2[kc]$/i,Me=()=>new Error("JP2 output requires libvips with support for OpenJPEG"),Fe=e=>1<<31-Math.clz32(Math.ceil(Math.log2(e)));function Bi(e,r){let t;if(i.string(e)?i.string(this.options.input.file)&&ze.resolve(this.options.input.file)===ze.resolve(e)?t=new Error("Cannot use same file for input and output"):Ai.test(e)&&!this.constructor.format.jp2k.output.file&&(t=Me()):t=new Error("Missing output file path"),t)if(i.fn(r))r(t);else return Promise.reject(t);else return this.options.fileOut=e,this._pipeline(r);return this}function _i(e,r){return i.object(e)?this._setBooleanOption("resolveWithObject",e.resolveWithObject):this.options.resolveWithObject&&(this.options.resolveWithObject=!1),this.options.fileOut="",this._pipeline(i.fn(e)?e:r)}function Ii(e){if(this.options.withMetadata=i.bool(e)?e:!0,i.object(e)){if(i.defined(e.orientation))if(i.integer(e.orientation)&&i.inRange(e.orientation,1,8))this.options.withMetadataOrientation=e.orientation;else throw i.invalidParameterError("orientation","integer between 1 and 8",e.orientation);if(i.defined(e.density))if(i.number(e.density)&&e.density>0)this.options.withMetadataDensity=e.density;else throw i.invalidParameterError("density","positive number",e.density);if(i.defined(e.icc))if(i.string(e.icc))this.options.withMetadataIcc=e.icc;else throw i.invalidParameterError("icc","string filesystem path to ICC profile",e.icc);if(i.defined(e.exif))if(i.object(e.exif))for(let[r,t]of Object.entries(e.exif))if(i.object(t))for(let[o,l]of Object.entries(t))if(i.string(l))this.options.withMetadataStrs[`exif-${r.toLowerCase()}-${o}`]=l;else throw i.invalidParameterError(`exif.${r}.${o}`,"string",l);else throw i.invalidParameterError(`exif.${r}`,"object",t);else throw i.invalidParameterError("exif","object",e.exif)}return this}function qi(e,r){let t=Le.get((i.object(e)&&i.string(e.id)?e.id:e).toLowerCase());if(!t)throw i.invalidParameterError("format",`one of: ${[...Le.keys()].join(", ")}`,e);return this[t](r)}function Si(e){if(i.object(e)){if(i.defined(e.quality))if(i.integer(e.quality)&&i.inRange(e.quality,1,100))this.options.jpegQuality=e.quality;else throw i.invalidParameterError("quality","integer between 1 and 100",e.quality);if(i.defined(e.progressive)&&this._setBooleanOption("jpegProgressive",e.progressive),i.defined(e.chromaSubsampling))if(i.string(e.chromaSubsampling)&&i.inArray(e.chromaSubsampling,["4:2:0","4:4:4"]))this.options.jpegChromaSubsampling=e.chromaSubsampling;else throw i.invalidParameterError("chromaSubsampling","one of: 4:2:0, 4:4:4",e.chromaSubsampling);let r=i.bool(e.optimizeCoding)?e.optimizeCoding:e.optimiseCoding;if(i.defined(r)&&this._setBooleanOption("jpegOptimiseCoding",r),i.defined(e.mozjpeg))if(i.bool(e.mozjpeg))e.mozjpeg&&(this.options.jpegTrellisQuantisation=!0,this.options.jpegOvershootDeringing=!0,this.options.jpegOptimiseScans=!0,this.options.jpegProgressive=!0,this.options.jpegQuantisationTable=3);else throw i.invalidParameterError("mozjpeg","boolean",e.mozjpeg);let t=i.bool(e.trellisQuantization)?e.trellisQuantization:e.trellisQuantisation;i.defined(t)&&this._setBooleanOption("jpegTrellisQuantisation",t),i.defined(e.overshootDeringing)&&this._setBooleanOption("jpegOvershootDeringing",e.overshootDeringing);let o=i.bool(e.optimizeScans)?e.optimizeScans:e.optimiseScans;i.defined(o)&&(this._setBooleanOption("jpegOptimiseScans",o),o&&(this.options.jpegProgressive=!0));let l=i.number(e.quantizationTable)?e.quantizationTable:e.quantisationTable;if(i.defined(l))if(i.integer(l)&&i.inRange(l,0,8))this.options.jpegQuantisationTable=l;else throw i.invalidParameterError("quantisationTable","integer between 0 and 8",l)}return this._updateFormatOut("jpeg",e)}function Ri(e){if(i.object(e)){if(i.defined(e.progressive)&&this._setBooleanOption("pngProgressive",e.progressive),i.defined(e.compressionLevel))if(i.integer(e.compressionLevel)&&i.inRange(e.compressionLevel,0,9))this.options.pngCompressionLevel=e.compressionLevel;else throw i.invalidParameterError("compressionLevel","integer between 0 and 9",e.compressionLevel);i.defined(e.adaptiveFiltering)&&this._setBooleanOption("pngAdaptiveFiltering",e.adaptiveFiltering);let r=e.colours||e.colors;if(i.defined(r))if(i.integer(r)&&i.inRange(r,2,256))this.options.pngBitdepth=Fe(r);else throw i.invalidParameterError("colours","integer between 2 and 256",r);if(i.defined(e.palette)?this._setBooleanOption("pngPalette",e.palette):[e.quality,e.effort,e.colours,e.colors,e.dither].some(i.defined)&&this._setBooleanOption("pngPalette",!0),this.options.pngPalette){if(i.defined(e.quality))if(i.integer(e.quality)&&i.inRange(e.quality,0,100))this.options.pngQuality=e.quality;else throw i.invalidParameterError("quality","integer between 0 and 100",e.quality);if(i.defined(e.effort))if(i.integer(e.effort)&&i.inRange(e.effort,1,10))this.options.pngEffort=e.effort;else throw i.invalidParameterError("effort","integer between 1 and 10",e.effort);if(i.defined(e.dither))if(i.number(e.dither)&&i.inRange(e.dither,0,1))this.options.pngDither=e.dither;else throw i.invalidParameterError("dither","number between 0.0 and 1.0",e.dither)}}return this._updateFormatOut("png",e)}function Ci(e){if(i.object(e)){if(i.defined(e.quality))if(i.integer(e.quality)&&i.inRange(e.quality,1,100))this.options.webpQuality=e.quality;else throw i.invalidParameterError("quality","integer between 1 and 100",e.quality);if(i.defined(e.alphaQuality))if(i.integer(e.alphaQuality)&&i.inRange(e.alphaQuality,0,100))this.options.webpAlphaQuality=e.alphaQuality;else throw i.invalidParameterError("alphaQuality","integer between 0 and 100",e.alphaQuality);if(i.defined(e.lossless)&&this._setBooleanOption("webpLossless",e.lossless),i.defined(e.nearLossless)&&this._setBooleanOption("webpNearLossless",e.nearLossless),i.defined(e.smartSubsample)&&this._setBooleanOption("webpSmartSubsample",e.smartSubsample),i.defined(e.effort))if(i.integer(e.effort)&&i.inRange(e.effort,0,6))this.options.webpEffort=e.effort;else throw i.invalidParameterError("effort","integer between 0 and 6",e.effort);i.defined(e.minSize)&&this._setBooleanOption("webpMinSize",e.minSize),i.defined(e.mixed)&&this._setBooleanOption("webpMixed",e.mixed)}return Te(e,this.options),this._updateFormatOut("webp",e)}function zi(e){if(i.object(e)){i.defined(e.reuse)&&this._setBooleanOption("gifReuse",e.reuse),i.defined(e.progressive)&&this._setBooleanOption("gifProgressive",e.progressive);let r=e.colours||e.colors;if(i.defined(r))if(i.integer(r)&&i.inRange(r,2,256))this.options.gifBitdepth=Fe(r);else throw i.invalidParameterError("colours","integer between 2 and 256",r);if(i.defined(e.effort))if(i.number(e.effort)&&i.inRange(e.effort,1,10))this.options.gifEffort=e.effort;else throw i.invalidParameterError("effort","integer between 1 and 10",e.effort);if(i.defined(e.dither))if(i.number(e.dither)&&i.inRange(e.dither,0,1))this.options.gifDither=e.dither;else throw i.invalidParameterError("dither","number between 0.0 and 1.0",e.dither);if(i.defined(e.interFrameMaxError))if(i.number(e.interFrameMaxError)&&i.inRange(e.interFrameMaxError,0,32))this.options.gifInterFrameMaxError=e.interFrameMaxError;else throw i.invalidParameterError("interFrameMaxError","number between 0.0 and 32.0",e.interFrameMaxError);if(i.defined(e.interPaletteMaxError))if(i.number(e.interPaletteMaxError)&&i.inRange(e.interPaletteMaxError,0,256))this.options.gifInterPaletteMaxError=e.interPaletteMaxError;else throw i.invalidParameterError("interPaletteMaxError","number between 0.0 and 256.0",e.interPaletteMaxError)}return Te(e,this.options),this._updateFormatOut("gif",e)}function Li(e){if(!this.constructor.format.jp2k.output.buffer)throw Me();if(i.object(e)){if(i.defined(e.quality))if(i.integer(e.quality)&&i.inRange(e.quality,1,100))this.options.jp2Quality=e.quality;else throw i.invalidParameterError("quality","integer between 1 and 100",e.quality);if(i.defined(e.lossless))if(i.bool(e.lossless))this.options.jp2Lossless=e.lossless;else throw i.invalidParameterError("lossless","boolean",e.lossless);if(i.defined(e.tileWidth))if(i.integer(e.tileWidth)&&i.inRange(e.tileWidth,1,32768))this.options.jp2TileWidth=e.tileWidth;else throw i.invalidParameterError("tileWidth","integer between 1 and 32768",e.tileWidth);if(i.defined(e.tileHeight))if(i.integer(e.tileHeight)&&i.inRange(e.tileHeight,1,32768))this.options.jp2TileHeight=e.tileHeight;else throw i.invalidParameterError("tileHeight","integer between 1 and 32768",e.tileHeight);if(i.defined(e.chromaSubsampling))if(i.string(e.chromaSubsampling)&&i.inArray(e.chromaSubsampling,["4:2:0","4:4:4"]))this.options.jp2ChromaSubsampling=e.chromaSubsampling;else throw i.invalidParameterError("chromaSubsampling","one of: 4:2:0, 4:4:4",e.chromaSubsampling)}return this._updateFormatOut("jp2",e)}function Te(e,r){if(i.object(e)&&i.defined(e.loop))if(i.integer(e.loop)&&i.inRange(e.loop,0,65535))r.loop=e.loop;else throw i.invalidParameterError("loop","integer between 0 and 65535",e.loop);if(i.object(e)&&i.defined(e.delay))if(i.integer(e.delay)&&i.inRange(e.delay,0,65535))r.delay=[e.delay];else if(Array.isArray(e.delay)&&e.delay.every(i.integer)&&e.delay.every(t=>i.inRange(t,0,65535)))r.delay=e.delay;else throw i.invalidParameterError("delay","integer or an array of integers between 0 and 65535",e.delay)}function Mi(e){if(i.object(e)){if(i.defined(e.quality))if(i.integer(e.quality)&&i.inRange(e.quality,1,100))this.options.tiffQuality=e.quality;else throw i.invalidParameterError("quality","integer between 1 and 100",e.quality);if(i.defined(e.bitdepth))if(i.integer(e.bitdepth)&&i.inArray(e.bitdepth,[1,2,4,8]))this.options.tiffBitdepth=e.bitdepth;else throw i.invalidParameterError("bitdepth","1, 2, 4 or 8",e.bitdepth);if(i.defined(e.tile)&&this._setBooleanOption("tiffTile",e.tile),i.defined(e.tileWidth))if(i.integer(e.tileWidth)&&e.tileWidth>0)this.options.tiffTileWidth=e.tileWidth;else throw i.invalidParameterError("tileWidth","integer greater than zero",e.tileWidth);if(i.defined(e.tileHeight))if(i.integer(e.tileHeight)&&e.tileHeight>0)this.options.tiffTileHeight=e.tileHeight;else throw i.invalidParameterError("tileHeight","integer greater than zero",e.tileHeight);if(i.defined(e.pyramid)&&this._setBooleanOption("tiffPyramid",e.pyramid),i.defined(e.xres))if(i.number(e.xres)&&e.xres>0)this.options.tiffXres=e.xres;else throw i.invalidParameterError("xres","number greater than zero",e.xres);if(i.defined(e.yres))if(i.number(e.yres)&&e.yres>0)this.options.tiffYres=e.yres;else throw i.invalidParameterError("yres","number greater than zero",e.yres);if(i.defined(e.compression))if(i.string(e.compression)&&i.inArray(e.compression,["none","jpeg","deflate","packbits","ccittfax4","lzw","webp","zstd","jp2k"]))this.options.tiffCompression=e.compression;else throw i.invalidParameterError("compression","one of: none, jpeg, deflate, packbits, ccittfax4, lzw, webp, zstd, jp2k",e.compression);if(i.defined(e.predictor))if(i.string(e.predictor)&&i.inArray(e.predictor,["none","horizontal","float"]))this.options.tiffPredictor=e.predictor;else throw i.invalidParameterError("predictor","one of: none, horizontal, float",e.predictor);if(i.defined(e.resolutionUnit))if(i.string(e.resolutionUnit)&&i.inArray(e.resolutionUnit,["inch","cm"]))this.options.tiffResolutionUnit=e.resolutionUnit;else throw i.invalidParameterError("resolutionUnit","one of: inch, cm",e.resolutionUnit)}return this._updateFormatOut("tiff",e)}function Fi(e){return this.heif({...e,compression:"av1"})}function Ti(e){if(i.object(e)){if(i.defined(e.quality))if(i.integer(e.quality)&&i.inRange(e.quality,1,100))this.options.heifQuality=e.quality;else throw i.invalidParameterError("quality","integer between 1 and 100",e.quality);if(i.defined(e.lossless))if(i.bool(e.lossless))this.options.heifLossless=e.lossless;else throw i.invalidParameterError("lossless","boolean",e.lossless);if(i.defined(e.compression))if(i.string(e.compression)&&i.inArray(e.compression,["av1","hevc"]))this.options.heifCompression=e.compression;else throw i.invalidParameterError("compression","one of: av1, hevc",e.compression);if(i.defined(e.effort))if(i.integer(e.effort)&&i.inRange(e.effort,0,9))this.options.heifEffort=e.effort;else throw i.invalidParameterError("effort","integer between 0 and 9",e.effort);if(i.defined(e.chromaSubsampling))if(i.string(e.chromaSubsampling)&&i.inArray(e.chromaSubsampling,["4:2:0","4:4:4"]))this.options.heifChromaSubsampling=e.chromaSubsampling;else throw i.invalidParameterError("chromaSubsampling","one of: 4:2:0, 4:4:4",e.chromaSubsampling)}return this._updateFormatOut("heif",e)}function Di(e){if(i.object(e)){if(i.defined(e.quality))if(i.integer(e.quality)&&i.inRange(e.quality,1,100))this.options.jxlDistance=e.quality>=30?.1+(100-e.quality)*.09:53/3e3*e.quality*e.quality-23/20*e.quality+25;else throw i.invalidParameterError("quality","integer between 1 and 100",e.quality);else if(i.defined(e.distance))if(i.number(e.distance)&&i.inRange(e.distance,0,15))this.options.jxlDistance=e.distance;else throw i.invalidParameterError("distance","number between 0.0 and 15.0",e.distance);if(i.defined(e.decodingTier))if(i.integer(e.decodingTier)&&i.inRange(e.decodingTier,0,4))this.options.jxlDecodingTier=e.decodingTier;else throw i.invalidParameterError("decodingTier","integer between 0 and 4",e.decodingTier);if(i.defined(e.lossless))if(i.bool(e.lossless))this.options.jxlLossless=e.lossless;else throw i.invalidParameterError("lossless","boolean",e.lossless);if(i.defined(e.effort))if(i.integer(e.effort)&&i.inRange(e.effort,3,9))this.options.jxlEffort=e.effort;else throw i.invalidParameterError("effort","integer between 3 and 9",e.effort)}return this._updateFormatOut("jxl",e)}function Wi(e){if(i.object(e)&&i.defined(e.depth))if(i.string(e.depth)&&i.inArray(e.depth,["char","uchar","short","ushort","int","uint","float","complex","double","dpcomplex"]))this.options.rawDepth=e.depth;else throw i.invalidParameterError("depth","one of: char, uchar, short, ushort, int, uint, float, complex, double, dpcomplex",e.depth);return this._updateFormatOut("raw")}function Qi(e){if(i.object(e)){if(i.defined(e.size))if(i.integer(e.size)&&i.inRange(e.size,1,8192))this.options.tileSize=e.size;else throw i.invalidParameterError("size","integer between 1 and 8192",e.size);if(i.defined(e.overlap))if(i.integer(e.overlap)&&i.inRange(e.overlap,0,8192)){if(e.overlap>this.options.tileSize)throw i.invalidParameterError("overlap",`<= size (${this.options.tileSize})`,e.overlap);this.options.tileOverlap=e.overlap}else throw i.invalidParameterError("overlap","integer between 0 and 8192",e.overlap);if(i.defined(e.container))if(i.string(e.container)&&i.inArray(e.container,["fs","zip"]))this.options.tileContainer=e.container;else throw i.invalidParameterError("container","one of: fs, zip",e.container);if(i.defined(e.layout))if(i.string(e.layout)&&i.inArray(e.layout,["dz","google","iiif","iiif3","zoomify"]))this.options.tileLayout=e.layout;else throw i.invalidParameterError("layout","one of: dz, google, iiif, iiif3, zoomify",e.layout);if(i.defined(e.angle))if(i.integer(e.angle)&&!(e.angle%90))this.options.tileAngle=e.angle;else throw i.invalidParameterError("angle","positive/negative multiple of 90",e.angle);if(this._setBackgroundColourOption("tileBackground",e.background),i.defined(e.depth))if(i.string(e.depth)&&i.inArray(e.depth,["onepixel","onetile","one"]))this.options.tileDepth=e.depth;else throw i.invalidParameterError("depth","one of: onepixel, onetile, one",e.depth);if(i.defined(e.skipBlanks))if(i.integer(e.skipBlanks)&&i.inRange(e.skipBlanks,-1,65535))this.options.tileSkipBlanks=e.skipBlanks;else throw i.invalidParameterError("skipBlanks","integer between -1 and 255/65535",e.skipBlanks);else i.defined(e.layout)&&e.layout==="google"&&(this.options.tileSkipBlanks=5);let r=i.bool(e.center)?e.center:e.centre;if(i.defined(r)&&this._setBooleanOption("tileCentre",r),i.defined(e.id))if(i.string(e.id))this.options.tileId=e.id;else throw i.invalidParameterError("id","string",e.id);if(i.defined(e.basename))if(i.string(e.basename))this.options.tileBasename=e.basename;else throw i.invalidParameterError("basename","string",e.basename)}if(i.inArray(this.options.formatOut,["jpeg","png","webp"]))this.options.tileFormat=this.options.formatOut;else if(this.options.formatOut!=="input")throw i.invalidParameterError("format","one of: jpeg, png, webp",this.options.formatOut);return this._updateFormatOut("dz")}function Ui(e){if(!i.plainObject(e))throw i.invalidParameterError("options","object",e);if(i.integer(e.seconds)&&i.inRange(e.seconds,0,3600))this.options.timeoutSeconds=e.seconds;else throw i.invalidParameterError("seconds","integer between 0 and 3600",e.seconds);return this}function Hi(e,r){return i.object(r)&&r.force===!1||(this.options.formatOut=e),this}function Ji(e,r){if(i.bool(r))this.options[e]=r;else throw i.invalidParameterError(e,"boolean",r)}function Gi(){this.options.streamOut||(this.options.streamOut=!0,this._pipeline())}function Ni(e){return typeof e=="function"?(this._isStreamInput()?this.on("finish",()=>{this._flattenBufferIn(),x.pipeline(this.options,e)}):x.pipeline(this.options,e),this):this.options.streamOut?(this._isStreamInput()?(this.once("finish",()=>{this._flattenBufferIn(),x.pipeline(this.options,(r,t,o)=>{r?this.emit("error",r):(this.emit("info",o),this.push(t)),this.push(null),this.on("end",()=>this.emit("close"))})}),this.streamInFinished&&this.emit("finish")):x.pipeline(this.options,(r,t,o)=>{r?this.emit("error",r):(this.emit("info",o),this.push(t)),this.push(null),this.on("end",()=>this.emit("close"))}),this):this._isStreamInput()?new Promise((r,t)=>{this.once("finish",()=>{this._flattenBufferIn(),x.pipeline(this.options,(o,l,u)=>{o?t(o):this.options.resolveWithObject?r({data:l,info:u}):r(l)})})}):new Promise((r,t)=>{x.pipeline(this.options,(o,l,u)=>{o?t(o):this.options.resolveWithObject?r({data:l,info:u}):r(l)})})}De.exports=function(e){Object.assign(e.prototype,{toFile:Bi,toBuffer:_i,withMetadata:Ii,toFormat:qi,jpeg:Si,jp2:Li,png:Ri,webp:Ci,tiff:Mi,avif:Fi,heif:Ti,jxl:Di,gif:zi,raw:Wi,tile:Qi,timeout:Ui,_updateFormatOut:Hi,_setBooleanOption:Ji,_read:Gi,_pipeline:Ni})}});var $e=d((vt,Ne)=>{"use strict";var $i=__a$,Vi=__9$,Xi=__8$,Qe=__7$,S=m(),Ue=_()(),c=j(),A=c.format();A.heif.output.alias=["avif","heic"];A.jpeg.output.alias=["jpe","jpg"];A.tiff.output.alias=["tif"];A.jp2k.output.alias=["j2c","j2k","jp2","jpx"];var Yi={nearest:"nearest",bilinear:"bilinear",bicubic:"bicubic",locallyBoundedBicubic:"lbb",nohalo:"nohalo",vertexSplitQuadraticBasisSpline:"vsqbs"},k={vips:c.libvipsVersion()};try{k=h(`../vendor/${k.vips}/${Ue}/versions.json`)}catch{}k.sharp=L().version;var He={current:Ue,installed:[]};try{He.installed=$i.readdirSync(Vi.join("/_virtual/v124/sharp@0.32.1/deno",`../vendor/${k.vips}`))}catch{}function Je(e){return S.bool(e)?e?c.cache(50,20,100):c.cache(0,0,0):S.object(e)?c.cache(e.memory,e.files,e.items):c.cache()}Je(!0);function Ki(e){return c.concurrency(S.integer(e)?e:null)}Qe.familySync()===Qe.GLIBC&&!c._isUsingJemalloc()&&c.concurrency(1);var Zi=new Xi.EventEmitter;function Oi(){return c.counters()}function Ge(e){return c.simd(S.bool(e)?e:null)}Ge(!0);Ne.exports=function(e){e.cache=Je,e.concurrency=Ki,e.counters=Oi,e.simd=Ge,e.format=A,e.interpolators=Yi,e.versions=k,e.vendor=He,e.queue=Zi}});var N=d((pt,Ve)=>{"use strict";var w=me();we()(w);xe()(w);ke()(w);Be()(w);Se()(w);Ce()(w);We()(w);$e()(w);Ve.exports=w});var E={};rr(E,{default:()=>it});var et=ee(N());P(E,ee(N()));var{default:Xe,...rt}=et,it=Xe!==void 0?Xe:rt;export{it as default};
//# sourceMappingURL=sharp.mjs.map