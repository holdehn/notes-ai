/* esm.sh - esbuild bundle(efrt@2.7.0) deno production */
var T=function(t,n){let e=Math.min(t.length,n.length);for(;e>0;){let i=t.slice(0,e);if(i===n.slice(0,e))return i;e-=1}return""},j=function(t){t.sort();for(let n=1;n<t.length;n++)t[n-1]===t[n]&&t.splice(n,1)},h={commonPrefix:T,unique:j};var A=function(){this.counts={}},y={init:function(t){this.counts[t]===void 0&&(this.counts[t]=0)},add:function(t,n){n===void 0&&(n=1),this.init(t),this.counts[t]+=n},countOf:function(t){return this.init(t),this.counts[t]},highest:function(t){let n=[],e=Object.keys(this.counts);for(let i=0;i<e.length;i++){let r=e[i];n.push([r,this.counts[r]])}return n.sort(function(i,r){return r[1]-i[1]}),t&&(n=n.slice(0,t)),n}};Object.keys(y).forEach(function(t){A.prototype[t]=y[t]});var p=A;var a="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ",_=a.split("").reduce(function(t,n,e){return t[n]=e,t},{}),k=function(t){if(a[t]!==void 0)return a[t];let n=1,e=36,i="";for(;t>=e;t-=e,n++,e*=36);for(;n--;){let r=t%36;i=String.fromCharCode((r<10?48:55)+r)+i,t=(t-r)/36}return i},R=function(t){if(_[t]!==void 0)return _[t];let n=0,e=1,i=36,r=1;for(;e<t.length;n+=i,e++,i*=36);for(let o=t.length-1;o>=0;o--,r*=36){let s=t.charCodeAt(o)-48;s>10&&(s-=7),n+=s*r}return n},u={toAlphaCode:k,fromAlphaCode:R};var f={NODE_SEP:";",KEY_VAL:":",STRING_SEP:",",TERMINAL_PREFIX:"!",BASE:36},B=function(t,n){let e="",i="";t.isTerminal(n)&&(e+=f.TERMINAL_PREFIX);let r=t.nodeProps(n);for(let o=0;o<r.length;o++){let s=r[o];if(typeof n[s]=="number"){e+=i+s,i=f.STRING_SEP;continue}if(t.syms[n[s]._n]){e+=i+s+t.syms[n[s]._n],i="";continue}let c=u.toAlphaCode(n._n-n[s]._n-1+t.symCount);if(n[s]._g&&c.length>=n[s]._g.length&&n[n[s]._g]===1){c=n[s]._g,e+=i+s+c,i=f.STRING_SEP;continue}e+=i+s+c,i=""}return e},C=function(t,n){if(t.visited(n))return;let e=t.nodeProps(n,!0);for(let i=0;i<e.length;i++){let r=e[i],o=n._n-n[r]._n-1;o<f.BASE&&t.histRel.add(o),t.histAbs.add(n[r]._n,u.toAlphaCode(o).length-1),C(t,n[r])}},D=function(t){t.histAbs=t.histAbs.highest(f.BASE);let n=[];n[-1]=0;let e=0,i=0,r=3+u.toAlphaCode(t.nodeCount).length;for(let o=0;o<f.BASE&&t.histAbs[o]!==void 0;o++)n[o]=t.histAbs[o][1]-r-t.histRel.countOf(f.BASE-o-1)+n[o-1],n[o]>=e&&(e=n[o],i=o+1);return i},b=function(t,n){if(n._n!==void 0)return;let e=t.nodeProps(n,!0);for(let i=0;i<e.length;i++)b(t,n[e[i]]);n._n=t.pos++,t.nodes.unshift(n)},F=function(t){t.nodes=[],t.nodeCount=0,t.syms={},t.symCount=0,t.pos=0,t.optimize(),t.histAbs=new p,t.histRel=new p,b(t,t.root),t.nodeCount=t.nodes.length,t.prepDFS(),C(t,t.root),t.symCount=D(t);for(let n=0;n<t.symCount;n++)t.syms[t.histAbs[n][0]]=u.toAlphaCode(n);for(let n=0;n<t.nodeCount;n++)t.nodes[n]=B(t,t.nodes[n]);for(let n=t.symCount-1;n>=0;n--)t.nodes.unshift(u.toAlphaCode(n)+f.KEY_VAL+u.toAlphaCode(t.nodeCount-t.histAbs[n][0]-1));return t.nodes.join(f.NODE_SEP)},x=F;var I=new RegExp("[0-9A-Z,;!:|\xA6]"),L={_d:!0,_v:!0,_c:!0,_g:!0,_n:!0},W={insertWords:function(t){if(t!==void 0){typeof t=="string"&&(t=t.split(/[^a-zA-Z]+/));for(let n=0;n<t.length;n++)t[n]=t[n].toLowerCase();h.unique(t);for(let n=0;n<t.length;n++)t[n].match(I)===null&&this.insert(t[n])}},insert:function(t){this._insert(t,this.root);let n=this.lastWord;if(this.lastWord=t,h.commonPrefix(t,n)===n)return;let i=this.uniqueNode(n,t,this.root);i&&this.combineSuffixNode(i)},_insert:function(t,n){let e,i;if(t.length===0)return;let r=Object.keys(n);for(let o=0;o<r.length;o++){let s=r[o];if(e=h.commonPrefix(t,s),e.length!==0){if(s===e&&typeof n[s]=="object"){this._insert(t.slice(e.length),n[s]);return}if(s===t&&typeof n[s]=="number")return;i={},i[s.slice(e.length)]=n[s],this.addTerminal(i,t=t.slice(e.length)),delete n[s],n[e]=i,this.wordCount++;return}}this.addTerminal(n,t),this.wordCount++},addTerminal:function(t,n){if(n.length<=1){t[n]=1;return}let e={};t[n[0]]=e,this.addTerminal(e,n.slice(1))},nodeProps:function(t,n){let e=[];for(let i in t)i!==""&&!L.hasOwnProperty(i)&&(!n||typeof t[i]=="object")&&e.push(i);return e.sort(),e},optimize:function(){this.combineSuffixNode(this.root),this.prepDFS(),this.countDegree(this.root),this.prepDFS(),this.collapseChains(this.root)},combineSuffixNode:function(t){if(t._c)return t;let n=[];this.isTerminal(t)&&n.push("!");let e=this.nodeProps(t);for(let r=0;r<e.length;r++){let o=e[r];typeof t[o]=="object"?(t[o]=this.combineSuffixNode(t[o]),n.push(o),n.push(t[o]._c)):n.push(o)}n=n.join("-");let i=this.suffixes[n];return i||(this.suffixes[n]=t,t._c=this.cNext++,t)},prepDFS:function(){this.vCur++},visited:function(t){return t._v===this.vCur?!0:(t._v=this.vCur,!1)},countDegree:function(t){if(t._d===void 0&&(t._d=0),t._d++,this.visited(t))return;let n=this.nodeProps(t,!0);for(let e=0;e<n.length;e++)this.countDegree(t[n[e]])},collapseChains:function(t){let n,e,i;if(this.visited(t))return;let r=this.nodeProps(t);for(i=0;i<r.length;i++)n=r[i],e=t[n],typeof e=="object"&&(this.collapseChains(e),e._g!==void 0&&(e._d===1||e._g.length===1)&&(delete t[n],n+=e._g,t[n]=e[e._g]));r.length===1&&!this.isTerminal(t)&&(t._g=n)},isTerminal:function(t){return!!t[""]},uniqueNode:function(t,n,e){let i=this.nodeProps(e,!0);for(let r=0;r<i.length;r++){let o=i[r];if(o===t.slice(0,o.length))return o!==n.slice(0,o.length)?e[o]:this.uniqueNode(t.slice(o.length),n.slice(o.length),e[o])}},pack:function(){return x(this)}},m=W;var S=function(t){this.root={},this.lastWord="",this.suffixes={},this.suffixCounts={},this.cNext=1,this.wordCount=0,this.insertWords(t),this.vCur=0};Object.keys(m).forEach(function(t){S.prototype[t]=m[t]});var E=S;var P=function(t){return Object.prototype.toString.call(t)==="[object Array]"},q=function(t){return t==null?{}:typeof t=="string"?t.split(/ +/g).reduce(function(n,e){return n[e]=!0,n},{}):P(t)?t.reduce(function(n,e){return n[e]=!0,n},{}):t},z=function(t){t=q(t);let n=Object.keys(t).reduce(function(e,i){let r=t[i];if(P(r)){for(let o=0;o<r.length;o++)e[r[o]]=e[r[o]]||[],e[r[o]].push(i);return e}return e.hasOwnProperty(r)===!1&&Object.defineProperty(e,r,{writable:!0,enumerable:!0,configurable:!0,value:[]}),e[r].push(i),e},{});return Object.keys(n).forEach(function(e){let i=new E(n[e]);n[e]=i.pack()}),Object.keys(n).map(e=>e+"\xA6"+n[e]).join("|")},Z=z;var G=function(t){let n=new RegExp("([0-9A-Z]+):([0-9A-Z]+)");for(let e=0;e<t.nodes.length;e++){let i=n.exec(t.nodes[e]);if(!i){t.symCount=e;break}t.syms[u.fromAlphaCode(i[1])]=u.fromAlphaCode(i[2])}t.nodes=t.nodes.slice(t.symCount,t.nodes.length)},O=G;var M=function(t,n,e){let i=u.fromAlphaCode(n);return i<t.symCount?t.syms[i]:e+i+1-t.symCount},H=function(t){let n=[],e=(i,r)=>{let o=t.nodes[i];o[0]==="!"&&(n.push(r),o=o.slice(1));let s=o.split(/([A-Z0-9,]+)/g);for(let c=0;c<s.length;c+=2){let g=s[c],l=s[c+1];if(!g)continue;let d=r+g;if(l===","||l===void 0){n.push(d);continue}let v=M(t,l,i);e(v,d)}};return e(0,""),n},K=function(t){let n={nodes:t.split(";"),syms:[],symCount:0};return t.match(":")&&O(n),H(n)},N=K;var V=function(t){if(!t)return{};let n=t.split("|").reduce((i,r)=>{let o=r.split("\xA6");return i[o[0]]=o[1],i},{}),e={};return Object.keys(n).forEach(function(i){let r=N(n[i]);i==="true"&&(i=!0);for(let o=0;o<r.length;o++){let s=r[o];e.hasOwnProperty(s)===!0?Array.isArray(e[s])===!1?e[s]=[e[s],i]:e[s].push(i):e[s]=i}}),e},X=V;var Y="2.7.0";export{Z as pack,X as unpack,Y as version};
//# sourceMappingURL=efrt.mjs.map