/* esm.sh - esbuild bundle(langchain@0.0.52/prompts) deno production */
var Z=Object.defineProperty;var w=(s,e)=>()=>(s&&(e=s(s=0)),e);var W=(s,e)=>{for(var t in e)Z(s,t,{get:e[t],enumerable:!0})};var m,c,V,j,O,T,L=w(()=>{m=class{constructor(e){Object.defineProperty(this,"text",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.text=e}},c=class extends m{_getType(){return"human"}},V=class extends m{_getType(){return"ai"}},j=class extends m{_getType(){return"system"}},O=class extends m{constructor(e,t){super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=t}_getType(){return"generic"}},T=class{}});var H,B,k,ee,f,A,E,_=w(()=>{H=s=>{let e=s.split(""),t=[],a=(i,n)=>{for(let o=n;o<e.length;o+=1)if(i.includes(e[o]))return o;return-1},r=0;for(;r<e.length;)if(e[r]==="{"&&r+1<e.length&&e[r+1]==="{")t.push({type:"literal",text:"{"}),r+=2;else if(e[r]==="}"&&r+1<e.length&&e[r+1]==="}")t.push({type:"literal",text:"}"}),r+=2;else if(e[r]==="{"){let i=a("}",r);if(i<0)throw new Error("Unclosed '{' in template.");t.push({type:"variable",name:e.slice(r+1,i).join("")}),r=i+1}else{if(e[r]==="}")throw new Error("Single '}' in template.");{let i=a("{}",r),n=(i<0?e.slice(r):e.slice(r,i)).join("");t.push({type:"literal",text:n}),r=i<0?e.length:i}}return t},B=(s,e)=>H(s).reduce((t,a)=>{if(a.type==="variable"){if(a.name in e)return t+e[a.name];throw new Error(`Missing value for input ${a.name}`)}return t+a.text},""),k={"f-string":B,jinja2:(s,e)=>""},ee={"f-string":H,jinja2:s=>[]},f=(s,e,t)=>k[e](s,t),A=(s,e)=>ee[e](s),E=(s,e,t)=>{if(!(e in k)){let a=Object.keys(k);throw new Error(`Invalid template format. Got \`${e}\`;
                         should be one of ${a}`)}try{let a=t.reduce((r,i)=>(r[i]="foo",r),{});f(s,e,a)}catch{throw new Error("Invalid prompt schema.")}}});var F={};W(F,{PromptTemplate:()=>l});var l,h=w(()=>{y();_();l=class extends p{constructor(e){if(super(e),Object.defineProperty(this,"template",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.assign(this,e),this.validateTemplate){let t=this.inputVariables;this.partialVariables&&(t=t.concat(Object.keys(this.partialVariables))),E(this.template,this.templateFormat,t)}}_getPromptType(){return"prompt"}async format(e){let t=await this.mergePartialAndUserVariables(e);return f(this.template,this.templateFormat,t)}static fromExamples(e,t,a,r=`

`,i=""){let n=[i,...e,t].join(r);return new l({inputVariables:a,template:n})}static fromTemplate(e,{templateFormat:t="f-string",...a}={}){let r=new Set;return A(e,t).forEach(i=>{i.type==="variable"&&r.add(i.name)}),new l({inputVariables:[...r],templateFormat:t,template:e,...a})}async partial(e){let t={...this};return t.inputVariables=this.inputVariables.filter(a=>!(a in e)),t.partialVariables={...this.partialVariables??{},...e},new l(t)}serialize(){if(this.outputParser!==void 0)throw new Error("Cannot serialize a prompt template with an output parser");return{_type:this._getPromptType(),input_variables:this.inputVariables,template:this.template,template_format:this.templateFormat}}static async deserialize(e){if(!e.template)throw new Error("Prompt template must have a template");return new l({inputVariables:e.input_variables,template:e.template,templateFormat:e.template_format})}}});var Q={};W(Q,{FewShotPromptTemplate:()=>u});var u,I=w(()=>{y();_();h();u=class extends p{constructor(e){if(super(e),Object.defineProperty(this,"examples",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleSelector",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"examplePrompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"suffix",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"exampleSeparator",{enumerable:!0,configurable:!0,writable:!0,value:`

`}),Object.defineProperty(this,"prefix",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.assign(this,e),this.examples!==void 0&&this.exampleSelector!==void 0)throw new Error("Only one of 'examples' and 'example_selector' should be provided");if(this.examples===void 0&&this.exampleSelector===void 0)throw new Error("One of 'examples' and 'example_selector' should be provided");if(this.validateTemplate){let t=this.inputVariables;this.partialVariables&&(t=t.concat(Object.keys(this.partialVariables))),E(this.prefix+this.suffix,this.templateFormat,t)}}_getPromptType(){return"few_shot"}async getExamples(e){if(this.examples!==void 0)return this.examples;if(this.exampleSelector!==void 0)return this.exampleSelector.selectExamples(e);throw new Error("One of 'examples' and 'example_selector' should be provided")}async partial(e){let t={...this};return t.inputVariables=this.inputVariables.filter(a=>!(a in e)),t.partialVariables={...this.partialVariables??{},...e},new u(t)}async format(e){let t=await this.mergePartialAndUserVariables(e),a=await this.getExamples(t),r=await Promise.all(a.map(n=>this.examplePrompt.format(n))),i=[this.prefix,...r,this.suffix].join(this.exampleSeparator);return f(i,this.templateFormat,t)}serialize(){if(this.exampleSelector||!this.examples)throw new Error("Serializing an example selector is not currently supported");if(this.outputParser!==void 0)throw new Error("Serializing an output parser is not currently supported");return{_type:this._getPromptType(),input_variables:this.inputVariables,example_prompt:this.examplePrompt.serialize(),example_separator:this.exampleSeparator,suffix:this.suffix,prefix:this.prefix,template_format:this.templateFormat,examples:this.examples}}static async deserialize(e){let{example_prompt:t}=e;if(!t)throw new Error("Missing example prompt");let a=await l.deserialize(t),r;if(Array.isArray(e.examples))r=e.examples;else throw new Error("Invalid examples format. Only list or string are supported.");return new u({inputVariables:e.input_variables,examplePrompt:a,examples:r,exampleSeparator:e.example_separator,prefix:e.prefix,suffix:e.suffix,templateFormat:e.template_format})}}});var S,b,p,D,y=w(()=>{L();S=class{constructor(e){Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.value=e}toString(){return this.value}toChatMessages(){return[new c(this.value)]}},b=class{constructor(e){Object.defineProperty(this,"inputVariables",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputParser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"partialVariables",{enumerable:!0,configurable:!0,writable:!0,value:void 0});let{inputVariables:t}=e;if(t.includes("stop"))throw new Error("Cannot have an input variable named 'stop', as it is used internally, please rename.");Object.assign(this,e)}async mergePartialAndUserVariables(e){let t=this.partialVariables??{},a={};for(let[i,n]of Object.entries(t))typeof n=="string"?a[i]=n:a[i]=await n();return{...a,...e}}static async deserialize(e){switch(e._type){case"prompt":{let{PromptTemplate:t}=await Promise.resolve().then(()=>(h(),F));return t.deserialize(e)}case void 0:{let{PromptTemplate:t}=await Promise.resolve().then(()=>(h(),F));return t.deserialize({...e,_type:"prompt"})}case"few_shot":{let{FewShotPromptTemplate:t}=await Promise.resolve().then(()=>(I(),Q));return t.deserialize(e)}default:throw new Error(`Invalid prompt type in config: ${e._type}`)}}},p=class extends b{async formatPromptValue(e){let t=await this.format(e);return new S(t)}},D=class{}});y();h();function X(s){return s.split(/\n| /).length}var v=class{constructor(e){Object.defineProperty(this,"examples",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"examplePrompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"getTextLength",{enumerable:!0,configurable:!0,writable:!0,value:X}),Object.defineProperty(this,"maxLength",{enumerable:!0,configurable:!0,writable:!0,value:2048}),Object.defineProperty(this,"exampleTextLengths",{enumerable:!0,configurable:!0,writable:!0,value:[]}),this.examplePrompt=e.examplePrompt,this.maxLength=e.maxLength??2048,this.getTextLength=e.getTextLength??X}async addExample(e){this.examples.push(e);let t=await this.examplePrompt.format(e);this.exampleTextLengths.push(this.getTextLength(t))}async calculateExampleTextLengths(e,t){if(e.length>0)return e;let{examples:a,examplePrompt:r}=t;return(await Promise.all(a.map(n=>r.format(n)))).map(n=>this.getTextLength(n))}async selectExamples(e){let t=Object.values(e).join(" "),a=this.maxLength-this.getTextLength(t),r=0,i=[];for(;a>0&&r<this.examples.length;){let n=a-this.exampleTextLengths[r];if(n<0)break;i.push(this.examples[r]),a=n,r+=1}return i}static async fromExamples(e,t){let a=new v(t);return await Promise.all(e.map(r=>a.addExample(r))),a}};var K=class{constructor(e){Object.defineProperty(this,"pageContent",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.pageContent=e?.pageContent??this.pageContent,this.metadata=e?.metadata??{}}};function N(s){return Object.keys(s).sort().map(e=>s[e])}var P=class{constructor(e){Object.defineProperty(this,"vectorStore",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"k",{enumerable:!0,configurable:!0,writable:!0,value:4}),Object.defineProperty(this,"exampleKeys",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputKeys",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.vectorStore=e.vectorStore,this.k=e.k??4,this.exampleKeys=e.exampleKeys,this.inputKeys=e.inputKeys}async addExample(e){let t=this.inputKeys??Object.keys(e),a=N(t.reduce((r,i)=>({...r,[i]:e[i]}),{})).join(" ");await this.vectorStore.addDocuments([new K({pageContent:a,metadata:{example:e}})])}async selectExamples(e){let t=this.inputKeys??Object.keys(e),a=N(t.reduce((n,o)=>({...n,[o]:e[o]}),{})).join(" "),i=(await this.vectorStore.similaritySearch(a,this.k)).map(n=>n.metadata);return this.exampleKeys?i.map(n=>this.exampleKeys.reduce((o,g)=>({...o,[g]:n[g]}),{})):i}static async fromExamples(e,t,a,r={}){let i=r.inputKeys??null,n=e.map(g=>N(i?i.reduce((Y,q)=>({...Y,[q]:g[q]}),{}):g).join(" ")),o=await a.fromTexts(n,e,t,r);return new P({vectorStore:o,k:r.k??4,exampleKeys:r.exampleKeys,inputKeys:r.inputKeys})}};I();y();L();h();var M=class{serialize(){return{_type:this.constructor.name,...JSON.parse(JSON.stringify(this))}}},U=class extends T{constructor(e){super(),Object.defineProperty(this,"messages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.messages=e}toString(){return JSON.stringify(this.messages)}toChatMessages(){return this.messages}},$=class extends M{constructor(e){super(),Object.defineProperty(this,"variableName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.variableName=e}get inputVariables(){return[this.variableName]}formatMessages(e){return Promise.resolve(e[this.variableName])}},x=class extends M{constructor(e){super(),Object.defineProperty(this,"prompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.prompt=e}get inputVariables(){return this.prompt.inputVariables}async formatMessages(e){return[await this.format(e)]}},z=class extends b{constructor(e){super(e)}async format(e){return(await this.formatPromptValue(e)).toString()}async formatPromptValue(e){let t=await this.formatMessages(e);return new U(t)}},C=class extends x{async format(e){return new O(await this.prompt.format(e),this.role)}constructor(e,t){super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=t}static fromTemplate(e,t){return new this(l.fromTemplate(e),t)}},G=class extends x{async format(e){return new c(await this.prompt.format(e))}constructor(e){super(e)}static fromTemplate(e){return new this(l.fromTemplate(e))}},J=class extends x{async format(e){return new V(await this.prompt.format(e))}constructor(e){super(e)}static fromTemplate(e){return new this(l.fromTemplate(e))}},R=class extends x{async format(e){return new j(await this.prompt.format(e))}constructor(e){super(e)}static fromTemplate(e){return new this(l.fromTemplate(e))}},d=class extends z{constructor(e){if(super(e),Object.defineProperty(this,"promptMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.assign(this,e),this.validateTemplate){let t=new Set;for(let n of this.promptMessages)for(let o of n.inputVariables)t.add(o);let a=new Set(this.partialVariables?this.inputVariables.concat(Object.keys(this.partialVariables)):this.inputVariables),r=new Set([...a].filter(n=>!t.has(n)));if(r.size>0)throw new Error(`Input variables \`${[...r]}\` are not used in any of the prompt messages.`);let i=new Set([...t].filter(n=>!a.has(n)));if(i.size>0)throw new Error(`Input variables \`${[...i]}\` are used in prompt messages but not in the prompt template.`)}}_getPromptType(){return"chat"}async formatMessages(e){let t=await this.mergePartialAndUserVariables(e),a=[];for(let r of this.promptMessages){let i={};for(let o of r.inputVariables){if(!(o in t))throw new Error(`Missing value for input variable \`${o}\``);i[o]=t[o]}let n=await r.formatMessages(i);a=a.concat(n)}return a}serialize(){if(this.outputParser!==void 0)throw new Error("ChatPromptTemplate cannot be serialized if outputParser is set");return{input_variables:this.inputVariables,prompt_messages:this.promptMessages.map(e=>e.serialize())}}async partial(e){let t={...this};return t.inputVariables=this.inputVariables.filter(a=>!(a in e)),t.partialVariables={...this.partialVariables??{},...e},new d(t)}static fromPromptMessages(e){let t=new Set;for(let a of e)for(let r of a.inputVariables)t.add(r);return new d({inputVariables:[...t],promptMessages:e})}};_();export{J as AIMessagePromptTemplate,z as BaseChatPromptTemplate,D as BaseExampleSelector,b as BasePromptTemplate,p as BaseStringPromptTemplate,C as ChatMessagePromptTemplate,d as ChatPromptTemplate,u as FewShotPromptTemplate,G as HumanMessagePromptTemplate,v as LengthBasedExampleSelector,$ as MessagesPlaceholder,l as PromptTemplate,P as SemanticSimilarityExampleSelector,S as StringPromptValue,R as SystemMessagePromptTemplate,A as parseTemplate,f as renderTemplate};
//# sourceMappingURL=prompts.js.map