/* esm.sh - esbuild bundle(ml-matrix@6.10.4) deno production */
import{isAnyArray as rt}from"/v120/is-any-array@2.0.1/deno/is-any-array.mjs";import _t from"/v120/ml-array-rescale@1.3.7/deno/ml-array-rescale.mjs";var wt=" ".repeat(2),vt=" ".repeat(4);function qt(){return It(this)}function It(n,s={}){let{maxRows:e=15,maxColumns:t=10,maxNumSize:o=8,padMinus:r="auto"}=s;return`${n.constructor.name} {
${wt}[
${vt}${he(n,e,t,o,r)}
${wt}]
${wt}rows: ${n.rows}
${wt}columns: ${n.columns}
}`}function he(n,s,e,t,o){let{rows:r,columns:l}=n,i=Math.min(r,s),h=Math.min(l,e),u=[];if(o==="auto"){o=!1;t:for(let g=0;g<i;g++)for(let f=0;f<h;f++)if(n.get(g,f)<0){o=!0;break t}}for(let g=0;g<i;g++){let f=[];for(let a=0;a<h;a++)f.push(ue(n.get(g,a),t,o));u.push(`${f.join(" ")}`)}return h!==l&&(u[u.length-1]+=` ... ${l-e} more columns`),i!==r&&u.push(`... ${r-s} more rows`),u.join(`
${vt}`)}function ue(n,s,e){return(n>=0&&e?` ${Nt(n,s-1)}`:Nt(n,s)).padEnd(s)}function Nt(n,s){let e=n.toString();if(e.length<=s)return e;let t=n.toFixed(s);if(t.length>s&&(t=n.toFixed(Math.max(0,s-(t.length-s)))),t.length<=s&&!t.startsWith("0.000")&&!t.startsWith("-0.000"))return t;let o=n.toExponential(s);return o.length>s&&(o=n.toExponential(Math.max(0,s-(o.length-s)))),o.slice(0)}function Tt(n,s){n.prototype.add=function(t){return typeof t=="number"?this.addS(t):this.addM(t)},n.prototype.addS=function(t){for(let o=0;o<this.rows;o++)for(let r=0;r<this.columns;r++)this.set(o,r,this.get(o,r)+t);return this},n.prototype.addM=function(t){if(t=s.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let o=0;o<this.rows;o++)for(let r=0;r<this.columns;r++)this.set(o,r,this.get(o,r)+t.get(o,r));return this},n.add=function(t,o){return new s(t).add(o)},n.prototype.sub=function(t){return typeof t=="number"?this.subS(t):this.subM(t)},n.prototype.subS=function(t){for(let o=0;o<this.rows;o++)for(let r=0;r<this.columns;r++)this.set(o,r,this.get(o,r)-t);return this},n.prototype.subM=function(t){if(t=s.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let o=0;o<this.rows;o++)for(let r=0;r<this.columns;r++)this.set(o,r,this.get(o,r)-t.get(o,r));return this},n.sub=function(t,o){return new s(t).sub(o)},n.prototype.subtract=n.prototype.sub,n.prototype.subtractS=n.prototype.subS,n.prototype.subtractM=n.prototype.subM,n.subtract=n.sub,n.prototype.mul=function(t){return typeof t=="number"?this.mulS(t):this.mulM(t)},n.prototype.mulS=function(t){for(let o=0;o<this.rows;o++)for(let r=0;r<this.columns;r++)this.set(o,r,this.get(o,r)*t);return this},n.prototype.mulM=function(t){if(t=s.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let o=0;o<this.rows;o++)for(let r=0;r<this.columns;r++)this.set(o,r,this.get(o,r)*t.get(o,r));return this},n.mul=function(t,o){return new s(t).mul(o)},n.prototype.multiply=n.prototype.mul,n.prototype.multiplyS=n.prototype.mulS,n.prototype.multiplyM=n.prototype.mulM,n.multiply=n.mul,n.prototype.div=function(t){return typeof t=="number"?this.divS(t):this.divM(t)},n.prototype.divS=function(t){for(let o=0;o<this.rows;o++)for(let r=0;r<this.columns;r++)this.set(o,r,this.get(o,r)/t);return this},n.prototype.divM=function(t){if(t=s.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let o=0;o<this.rows;o++)for(let r=0;r<this.columns;r++)this.set(o,r,this.get(o,r)/t.get(o,r));return this},n.div=function(t,o){return new s(t).div(o)},n.prototype.divide=n.prototype.div,n.prototype.divideS=n.prototype.divS,n.prototype.divideM=n.prototype.divM,n.divide=n.div,n.prototype.mod=function(t){return typeof t=="number"?this.modS(t):this.modM(t)},n.prototype.modS=function(t){for(let o=0;o<this.rows;o++)for(let r=0;r<this.columns;r++)this.set(o,r,this.get(o,r)%t);return this},n.prototype.modM=function(t){if(t=s.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let o=0;o<this.rows;o++)for(let r=0;r<this.columns;r++)this.set(o,r,this.get(o,r)%t.get(o,r));return this},n.mod=function(t,o){return new s(t).mod(o)},n.prototype.modulus=n.prototype.mod,n.prototype.modulusS=n.prototype.modS,n.prototype.modulusM=n.prototype.modM,n.modulus=n.mod,n.prototype.and=function(t){return typeof t=="number"?this.andS(t):this.andM(t)},n.prototype.andS=function(t){for(let o=0;o<this.rows;o++)for(let r=0;r<this.columns;r++)this.set(o,r,this.get(o,r)&t);return this},n.prototype.andM=function(t){if(t=s.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let o=0;o<this.rows;o++)for(let r=0;r<this.columns;r++)this.set(o,r,this.get(o,r)&t.get(o,r));return this},n.and=function(t,o){return new s(t).and(o)},n.prototype.or=function(t){return typeof t=="number"?this.orS(t):this.orM(t)},n.prototype.orS=function(t){for(let o=0;o<this.rows;o++)for(let r=0;r<this.columns;r++)this.set(o,r,this.get(o,r)|t);return this},n.prototype.orM=function(t){if(t=s.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let o=0;o<this.rows;o++)for(let r=0;r<this.columns;r++)this.set(o,r,this.get(o,r)|t.get(o,r));return this},n.or=function(t,o){return new s(t).or(o)},n.prototype.xor=function(t){return typeof t=="number"?this.xorS(t):this.xorM(t)},n.prototype.xorS=function(t){for(let o=0;o<this.rows;o++)for(let r=0;r<this.columns;r++)this.set(o,r,this.get(o,r)^t);return this},n.prototype.xorM=function(t){if(t=s.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let o=0;o<this.rows;o++)for(let r=0;r<this.columns;r++)this.set(o,r,this.get(o,r)^t.get(o,r));return this},n.xor=function(t,o){return new s(t).xor(o)},n.prototype.leftShift=function(t){return typeof t=="number"?this.leftShiftS(t):this.leftShiftM(t)},n.prototype.leftShiftS=function(t){for(let o=0;o<this.rows;o++)for(let r=0;r<this.columns;r++)this.set(o,r,this.get(o,r)<<t);return this},n.prototype.leftShiftM=function(t){if(t=s.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let o=0;o<this.rows;o++)for(let r=0;r<this.columns;r++)this.set(o,r,this.get(o,r)<<t.get(o,r));return this},n.leftShift=function(t,o){return new s(t).leftShift(o)},n.prototype.signPropagatingRightShift=function(t){return typeof t=="number"?this.signPropagatingRightShiftS(t):this.signPropagatingRightShiftM(t)},n.prototype.signPropagatingRightShiftS=function(t){for(let o=0;o<this.rows;o++)for(let r=0;r<this.columns;r++)this.set(o,r,this.get(o,r)>>t);return this},n.prototype.signPropagatingRightShiftM=function(t){if(t=s.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let o=0;o<this.rows;o++)for(let r=0;r<this.columns;r++)this.set(o,r,this.get(o,r)>>t.get(o,r));return this},n.signPropagatingRightShift=function(t,o){return new s(t).signPropagatingRightShift(o)},n.prototype.rightShift=function(t){return typeof t=="number"?this.rightShiftS(t):this.rightShiftM(t)},n.prototype.rightShiftS=function(t){for(let o=0;o<this.rows;o++)for(let r=0;r<this.columns;r++)this.set(o,r,this.get(o,r)>>>t);return this},n.prototype.rightShiftM=function(t){if(t=s.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let o=0;o<this.rows;o++)for(let r=0;r<this.columns;r++)this.set(o,r,this.get(o,r)>>>t.get(o,r));return this},n.rightShift=function(t,o){return new s(t).rightShift(o)},n.prototype.zeroFillRightShift=n.prototype.rightShift,n.prototype.zeroFillRightShiftS=n.prototype.rightShiftS,n.prototype.zeroFillRightShiftM=n.prototype.rightShiftM,n.zeroFillRightShift=n.rightShift,n.prototype.not=function(){for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.set(t,o,~this.get(t,o));return this},n.not=function(t){return new s(t).not()},n.prototype.abs=function(){for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.set(t,o,Math.abs(this.get(t,o)));return this},n.abs=function(t){return new s(t).abs()},n.prototype.acos=function(){for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.set(t,o,Math.acos(this.get(t,o)));return this},n.acos=function(t){return new s(t).acos()},n.prototype.acosh=function(){for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.set(t,o,Math.acosh(this.get(t,o)));return this},n.acosh=function(t){return new s(t).acosh()},n.prototype.asin=function(){for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.set(t,o,Math.asin(this.get(t,o)));return this},n.asin=function(t){return new s(t).asin()},n.prototype.asinh=function(){for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.set(t,o,Math.asinh(this.get(t,o)));return this},n.asinh=function(t){return new s(t).asinh()},n.prototype.atan=function(){for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.set(t,o,Math.atan(this.get(t,o)));return this},n.atan=function(t){return new s(t).atan()},n.prototype.atanh=function(){for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.set(t,o,Math.atanh(this.get(t,o)));return this},n.atanh=function(t){return new s(t).atanh()},n.prototype.cbrt=function(){for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.set(t,o,Math.cbrt(this.get(t,o)));return this},n.cbrt=function(t){return new s(t).cbrt()},n.prototype.ceil=function(){for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.set(t,o,Math.ceil(this.get(t,o)));return this},n.ceil=function(t){return new s(t).ceil()},n.prototype.clz32=function(){for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.set(t,o,Math.clz32(this.get(t,o)));return this},n.clz32=function(t){return new s(t).clz32()},n.prototype.cos=function(){for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.set(t,o,Math.cos(this.get(t,o)));return this},n.cos=function(t){return new s(t).cos()},n.prototype.cosh=function(){for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.set(t,o,Math.cosh(this.get(t,o)));return this},n.cosh=function(t){return new s(t).cosh()},n.prototype.exp=function(){for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.set(t,o,Math.exp(this.get(t,o)));return this},n.exp=function(t){return new s(t).exp()},n.prototype.expm1=function(){for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.set(t,o,Math.expm1(this.get(t,o)));return this},n.expm1=function(t){return new s(t).expm1()},n.prototype.floor=function(){for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.set(t,o,Math.floor(this.get(t,o)));return this},n.floor=function(t){return new s(t).floor()},n.prototype.fround=function(){for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.set(t,o,Math.fround(this.get(t,o)));return this},n.fround=function(t){return new s(t).fround()},n.prototype.log=function(){for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.set(t,o,Math.log(this.get(t,o)));return this},n.log=function(t){return new s(t).log()},n.prototype.log1p=function(){for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.set(t,o,Math.log1p(this.get(t,o)));return this},n.log1p=function(t){return new s(t).log1p()},n.prototype.log10=function(){for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.set(t,o,Math.log10(this.get(t,o)));return this},n.log10=function(t){return new s(t).log10()},n.prototype.log2=function(){for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.set(t,o,Math.log2(this.get(t,o)));return this},n.log2=function(t){return new s(t).log2()},n.prototype.round=function(){for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.set(t,o,Math.round(this.get(t,o)));return this},n.round=function(t){return new s(t).round()},n.prototype.sign=function(){for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.set(t,o,Math.sign(this.get(t,o)));return this},n.sign=function(t){return new s(t).sign()},n.prototype.sin=function(){for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.set(t,o,Math.sin(this.get(t,o)));return this},n.sin=function(t){return new s(t).sin()},n.prototype.sinh=function(){for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.set(t,o,Math.sinh(this.get(t,o)));return this},n.sinh=function(t){return new s(t).sinh()},n.prototype.sqrt=function(){for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.set(t,o,Math.sqrt(this.get(t,o)));return this},n.sqrt=function(t){return new s(t).sqrt()},n.prototype.tan=function(){for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.set(t,o,Math.tan(this.get(t,o)));return this},n.tan=function(t){return new s(t).tan()},n.prototype.tanh=function(){for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.set(t,o,Math.tanh(this.get(t,o)));return this},n.tanh=function(t){return new s(t).tanh()},n.prototype.trunc=function(){for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.set(t,o,Math.trunc(this.get(t,o)));return this},n.trunc=function(t){return new s(t).trunc()},n.pow=function(t,o){return new s(t).pow(o)},n.prototype.pow=function(t){return typeof t=="number"?this.powS(t):this.powM(t)},n.prototype.powS=function(t){for(let o=0;o<this.rows;o++)for(let r=0;r<this.columns;r++)this.set(o,r,Math.pow(this.get(o,r),t));return this},n.prototype.powM=function(t){if(t=s.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let o=0;o<this.rows;o++)for(let r=0;r<this.columns;r++)this.set(o,r,Math.pow(this.get(o,r),t.get(o,r)));return this}}import{isAnyArray as Ft}from"/v120/is-any-array@2.0.1/deno/is-any-array.mjs";function Q(n,s,e){let t=e?n.rows:n.rows-1;if(s<0||s>t)throw new RangeError("Row index out of range")}function G(n,s,e){let t=e?n.columns:n.columns-1;if(s<0||s>t)throw new RangeError("Column index out of range")}function et(n,s){if(s.to1DArray&&(s=s.to1DArray()),s.length!==n.columns)throw new RangeError("vector size must be the same as the number of columns");return s}function st(n,s){if(s.to1DArray&&(s=s.to1DArray()),s.length!==n.rows)throw new RangeError("vector size must be the same as the number of rows");return s}function it(n,s){if(!Ft(s))throw new TypeError("row indices must be an array");for(let e=0;e<s.length;e++)if(s[e]<0||s[e]>=n.rows)throw new RangeError("row indices are out of range")}function lt(n,s){if(!Ft(s))throw new TypeError("column indices must be an array");for(let e=0;e<s.length;e++)if(s[e]<0||s[e]>=n.columns)throw new RangeError("column indices are out of range")}function ut(n,s,e,t,o){if(arguments.length!==5)throw new RangeError("expected 4 arguments");if(at("startRow",s),at("endRow",e),at("startColumn",t),at("endColumn",o),s>e||t>o||s<0||s>=n.rows||e<0||e>=n.rows||t<0||t>=n.columns||o<0||o>=n.columns)throw new RangeError("Submatrix indices are out of range")}function ft(n,s=0){let e=[];for(let t=0;t<n;t++)e.push(s);return e}function at(n,s){if(typeof s!="number")throw new TypeError(`${n} must be a number`)}function ot(n){if(n.isEmpty())throw new Error("Empty matrix has no elements to index")}function Bt(n){let s=ft(n.rows);for(let e=0;e<n.rows;++e)for(let t=0;t<n.columns;++t)s[e]+=n.get(e,t);return s}function Dt(n){let s=ft(n.columns);for(let e=0;e<n.rows;++e)for(let t=0;t<n.columns;++t)s[t]+=n.get(e,t);return s}function $t(n){let s=0;for(let e=0;e<n.rows;e++)for(let t=0;t<n.columns;t++)s+=n.get(e,t);return s}function Lt(n){let s=ft(n.rows,1);for(let e=0;e<n.rows;++e)for(let t=0;t<n.columns;++t)s[e]*=n.get(e,t);return s}function Pt(n){let s=ft(n.columns,1);for(let e=0;e<n.rows;++e)for(let t=0;t<n.columns;++t)s[t]*=n.get(e,t);return s}function Ct(n){let s=1;for(let e=0;e<n.rows;e++)for(let t=0;t<n.columns;t++)s*=n.get(e,t);return s}function zt(n,s,e){let t=n.rows,o=n.columns,r=[];for(let l=0;l<t;l++){let i=0,h=0,u=0;for(let g=0;g<o;g++)u=n.get(l,g)-e[l],i+=u,h+=u*u;s?r.push((h-i*i/o)/(o-1)):r.push((h-i*i/o)/o)}return r}function Vt(n,s,e){let t=n.rows,o=n.columns,r=[];for(let l=0;l<o;l++){let i=0,h=0,u=0;for(let g=0;g<t;g++)u=n.get(g,l)-e[l],i+=u,h+=u*u;s?r.push((h-i*i/t)/(t-1)):r.push((h-i*i/t)/t)}return r}function Ut(n,s,e){let t=n.rows,o=n.columns,r=t*o,l=0,i=0,h=0;for(let u=0;u<t;u++)for(let g=0;g<o;g++)h=n.get(u,g)-e,l+=h,i+=h*h;return s?(i-l*l/r)/(r-1):(i-l*l/r)/r}function Ot(n,s){for(let e=0;e<n.rows;e++)for(let t=0;t<n.columns;t++)n.set(e,t,n.get(e,t)-s[e])}function Wt(n,s){for(let e=0;e<n.rows;e++)for(let t=0;t<n.columns;t++)n.set(e,t,n.get(e,t)-s[t])}function Yt(n,s){for(let e=0;e<n.rows;e++)for(let t=0;t<n.columns;t++)n.set(e,t,n.get(e,t)-s)}function Qt(n){let s=[];for(let e=0;e<n.rows;e++){let t=0;for(let o=0;o<n.columns;o++)t+=Math.pow(n.get(e,o),2)/(n.columns-1);s.push(Math.sqrt(t))}return s}function Gt(n,s){for(let e=0;e<n.rows;e++)for(let t=0;t<n.columns;t++)n.set(e,t,n.get(e,t)/s[e])}function Jt(n){let s=[];for(let e=0;e<n.columns;e++){let t=0;for(let o=0;o<n.rows;o++)t+=Math.pow(n.get(o,e),2)/(n.rows-1);s.push(Math.sqrt(t))}return s}function Kt(n,s){for(let e=0;e<n.rows;e++)for(let t=0;t<n.columns;t++)n.set(e,t,n.get(e,t)/s[t])}function Xt(n){let s=n.size-1,e=0;for(let t=0;t<n.columns;t++)for(let o=0;o<n.rows;o++)e+=Math.pow(n.get(o,t),2)/s;return Math.sqrt(e)}function Zt(n,s){for(let e=0;e<n.rows;e++)for(let t=0;t<n.columns;t++)n.set(e,t,n.get(e,t)/s)}var v=class{static from1DArray(s,e,t){if(s*e!==t.length)throw new RangeError("data length does not match given dimensions");let r=new S(s,e);for(let l=0;l<s;l++)for(let i=0;i<e;i++)r.set(l,i,t[l*e+i]);return r}static rowVector(s){let e=new S(1,s.length);for(let t=0;t<s.length;t++)e.set(0,t,s[t]);return e}static columnVector(s){let e=new S(s.length,1);for(let t=0;t<s.length;t++)e.set(t,0,s[t]);return e}static zeros(s,e){return new S(s,e)}static ones(s,e){return new S(s,e).fill(1)}static rand(s,e,t={}){if(typeof t!="object")throw new TypeError("options must be an object");let{random:o=Math.random}=t,r=new S(s,e);for(let l=0;l<s;l++)for(let i=0;i<e;i++)r.set(l,i,o());return r}static randInt(s,e,t={}){if(typeof t!="object")throw new TypeError("options must be an object");let{min:o=0,max:r=1e3,random:l=Math.random}=t;if(!Number.isInteger(o))throw new TypeError("min must be an integer");if(!Number.isInteger(r))throw new TypeError("max must be an integer");if(o>=r)throw new RangeError("min must be smaller than max");let i=r-o,h=new S(s,e);for(let u=0;u<s;u++)for(let g=0;g<e;g++){let f=o+Math.round(l()*i);h.set(u,g,f)}return h}static eye(s,e,t){e===void 0&&(e=s),t===void 0&&(t=1);let o=Math.min(s,e),r=this.zeros(s,e);for(let l=0;l<o;l++)r.set(l,l,t);return r}static diag(s,e,t){let o=s.length;e===void 0&&(e=o),t===void 0&&(t=e);let r=Math.min(o,e,t),l=this.zeros(e,t);for(let i=0;i<r;i++)l.set(i,i,s[i]);return l}static min(s,e){s=this.checkMatrix(s),e=this.checkMatrix(e);let t=s.rows,o=s.columns,r=new S(t,o);for(let l=0;l<t;l++)for(let i=0;i<o;i++)r.set(l,i,Math.min(s.get(l,i),e.get(l,i)));return r}static max(s,e){s=this.checkMatrix(s),e=this.checkMatrix(e);let t=s.rows,o=s.columns,r=new this(t,o);for(let l=0;l<t;l++)for(let i=0;i<o;i++)r.set(l,i,Math.max(s.get(l,i),e.get(l,i)));return r}static checkMatrix(s){return v.isMatrix(s)?s:new S(s)}static isMatrix(s){return s!=null&&s.klass==="Matrix"}get size(){return this.rows*this.columns}apply(s){if(typeof s!="function")throw new TypeError("callback must be a function");for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)s.call(this,e,t);return this}to1DArray(){let s=[];for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)s.push(this.get(e,t));return s}to2DArray(){let s=[];for(let e=0;e<this.rows;e++){s.push([]);for(let t=0;t<this.columns;t++)s[e].push(this.get(e,t))}return s}toJSON(){return this.to2DArray()}isRowVector(){return this.rows===1}isColumnVector(){return this.columns===1}isVector(){return this.rows===1||this.columns===1}isSquare(){return this.rows===this.columns}isEmpty(){return this.rows===0||this.columns===0}isSymmetric(){if(this.isSquare()){for(let s=0;s<this.rows;s++)for(let e=0;e<=s;e++)if(this.get(s,e)!==this.get(e,s))return!1;return!0}return!1}isEchelonForm(){let s=0,e=0,t=-1,o=!0,r=!1;for(;s<this.rows&&o;){for(e=0,r=!1;e<this.columns&&r===!1;)this.get(s,e)===0?e++:this.get(s,e)===1&&e>t?(r=!0,t=e):(o=!1,r=!0);s++}return o}isReducedEchelonForm(){let s=0,e=0,t=-1,o=!0,r=!1;for(;s<this.rows&&o;){for(e=0,r=!1;e<this.columns&&r===!1;)this.get(s,e)===0?e++:this.get(s,e)===1&&e>t?(r=!0,t=e):(o=!1,r=!0);for(let l=e+1;l<this.rows;l++)this.get(s,l)!==0&&(o=!1);s++}return o}echelonForm(){let s=this.clone(),e=0,t=0;for(;e<s.rows&&t<s.columns;){let o=e;for(let r=e;r<s.rows;r++)s.get(r,t)>s.get(o,t)&&(o=r);if(s.get(o,t)===0)t++;else{s.swapRows(e,o);let r=s.get(e,t);for(let l=t;l<s.columns;l++)s.set(e,l,s.get(e,l)/r);for(let l=e+1;l<s.rows;l++){let i=s.get(l,t)/s.get(e,t);s.set(l,t,0);for(let h=t+1;h<s.columns;h++)s.set(l,h,s.get(l,h)-s.get(e,h)*i)}e++,t++}}return s}reducedEchelonForm(){let s=this.echelonForm(),e=s.columns,t=s.rows,o=t-1;for(;o>=0;)if(s.maxRow(o)===0)o--;else{let r=0,l=!1;for(;r<t&&l===!1;)s.get(o,r)===1?l=!0:r++;for(let i=0;i<o;i++){let h=s.get(i,r);for(let u=r;u<e;u++){let g=s.get(i,u)-h*s.get(o,u);s.set(i,u,g)}}o--}return s}set(){throw new Error("set method is unimplemented")}get(){throw new Error("get method is unimplemented")}repeat(s={}){if(typeof s!="object")throw new TypeError("options must be an object");let{rows:e=1,columns:t=1}=s;if(!Number.isInteger(e)||e<=0)throw new TypeError("rows must be a positive integer");if(!Number.isInteger(t)||t<=0)throw new TypeError("columns must be a positive integer");let o=new S(this.rows*e,this.columns*t);for(let r=0;r<e;r++)for(let l=0;l<t;l++)o.setSubMatrix(this,this.rows*r,this.columns*l);return o}fill(s){for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,s);return this}neg(){return this.mulS(-1)}getRow(s){Q(this,s);let e=[];for(let t=0;t<this.columns;t++)e.push(this.get(s,t));return e}getRowVector(s){return S.rowVector(this.getRow(s))}setRow(s,e){Q(this,s),e=et(this,e);for(let t=0;t<this.columns;t++)this.set(s,t,e[t]);return this}swapRows(s,e){Q(this,s),Q(this,e);for(let t=0;t<this.columns;t++){let o=this.get(s,t);this.set(s,t,this.get(e,t)),this.set(e,t,o)}return this}getColumn(s){G(this,s);let e=[];for(let t=0;t<this.rows;t++)e.push(this.get(t,s));return e}getColumnVector(s){return S.columnVector(this.getColumn(s))}setColumn(s,e){G(this,s),e=st(this,e);for(let t=0;t<this.rows;t++)this.set(t,s,e[t]);return this}swapColumns(s,e){G(this,s),G(this,e);for(let t=0;t<this.rows;t++){let o=this.get(t,s);this.set(t,s,this.get(t,e)),this.set(t,e,o)}return this}addRowVector(s){s=et(this,s);for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,this.get(e,t)+s[t]);return this}subRowVector(s){s=et(this,s);for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,this.get(e,t)-s[t]);return this}mulRowVector(s){s=et(this,s);for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,this.get(e,t)*s[t]);return this}divRowVector(s){s=et(this,s);for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,this.get(e,t)/s[t]);return this}addColumnVector(s){s=st(this,s);for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,this.get(e,t)+s[e]);return this}subColumnVector(s){s=st(this,s);for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,this.get(e,t)-s[e]);return this}mulColumnVector(s){s=st(this,s);for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,this.get(e,t)*s[e]);return this}divColumnVector(s){s=st(this,s);for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,this.get(e,t)/s[e]);return this}mulRow(s,e){Q(this,s);for(let t=0;t<this.columns;t++)this.set(s,t,this.get(s,t)*e);return this}mulColumn(s,e){G(this,s);for(let t=0;t<this.rows;t++)this.set(t,s,this.get(t,s)*e);return this}max(s){if(this.isEmpty())return NaN;switch(s){case"row":{let e=new Array(this.rows).fill(Number.NEGATIVE_INFINITY);for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.get(t,o)>e[t]&&(e[t]=this.get(t,o));return e}case"column":{let e=new Array(this.columns).fill(Number.NEGATIVE_INFINITY);for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.get(t,o)>e[o]&&(e[o]=this.get(t,o));return e}case void 0:{let e=this.get(0,0);for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.get(t,o)>e&&(e=this.get(t,o));return e}default:throw new Error(`invalid option: ${s}`)}}maxIndex(){ot(this);let s=this.get(0,0),e=[0,0];for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.get(t,o)>s&&(s=this.get(t,o),e[0]=t,e[1]=o);return e}min(s){if(this.isEmpty())return NaN;switch(s){case"row":{let e=new Array(this.rows).fill(Number.POSITIVE_INFINITY);for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.get(t,o)<e[t]&&(e[t]=this.get(t,o));return e}case"column":{let e=new Array(this.columns).fill(Number.POSITIVE_INFINITY);for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.get(t,o)<e[o]&&(e[o]=this.get(t,o));return e}case void 0:{let e=this.get(0,0);for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.get(t,o)<e&&(e=this.get(t,o));return e}default:throw new Error(`invalid option: ${s}`)}}minIndex(){ot(this);let s=this.get(0,0),e=[0,0];for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.get(t,o)<s&&(s=this.get(t,o),e[0]=t,e[1]=o);return e}maxRow(s){if(Q(this,s),this.isEmpty())return NaN;let e=this.get(s,0);for(let t=1;t<this.columns;t++)this.get(s,t)>e&&(e=this.get(s,t));return e}maxRowIndex(s){Q(this,s),ot(this);let e=this.get(s,0),t=[s,0];for(let o=1;o<this.columns;o++)this.get(s,o)>e&&(e=this.get(s,o),t[1]=o);return t}minRow(s){if(Q(this,s),this.isEmpty())return NaN;let e=this.get(s,0);for(let t=1;t<this.columns;t++)this.get(s,t)<e&&(e=this.get(s,t));return e}minRowIndex(s){Q(this,s),ot(this);let e=this.get(s,0),t=[s,0];for(let o=1;o<this.columns;o++)this.get(s,o)<e&&(e=this.get(s,o),t[1]=o);return t}maxColumn(s){if(G(this,s),this.isEmpty())return NaN;let e=this.get(0,s);for(let t=1;t<this.rows;t++)this.get(t,s)>e&&(e=this.get(t,s));return e}maxColumnIndex(s){G(this,s),ot(this);let e=this.get(0,s),t=[0,s];for(let o=1;o<this.rows;o++)this.get(o,s)>e&&(e=this.get(o,s),t[0]=o);return t}minColumn(s){if(G(this,s),this.isEmpty())return NaN;let e=this.get(0,s);for(let t=1;t<this.rows;t++)this.get(t,s)<e&&(e=this.get(t,s));return e}minColumnIndex(s){G(this,s),ot(this);let e=this.get(0,s),t=[0,s];for(let o=1;o<this.rows;o++)this.get(o,s)<e&&(e=this.get(o,s),t[0]=o);return t}diag(){let s=Math.min(this.rows,this.columns),e=[];for(let t=0;t<s;t++)e.push(this.get(t,t));return e}norm(s="frobenius"){let e=0;if(s==="max")return this.max();if(s==="frobenius"){for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)e=e+this.get(t,o)*this.get(t,o);return Math.sqrt(e)}else throw new RangeError(`unknown norm type: ${s}`)}cumulativeSum(){let s=0;for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)s+=this.get(e,t),this.set(e,t,s);return this}dot(s){v.isMatrix(s)&&(s=s.to1DArray());let e=this.to1DArray();if(e.length!==s.length)throw new RangeError("vectors do not have the same size");let t=0;for(let o=0;o<e.length;o++)t+=e[o]*s[o];return t}mmul(s){s=S.checkMatrix(s);let e=this.rows,t=this.columns,o=s.columns,r=new S(e,o),l=new Float64Array(t);for(let i=0;i<o;i++){for(let h=0;h<t;h++)l[h]=s.get(h,i);for(let h=0;h<e;h++){let u=0;for(let g=0;g<t;g++)u+=this.get(h,g)*l[g];r.set(h,i,u)}}return r}strassen2x2(s){s=S.checkMatrix(s);let e=new S(2,2),t=this.get(0,0),o=s.get(0,0),r=this.get(0,1),l=s.get(0,1),i=this.get(1,0),h=s.get(1,0),u=this.get(1,1),g=s.get(1,1),f=(t+u)*(o+g),a=(i+u)*o,M=t*(l-g),w=u*(h-o),p=(t+r)*g,E=(i-t)*(o+l),c=(r-u)*(h+g),j=f+w-p+c,b=M+p,N=a+w,q=f-a+M+E;return e.set(0,0,j),e.set(0,1,b),e.set(1,0,N),e.set(1,1,q),e}strassen3x3(s){s=S.checkMatrix(s);let e=new S(3,3),t=this.get(0,0),o=this.get(0,1),r=this.get(0,2),l=this.get(1,0),i=this.get(1,1),h=this.get(1,2),u=this.get(2,0),g=this.get(2,1),f=this.get(2,2),a=s.get(0,0),M=s.get(0,1),w=s.get(0,2),p=s.get(1,0),E=s.get(1,1),c=s.get(1,2),j=s.get(2,0),b=s.get(2,1),N=s.get(2,2),q=(t+o+r-l-i-g-f)*E,$=(t-l)*(-M+E),R=i*(-a+M+p-E-c-j+N),I=(-t+l+i)*(a-M+E),D=(l+i)*(-a+M),C=t*a,m=(-t+u+g)*(a-w+c),d=(-t+u)*(w-c),k=(u+g)*(-a+w),y=(t+o+r-i-h-u-g)*c,F=g*(-a+w+p-E-c-j+b),L=(-r+g+f)*(E+j-b),W=(r-f)*(E-b),B=r*j,Y=(g+f)*(-j+b),U=(-r+i+h)*(c+j-N),A=(r-h)*(c-N),_=(i+h)*(-j+N),H=o*p,T=h*b,O=l*w,J=u*M,K=f*N,V=C+B+H,te=q+I+D+C+L+B+Y,ee=C+m+k+y+B+U+_,se=$+R+I+C+B+U+A,oe=$+I+D+C+T,re=B+U+A+_+O,ne=C+m+d+F+L+W+B,ie=L+W+B+Y+J,le=C+m+d+k+K;return e.set(0,0,V),e.set(0,1,te),e.set(0,2,ee),e.set(1,0,se),e.set(1,1,oe),e.set(1,2,re),e.set(2,0,ne),e.set(2,1,ie),e.set(2,2,le),e}mmulStrassen(s){s=S.checkMatrix(s);let e=this.clone(),t=e.rows,o=e.columns,r=s.rows,l=s.columns;o!==r&&console.warn(`Multiplying ${t} x ${o} and ${r} x ${l} matrix: dimensions do not match.`);function i(f,a,M){let w=f.rows,p=f.columns;if(w===a&&p===M)return f;{let E=v.zeros(a,M);return E=E.setSubMatrix(f,0,0),E}}let h=Math.max(t,r),u=Math.max(o,l);e=i(e,h,u),s=i(s,h,u);function g(f,a,M,w){if(M<=512||w<=512)return f.mmul(a);M%2===1&&w%2===1?(f=i(f,M+1,w+1),a=i(a,M+1,w+1)):M%2===1?(f=i(f,M+1,w),a=i(a,M+1,w)):w%2===1&&(f=i(f,M,w+1),a=i(a,M,w+1));let p=parseInt(f.rows/2,10),E=parseInt(f.columns/2,10),c=f.subMatrix(0,p-1,0,E-1),j=a.subMatrix(0,p-1,0,E-1),b=f.subMatrix(0,p-1,E,f.columns-1),N=a.subMatrix(0,p-1,E,a.columns-1),q=f.subMatrix(p,f.rows-1,0,E-1),$=a.subMatrix(p,a.rows-1,0,E-1),R=f.subMatrix(p,f.rows-1,E,f.columns-1),I=a.subMatrix(p,a.rows-1,E,a.columns-1),D=g(v.add(c,R),v.add(j,I),p,E),C=g(v.add(q,R),j,p,E),m=g(c,v.sub(N,I),p,E),d=g(R,v.sub($,j),p,E),k=g(v.add(c,b),I,p,E),y=g(v.sub(q,c),v.add(j,N),p,E),F=g(v.sub(b,R),v.add($,I),p,E),L=v.add(D,d);L.sub(k),L.add(F);let W=v.add(m,k),B=v.add(C,d),Y=v.sub(D,C);Y.add(m),Y.add(y);let U=v.zeros(2*L.rows,2*L.columns);return U=U.setSubMatrix(L,0,0),U=U.setSubMatrix(W,L.rows,0),U=U.setSubMatrix(B,0,L.columns),U=U.setSubMatrix(Y,L.rows,L.columns),U.subMatrix(0,M-1,0,w-1)}return g(e,s,h,u)}scaleRows(s={}){if(typeof s!="object")throw new TypeError("options must be an object");let{min:e=0,max:t=1}=s;if(!Number.isFinite(e))throw new TypeError("min must be a number");if(!Number.isFinite(t))throw new TypeError("max must be a number");if(e>=t)throw new RangeError("min must be smaller than max");let o=new S(this.rows,this.columns);for(let r=0;r<this.rows;r++){let l=this.getRow(r);l.length>0&&_t(l,{min:e,max:t,output:l}),o.setRow(r,l)}return o}scaleColumns(s={}){if(typeof s!="object")throw new TypeError("options must be an object");let{min:e=0,max:t=1}=s;if(!Number.isFinite(e))throw new TypeError("min must be a number");if(!Number.isFinite(t))throw new TypeError("max must be a number");if(e>=t)throw new RangeError("min must be smaller than max");let o=new S(this.rows,this.columns);for(let r=0;r<this.columns;r++){let l=this.getColumn(r);l.length&&_t(l,{min:e,max:t,output:l}),o.setColumn(r,l)}return o}flipRows(){let s=Math.ceil(this.columns/2);for(let e=0;e<this.rows;e++)for(let t=0;t<s;t++){let o=this.get(e,t),r=this.get(e,this.columns-1-t);this.set(e,t,r),this.set(e,this.columns-1-t,o)}return this}flipColumns(){let s=Math.ceil(this.rows/2);for(let e=0;e<this.columns;e++)for(let t=0;t<s;t++){let o=this.get(t,e),r=this.get(this.rows-1-t,e);this.set(t,e,r),this.set(this.rows-1-t,e,o)}return this}kroneckerProduct(s){s=S.checkMatrix(s);let e=this.rows,t=this.columns,o=s.rows,r=s.columns,l=new S(e*o,t*r);for(let i=0;i<e;i++)for(let h=0;h<t;h++)for(let u=0;u<o;u++)for(let g=0;g<r;g++)l.set(o*i+u,r*h+g,this.get(i,h)*s.get(u,g));return l}kroneckerSum(s){if(s=S.checkMatrix(s),!this.isSquare()||!s.isSquare())throw new Error("Kronecker Sum needs two Square Matrices");let e=this.rows,t=s.rows,o=this.kroneckerProduct(S.eye(t,t)),r=S.eye(e,e).kroneckerProduct(s);return o.add(r)}transpose(){let s=new S(this.columns,this.rows);for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)s.set(t,e,this.get(e,t));return s}sortRows(s=xt){for(let e=0;e<this.rows;e++)this.setRow(e,this.getRow(e).sort(s));return this}sortColumns(s=xt){for(let e=0;e<this.columns;e++)this.setColumn(e,this.getColumn(e).sort(s));return this}subMatrix(s,e,t,o){ut(this,s,e,t,o);let r=new S(e-s+1,o-t+1);for(let l=s;l<=e;l++)for(let i=t;i<=o;i++)r.set(l-s,i-t,this.get(l,i));return r}subMatrixRow(s,e,t){if(e===void 0&&(e=0),t===void 0&&(t=this.columns-1),e>t||e<0||e>=this.columns||t<0||t>=this.columns)throw new RangeError("Argument out of range");let o=new S(s.length,t-e+1);for(let r=0;r<s.length;r++)for(let l=e;l<=t;l++){if(s[r]<0||s[r]>=this.rows)throw new RangeError(`Row index out of range: ${s[r]}`);o.set(r,l-e,this.get(s[r],l))}return o}subMatrixColumn(s,e,t){if(e===void 0&&(e=0),t===void 0&&(t=this.rows-1),e>t||e<0||e>=this.rows||t<0||t>=this.rows)throw new RangeError("Argument out of range");let o=new S(t-e+1,s.length);for(let r=0;r<s.length;r++)for(let l=e;l<=t;l++){if(s[r]<0||s[r]>=this.columns)throw new RangeError(`Column index out of range: ${s[r]}`);o.set(l-e,r,this.get(l,s[r]))}return o}setSubMatrix(s,e,t){if(s=S.checkMatrix(s),s.isEmpty())return this;let o=e+s.rows-1,r=t+s.columns-1;ut(this,e,o,t,r);for(let l=0;l<s.rows;l++)for(let i=0;i<s.columns;i++)this.set(e+l,t+i,s.get(l,i));return this}selection(s,e){it(this,s),lt(this,e);let t=new S(s.length,e.length);for(let o=0;o<s.length;o++){let r=s[o];for(let l=0;l<e.length;l++){let i=e[l];t.set(o,l,this.get(r,i))}}return t}trace(){let s=Math.min(this.rows,this.columns),e=0;for(let t=0;t<s;t++)e+=this.get(t,t);return e}clone(){let s=new S(this.rows,this.columns);for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)s.set(e,t,this.get(e,t));return s}sum(s){switch(s){case"row":return Bt(this);case"column":return Dt(this);case void 0:return $t(this);default:throw new Error(`invalid option: ${s}`)}}product(s){switch(s){case"row":return Lt(this);case"column":return Pt(this);case void 0:return Ct(this);default:throw new Error(`invalid option: ${s}`)}}mean(s){let e=this.sum(s);switch(s){case"row":{for(let t=0;t<this.rows;t++)e[t]/=this.columns;return e}case"column":{for(let t=0;t<this.columns;t++)e[t]/=this.rows;return e}case void 0:return e/this.size;default:throw new Error(`invalid option: ${s}`)}}variance(s,e={}){if(typeof s=="object"&&(e=s,s=void 0),typeof e!="object")throw new TypeError("options must be an object");let{unbiased:t=!0,mean:o=this.mean(s)}=e;if(typeof t!="boolean")throw new TypeError("unbiased must be a boolean");switch(s){case"row":{if(!rt(o))throw new TypeError("mean must be an array");return zt(this,t,o)}case"column":{if(!rt(o))throw new TypeError("mean must be an array");return Vt(this,t,o)}case void 0:{if(typeof o!="number")throw new TypeError("mean must be a number");return Ut(this,t,o)}default:throw new Error(`invalid option: ${s}`)}}standardDeviation(s,e){typeof s=="object"&&(e=s,s=void 0);let t=this.variance(s,e);if(s===void 0)return Math.sqrt(t);for(let o=0;o<t.length;o++)t[o]=Math.sqrt(t[o]);return t}center(s,e={}){if(typeof s=="object"&&(e=s,s=void 0),typeof e!="object")throw new TypeError("options must be an object");let{center:t=this.mean(s)}=e;switch(s){case"row":{if(!rt(t))throw new TypeError("center must be an array");return Ot(this,t),this}case"column":{if(!rt(t))throw new TypeError("center must be an array");return Wt(this,t),this}case void 0:{if(typeof t!="number")throw new TypeError("center must be a number");return Yt(this,t),this}default:throw new Error(`invalid option: ${s}`)}}scale(s,e={}){if(typeof s=="object"&&(e=s,s=void 0),typeof e!="object")throw new TypeError("options must be an object");let t=e.scale;switch(s){case"row":{if(t===void 0)t=Qt(this);else if(!rt(t))throw new TypeError("scale must be an array");return Gt(this,t),this}case"column":{if(t===void 0)t=Jt(this);else if(!rt(t))throw new TypeError("scale must be an array");return Kt(this,t),this}case void 0:{if(t===void 0)t=Xt(this);else if(typeof t!="number")throw new TypeError("scale must be a number");return Zt(this,t),this}default:throw new Error(`invalid option: ${s}`)}}toString(s){return It(this,s)}};v.prototype.klass="Matrix";typeof Symbol<"u"&&(v.prototype[Symbol.for("nodejs.util.inspect.custom")]=qt);function xt(n,s){return n-s}function fe(n){return n.every(s=>typeof s=="number")}v.random=v.rand;v.randomInt=v.randInt;v.diagonal=v.diag;v.prototype.diagonal=v.prototype.diag;v.identity=v.eye;v.prototype.negate=v.prototype.neg;v.prototype.tensorProduct=v.prototype.kroneckerProduct;var S=class extends v{constructor(s,e){if(super(),S.isMatrix(s))return s.clone();if(Number.isInteger(s)&&s>=0)if(this.data=[],Number.isInteger(e)&&e>=0)for(let t=0;t<s;t++)this.data.push(new Float64Array(e));else throw new TypeError("nColumns must be a positive integer");else if(rt(s)){let t=s;if(s=t.length,e=s?t[0].length:0,typeof e!="number")throw new TypeError("Data must be a 2D array with at least one element");this.data=[];for(let o=0;o<s;o++){if(t[o].length!==e)throw new RangeError("Inconsistent array dimensions");if(!fe(t[o]))throw new TypeError("Input data contains non-numeric values");this.data.push(Float64Array.from(t[o]))}}else throw new TypeError("First argument must be a positive number or an array");this.rows=s,this.columns=e}set(s,e,t){return this.data[s][e]=t,this}get(s,e){return this.data[s][e]}removeRow(s){return Q(this,s),this.data.splice(s,1),this.rows-=1,this}addRow(s,e){return e===void 0&&(e=s,s=this.rows),Q(this,s,!0),e=Float64Array.from(et(this,e)),this.data.splice(s,0,e),this.rows+=1,this}removeColumn(s){G(this,s);for(let e=0;e<this.rows;e++){let t=new Float64Array(this.columns-1);for(let o=0;o<s;o++)t[o]=this.data[e][o];for(let o=s+1;o<this.columns;o++)t[o-1]=this.data[e][o];this.data[e]=t}return this.columns-=1,this}addColumn(s,e){typeof e>"u"&&(e=s,s=this.columns),G(this,s,!0),e=st(this,e);for(let t=0;t<this.rows;t++){let o=new Float64Array(this.columns+1),r=0;for(;r<s;r++)o[r]=this.data[t][r];for(o[r++]=e[t];r<this.columns+1;r++)o[r]=this.data[t][r-1];this.data[t]=o}return this.columns+=1,this}};Tt(v,S);var z=class extends v{constructor(s,e,t){super(),this.matrix=s,this.rows=e,this.columns=t}};var pt=class extends z{constructor(s,e){G(s,e),super(s,s.rows,1),this.column=e}set(s,e,t){return this.matrix.set(s,this.column,t),this}get(s){return this.matrix.get(s,this.column)}};var dt=class extends z{constructor(s,e){lt(s,e),super(s,s.rows,e.length),this.columnIndices=e}set(s,e,t){return this.matrix.set(s,this.columnIndices[e],t),this}get(s,e){return this.matrix.get(s,this.columnIndices[e])}};var yt=class extends z{constructor(s){super(s,s.rows,s.columns)}set(s,e,t){return this.matrix.set(s,this.columns-e-1,t),this}get(s,e){return this.matrix.get(s,this.columns-e-1)}};var jt=class extends z{constructor(s){super(s,s.rows,s.columns)}set(s,e,t){return this.matrix.set(this.rows-s-1,e,t),this}get(s,e){return this.matrix.get(this.rows-s-1,e)}};var Mt=class extends z{constructor(s,e){Q(s,e),super(s,1,s.columns),this.row=e}set(s,e,t){return this.matrix.set(this.row,e,t),this}get(s,e){return this.matrix.get(this.row,e)}};var St=class extends z{constructor(s,e){it(s,e),super(s,e.length,s.columns),this.rowIndices=e}set(s,e,t){return this.matrix.set(this.rowIndices[s],e,t),this}get(s,e){return this.matrix.get(this.rowIndices[s],e)}};var tt=class extends z{constructor(s,e,t){it(s,e),lt(s,t),super(s,e.length,t.length),this.rowIndices=e,this.columnIndices=t}set(s,e,t){return this.matrix.set(this.rowIndices[s],this.columnIndices[e],t),this}get(s,e){return this.matrix.get(this.rowIndices[s],this.columnIndices[e])}};var Et=class extends z{constructor(s,e,t,o,r){ut(s,e,t,o,r),super(s,t-e+1,r-o+1),this.startRow=e,this.startColumn=o}set(s,e,t){return this.matrix.set(this.startRow+s,this.startColumn+e,t),this}get(s,e){return this.matrix.get(this.startRow+s,this.startColumn+e)}};var kt=class extends z{constructor(s){super(s,s.columns,s.rows)}set(s,e,t){return this.matrix.set(e,s,t),this}get(s,e){return this.matrix.get(e,s)}};import{isAnyArray as At}from"/v120/is-any-array@2.0.1/deno/is-any-array.mjs";var ht=class extends v{constructor(s,e={}){let{rows:t=1}=e;if(s.length%t!==0)throw new Error("the data length is not divisible by the number of rows");super(),this.rows=t,this.columns=s.length/t,this.data=s}set(s,e,t){let o=this._calculateIndex(s,e);return this.data[o]=t,this}get(s,e){let t=this._calculateIndex(s,e);return this.data[t]}_calculateIndex(s,e){return s*this.columns+e}};var P=class extends v{constructor(s){super(),this.data=s,this.rows=s.length,this.columns=s[0].length}set(s,e,t){return this.data[s][e]=t,this}get(s,e){return this.data[s][e]}};function ce(n,s){if(At(n))return n[0]&&At(n[0])?new P(n):new ht(n,s);throw new Error("the argument is not an array")}var x=class{constructor(s){s=P.checkMatrix(s);let e=s.clone(),t=e.rows,o=e.columns,r=new Float64Array(t),l=1,i,h,u,g,f,a,M,w,p;for(i=0;i<t;i++)r[i]=i;for(w=new Float64Array(t),h=0;h<o;h++){for(i=0;i<t;i++)w[i]=e.get(i,h);for(i=0;i<t;i++){for(p=Math.min(i,h),f=0,u=0;u<p;u++)f+=e.get(i,u)*w[u];w[i]-=f,e.set(i,h,w[i])}for(g=h,i=h+1;i<t;i++)Math.abs(w[i])>Math.abs(w[g])&&(g=i);if(g!==h){for(u=0;u<o;u++)a=e.get(g,u),e.set(g,u,e.get(h,u)),e.set(h,u,a);M=r[g],r[g]=r[h],r[h]=M,l=-l}if(h<t&&e.get(h,h)!==0)for(i=h+1;i<t;i++)e.set(i,h,e.get(i,h)/e.get(h,h))}this.LU=e,this.pivotVector=r,this.pivotSign=l}isSingular(){let s=this.LU,e=s.columns;for(let t=0;t<e;t++)if(s.get(t,t)===0)return!0;return!1}solve(s){s=S.checkMatrix(s);let e=this.LU;if(e.rows!==s.rows)throw new Error("Invalid matrix dimensions");if(this.isSingular())throw new Error("LU matrix is singular");let o=s.columns,r=s.subMatrixRow(this.pivotVector,0,o-1),l=e.columns,i,h,u;for(u=0;u<l;u++)for(i=u+1;i<l;i++)for(h=0;h<o;h++)r.set(i,h,r.get(i,h)-r.get(u,h)*e.get(i,u));for(u=l-1;u>=0;u--){for(h=0;h<o;h++)r.set(u,h,r.get(u,h)/e.get(u,u));for(i=0;i<u;i++)for(h=0;h<o;h++)r.set(i,h,r.get(i,h)-r.get(u,h)*e.get(i,u))}return r}get determinant(){let s=this.LU;if(!s.isSquare())throw new Error("Matrix must be square");let e=this.pivotSign,t=s.columns;for(let o=0;o<t;o++)e*=s.get(o,o);return e}get lowerTriangularMatrix(){let s=this.LU,e=s.rows,t=s.columns,o=new S(e,t);for(let r=0;r<e;r++)for(let l=0;l<t;l++)r>l?o.set(r,l,s.get(r,l)):r===l?o.set(r,l,1):o.set(r,l,0);return o}get upperTriangularMatrix(){let s=this.LU,e=s.rows,t=s.columns,o=new S(e,t);for(let r=0;r<e;r++)for(let l=0;l<t;l++)r<=l?o.set(r,l,s.get(r,l)):o.set(r,l,0);return o}get pivotPermutationVector(){return Array.from(this.pivotVector)}};function X(n,s){let e=0;return Math.abs(n)>Math.abs(s)?(e=s/n,Math.abs(n)*Math.sqrt(1+e*e)):s!==0?(e=n/s,Math.abs(s)*Math.sqrt(1+e*e)):0}var nt=class{constructor(s){s=P.checkMatrix(s);let e=s.clone(),t=s.rows,o=s.columns,r=new Float64Array(o),l,i,h,u;for(h=0;h<o;h++){let g=0;for(l=h;l<t;l++)g=X(g,e.get(l,h));if(g!==0){for(e.get(h,h)<0&&(g=-g),l=h;l<t;l++)e.set(l,h,e.get(l,h)/g);for(e.set(h,h,e.get(h,h)+1),i=h+1;i<o;i++){for(u=0,l=h;l<t;l++)u+=e.get(l,h)*e.get(l,i);for(u=-u/e.get(h,h),l=h;l<t;l++)e.set(l,i,e.get(l,i)+u*e.get(l,h))}}r[h]=-g}this.QR=e,this.Rdiag=r}solve(s){s=S.checkMatrix(s);let e=this.QR,t=e.rows;if(s.rows!==t)throw new Error("Matrix row dimensions must agree");if(!this.isFullRank())throw new Error("Matrix is rank deficient");let o=s.columns,r=s.clone(),l=e.columns,i,h,u,g;for(u=0;u<l;u++)for(h=0;h<o;h++){for(g=0,i=u;i<t;i++)g+=e.get(i,u)*r.get(i,h);for(g=-g/e.get(u,u),i=u;i<t;i++)r.set(i,h,r.get(i,h)+g*e.get(i,u))}for(u=l-1;u>=0;u--){for(h=0;h<o;h++)r.set(u,h,r.get(u,h)/this.Rdiag[u]);for(i=0;i<u;i++)for(h=0;h<o;h++)r.set(i,h,r.get(i,h)-r.get(u,h)*e.get(i,u))}return r.subMatrix(0,l-1,0,o-1)}isFullRank(){let s=this.QR.columns;for(let e=0;e<s;e++)if(this.Rdiag[e]===0)return!1;return!0}get upperTriangularMatrix(){let s=this.QR,e=s.columns,t=new S(e,e),o,r;for(o=0;o<e;o++)for(r=0;r<e;r++)o<r?t.set(o,r,s.get(o,r)):o===r?t.set(o,r,this.Rdiag[o]):t.set(o,r,0);return t}get orthogonalMatrix(){let s=this.QR,e=s.rows,t=s.columns,o=new S(e,t),r,l,i,h;for(i=t-1;i>=0;i--){for(r=0;r<e;r++)o.set(r,i,0);for(o.set(i,i,1),l=i;l<t;l++)if(s.get(i,i)!==0){for(h=0,r=i;r<e;r++)h+=s.get(r,i)*o.get(r,l);for(h=-h/s.get(i,i),r=i;r<e;r++)o.set(r,l,o.get(r,l)+h*s.get(r,i))}}return o}};var Z=class{constructor(s,e={}){if(s=P.checkMatrix(s),s.isEmpty())throw new Error("Matrix must be non-empty");let t=s.rows,o=s.columns,{computeLeftSingularVectors:r=!0,computeRightSingularVectors:l=!0,autoTranspose:i=!1}=e,h=!!r,u=!!l,g=!1,f;if(t<o)if(!i)f=s.clone(),console.warn("Computing SVD on a matrix with more columns than rows. Consider enabling autoTranspose");else{f=s.transpose(),t=f.rows,o=f.columns,g=!0;let m=h;h=u,u=m}else f=s.clone();let a=Math.min(t,o),M=Math.min(t+1,o),w=new Float64Array(M),p=new S(t,a),E=new S(o,o),c=new Float64Array(o),j=new Float64Array(t),b=new Float64Array(M);for(let m=0;m<M;m++)b[m]=m;let N=Math.min(t-1,o),q=Math.max(0,Math.min(o-2,t)),$=Math.max(N,q);for(let m=0;m<$;m++){if(m<N){w[m]=0;for(let d=m;d<t;d++)w[m]=X(w[m],f.get(d,m));if(w[m]!==0){f.get(m,m)<0&&(w[m]=-w[m]);for(let d=m;d<t;d++)f.set(d,m,f.get(d,m)/w[m]);f.set(m,m,f.get(m,m)+1)}w[m]=-w[m]}for(let d=m+1;d<o;d++){if(m<N&&w[m]!==0){let k=0;for(let y=m;y<t;y++)k+=f.get(y,m)*f.get(y,d);k=-k/f.get(m,m);for(let y=m;y<t;y++)f.set(y,d,f.get(y,d)+k*f.get(y,m))}c[d]=f.get(m,d)}if(h&&m<N)for(let d=m;d<t;d++)p.set(d,m,f.get(d,m));if(m<q){c[m]=0;for(let d=m+1;d<o;d++)c[m]=X(c[m],c[d]);if(c[m]!==0){c[m+1]<0&&(c[m]=0-c[m]);for(let d=m+1;d<o;d++)c[d]/=c[m];c[m+1]+=1}if(c[m]=-c[m],m+1<t&&c[m]!==0){for(let d=m+1;d<t;d++)j[d]=0;for(let d=m+1;d<t;d++)for(let k=m+1;k<o;k++)j[d]+=c[k]*f.get(d,k);for(let d=m+1;d<o;d++){let k=-c[d]/c[m+1];for(let y=m+1;y<t;y++)f.set(y,d,f.get(y,d)+k*j[y])}}if(u)for(let d=m+1;d<o;d++)E.set(d,m,c[d])}}let R=Math.min(o,t+1);if(N<o&&(w[N]=f.get(N,N)),t<R&&(w[R-1]=0),q+1<R&&(c[q]=f.get(q,R-1)),c[R-1]=0,h){for(let m=N;m<a;m++){for(let d=0;d<t;d++)p.set(d,m,0);p.set(m,m,1)}for(let m=N-1;m>=0;m--)if(w[m]!==0){for(let d=m+1;d<a;d++){let k=0;for(let y=m;y<t;y++)k+=p.get(y,m)*p.get(y,d);k=-k/p.get(m,m);for(let y=m;y<t;y++)p.set(y,d,p.get(y,d)+k*p.get(y,m))}for(let d=m;d<t;d++)p.set(d,m,-p.get(d,m));p.set(m,m,1+p.get(m,m));for(let d=0;d<m-1;d++)p.set(d,m,0)}else{for(let d=0;d<t;d++)p.set(d,m,0);p.set(m,m,1)}}if(u)for(let m=o-1;m>=0;m--){if(m<q&&c[m]!==0)for(let d=m+1;d<o;d++){let k=0;for(let y=m+1;y<o;y++)k+=E.get(y,m)*E.get(y,d);k=-k/E.get(m+1,m);for(let y=m+1;y<o;y++)E.set(y,d,E.get(y,d)+k*E.get(y,m))}for(let d=0;d<o;d++)E.set(d,m,0);E.set(m,m,1)}let I=R-1,D=0,C=Number.EPSILON;for(;R>0;){let m,d;for(m=R-2;m>=-1&&m!==-1;m--){let k=Number.MIN_VALUE+C*Math.abs(w[m]+Math.abs(w[m+1]));if(Math.abs(c[m])<=k||Number.isNaN(c[m])){c[m]=0;break}}if(m===R-2)d=4;else{let k;for(k=R-1;k>=m&&k!==m;k--){let y=(k!==R?Math.abs(c[k]):0)+(k!==m+1?Math.abs(c[k-1]):0);if(Math.abs(w[k])<=C*y){w[k]=0;break}}k===m?d=3:k===R-1?d=1:(d=2,m=k)}switch(m++,d){case 1:{let k=c[R-2];c[R-2]=0;for(let y=R-2;y>=m;y--){let F=X(w[y],k),L=w[y]/F,W=k/F;if(w[y]=F,y!==m&&(k=-W*c[y-1],c[y-1]=L*c[y-1]),u)for(let B=0;B<o;B++)F=L*E.get(B,y)+W*E.get(B,R-1),E.set(B,R-1,-W*E.get(B,y)+L*E.get(B,R-1)),E.set(B,y,F)}break}case 2:{let k=c[m-1];c[m-1]=0;for(let y=m;y<R;y++){let F=X(w[y],k),L=w[y]/F,W=k/F;if(w[y]=F,k=-W*c[y],c[y]=L*c[y],h)for(let B=0;B<t;B++)F=L*p.get(B,y)+W*p.get(B,m-1),p.set(B,m-1,-W*p.get(B,y)+L*p.get(B,m-1)),p.set(B,y,F)}break}case 3:{let k=Math.max(Math.abs(w[R-1]),Math.abs(w[R-2]),Math.abs(c[R-2]),Math.abs(w[m]),Math.abs(c[m])),y=w[R-1]/k,F=w[R-2]/k,L=c[R-2]/k,W=w[m]/k,B=c[m]/k,Y=((F+y)*(F-y)+L*L)/2,U=y*L*(y*L),A=0;(Y!==0||U!==0)&&(Y<0?A=0-Math.sqrt(Y*Y+U):A=Math.sqrt(Y*Y+U),A=U/(Y+A));let _=(W+y)*(W-y)+A,H=W*B;for(let T=m;T<R-1;T++){let O=X(_,H);O===0&&(O=Number.MIN_VALUE);let J=_/O,K=H/O;if(T!==m&&(c[T-1]=O),_=J*w[T]+K*c[T],c[T]=J*c[T]-K*w[T],H=K*w[T+1],w[T+1]=J*w[T+1],u)for(let V=0;V<o;V++)O=J*E.get(V,T)+K*E.get(V,T+1),E.set(V,T+1,-K*E.get(V,T)+J*E.get(V,T+1)),E.set(V,T,O);if(O=X(_,H),O===0&&(O=Number.MIN_VALUE),J=_/O,K=H/O,w[T]=O,_=J*c[T]+K*w[T+1],w[T+1]=-K*c[T]+J*w[T+1],H=K*c[T+1],c[T+1]=J*c[T+1],h&&T<t-1)for(let V=0;V<t;V++)O=J*p.get(V,T)+K*p.get(V,T+1),p.set(V,T+1,-K*p.get(V,T)+J*p.get(V,T+1)),p.set(V,T,O)}c[R-2]=_,D=D+1;break}case 4:{if(w[m]<=0&&(w[m]=w[m]<0?-w[m]:0,u))for(let k=0;k<=I;k++)E.set(k,m,-E.get(k,m));for(;m<I&&!(w[m]>=w[m+1]);){let k=w[m];if(w[m]=w[m+1],w[m+1]=k,u&&m<o-1)for(let y=0;y<o;y++)k=E.get(y,m+1),E.set(y,m+1,E.get(y,m)),E.set(y,m,k);if(h&&m<t-1)for(let y=0;y<t;y++)k=p.get(y,m+1),p.set(y,m+1,p.get(y,m)),p.set(y,m,k);m++}D=0,R--;break}}}if(g){let m=E;E=p,p=m}this.m=t,this.n=o,this.s=w,this.U=p,this.V=E}solve(s){let e=s,t=this.threshold,o=this.s.length,r=S.zeros(o,o);for(let a=0;a<o;a++)Math.abs(this.s[a])<=t?r.set(a,a,0):r.set(a,a,1/this.s[a]);let l=this.U,i=this.rightSingularVectors,h=i.mmul(r),u=i.rows,g=l.rows,f=S.zeros(u,g);for(let a=0;a<u;a++)for(let M=0;M<g;M++){let w=0;for(let p=0;p<o;p++)w+=h.get(a,p)*l.get(M,p);f.set(a,M,w)}return f.mmul(e)}solveForDiagonal(s){return this.solve(S.diag(s))}inverse(){let s=this.V,e=this.threshold,t=s.rows,o=s.columns,r=new S(t,this.s.length);for(let g=0;g<t;g++)for(let f=0;f<o;f++)Math.abs(this.s[f])>e&&r.set(g,f,s.get(g,f)/this.s[f]);let l=this.U,i=l.rows,h=l.columns,u=new S(t,i);for(let g=0;g<t;g++)for(let f=0;f<i;f++){let a=0;for(let M=0;M<h;M++)a+=r.get(g,M)*l.get(f,M);u.set(g,f,a)}return u}get condition(){return this.s[0]/this.s[Math.min(this.m,this.n)-1]}get norm2(){return this.s[0]}get rank(){let s=Math.max(this.m,this.n)*this.s[0]*Number.EPSILON,e=0,t=this.s;for(let o=0,r=t.length;o<r;o++)t[o]>s&&e++;return e}get diagonal(){return Array.from(this.s)}get threshold(){return Number.EPSILON/2*Math.max(this.m,this.n)*this.s[0]}get leftSingularVectors(){return this.U}get rightSingularVectors(){return this.V}get diagonalMatrix(){return S.diag(this.s)}};function me(n,s=!1){return n=P.checkMatrix(n),s?new Z(n).inverse():Ht(n,S.eye(n.rows))}function Ht(n,s,e=!1){return n=P.checkMatrix(n),s=P.checkMatrix(s),e?new Z(n).solve(s):n.isSquare()?new x(n).solve(s):new nt(n).solve(s)}function bt(n){if(n=S.checkMatrix(n),n.isSquare()){if(n.columns===0)return 1;let s,e,t,o;if(n.columns===2)return s=n.get(0,0),e=n.get(0,1),t=n.get(1,0),o=n.get(1,1),s*o-e*t;if(n.columns===3){let r,l,i;return r=new tt(n,[1,2],[1,2]),l=new tt(n,[1,2],[0,2]),i=new tt(n,[1,2],[0,1]),s=n.get(0,0),e=n.get(0,1),t=n.get(0,2),s*bt(r)-e*bt(l)+t*bt(i)}else return new x(n).determinant}else throw Error("determinant can only be calculated for a square matrix")}function ge(n,s){let e=[];for(let t=0;t<n;t++)t!==s&&e.push(t);return e}function we(n,s,e,t=1e-9,o=1e-9){if(n>o)return new Array(s.rows+1).fill(0);{let r=s.addRow(e,[0]);for(let l=0;l<r.rows;l++)Math.abs(r.get(l,0))<t&&r.set(l,0,0);return r.to1DArray()}}function ae(n,s={}){let{thresholdValue:e=1e-9,thresholdError:t=1e-9}=s;n=S.checkMatrix(n);let o=n.rows,r=new S(o,o);for(let l=0;l<o;l++){let i=S.columnVector(n.getRow(l)),h=n.subMatrixRow(ge(o,l)).transpose(),g=new Z(h).solve(i),f=S.sub(i,h.mmul(g)).abs().max();r.setRow(l,we(f,g,l,e,t))}return r}function pe(n,s=Number.EPSILON){if(n=S.checkMatrix(n),n.isEmpty())return n.transpose();let e=new Z(n,{autoTranspose:!0}),t=e.leftSingularVectors,o=e.rightSingularVectors,r=e.diagonal;for(let l=0;l<r.length;l++)Math.abs(r[l])>s?r[l]=1/r[l]:r[l]=0;return o.mmul(S.diag(r).mmul(t.transpose()))}import{isAnyArray as de}from"/v120/is-any-array@2.0.1/deno/is-any-array.mjs";function ye(n,s=n,e={}){n=new S(n);let t=!1;if(typeof s=="object"&&!S.isMatrix(s)&&!de(s)?(e=s,s=n,t=!0):s=new S(s),n.rows!==s.rows)throw new TypeError("Both matrices must have the same number of rows");let{center:o=!0}=e;o&&(n=n.center("column"),t||(s=s.center("column")));let r=n.transpose().mmul(s);for(let l=0;l<r.rows;l++)for(let i=0;i<r.columns;i++)r.set(l,i,r.get(l,i)*(1/(n.rows-1)));return r}import{isAnyArray as je}from"/v120/is-any-array@2.0.1/deno/is-any-array.mjs";function Me(n,s=n,e={}){n=new S(n);let t=!1;if(typeof s=="object"&&!S.isMatrix(s)&&!je(s)?(e=s,s=n,t=!0):s=new S(s),n.rows!==s.rows)throw new TypeError("Both matrices must have the same number of rows");let{center:o=!0,scale:r=!0}=e;o&&(n.center("column"),t||s.center("column")),r&&(n.scale("column"),t||s.scale("column"));let l=n.standardDeviation("column",{unbiased:!0}),i=t?l:s.standardDeviation("column",{unbiased:!0}),h=n.transpose().mmul(s);for(let u=0;u<h.rows;u++)for(let g=0;g<h.columns;g++)h.set(u,g,h.get(u,g)*(1/(l[u]*i[g]))*(1/(n.rows-1)));return h}var ct=class{constructor(s,e={}){let{assumeSymmetric:t=!1}=e;if(s=P.checkMatrix(s),!s.isSquare())throw new Error("Matrix is not a square matrix");if(s.isEmpty())throw new Error("Matrix must be non-empty");let o=s.columns,r=new S(o,o),l=new Float64Array(o),i=new Float64Array(o),h=s,u,g,f=!1;if(t?f=!0:f=s.isSymmetric(),f){for(u=0;u<o;u++)for(g=0;g<o;g++)r.set(u,g,h.get(u,g));Se(o,i,l,r),Ee(o,i,l,r)}else{let a=new S(o,o),M=new Float64Array(o);for(g=0;g<o;g++)for(u=0;u<o;u++)a.set(u,g,h.get(u,g));ke(o,a,M,r),be(o,i,l,r,a)}this.n=o,this.e=i,this.d=l,this.V=r}get realEigenvalues(){return Array.from(this.d)}get imaginaryEigenvalues(){return Array.from(this.e)}get eigenvectorMatrix(){return this.V}get diagonalMatrix(){let s=this.n,e=this.e,t=this.d,o=new S(s,s),r,l;for(r=0;r<s;r++){for(l=0;l<s;l++)o.set(r,l,0);o.set(r,r,t[r]),e[r]>0?o.set(r,r+1,e[r]):e[r]<0&&o.set(r,r-1,e[r])}return o}};function Se(n,s,e,t){let o,r,l,i,h,u,g,f;for(h=0;h<n;h++)e[h]=t.get(n-1,h);for(i=n-1;i>0;i--){for(f=0,l=0,u=0;u<i;u++)f=f+Math.abs(e[u]);if(f===0)for(s[i]=e[i-1],h=0;h<i;h++)e[h]=t.get(i-1,h),t.set(i,h,0),t.set(h,i,0);else{for(u=0;u<i;u++)e[u]/=f,l+=e[u]*e[u];for(o=e[i-1],r=Math.sqrt(l),o>0&&(r=-r),s[i]=f*r,l=l-o*r,e[i-1]=o-r,h=0;h<i;h++)s[h]=0;for(h=0;h<i;h++){for(o=e[h],t.set(h,i,o),r=s[h]+t.get(h,h)*o,u=h+1;u<=i-1;u++)r+=t.get(u,h)*e[u],s[u]+=t.get(u,h)*o;s[h]=r}for(o=0,h=0;h<i;h++)s[h]/=l,o+=s[h]*e[h];for(g=o/(l+l),h=0;h<i;h++)s[h]-=g*e[h];for(h=0;h<i;h++){for(o=e[h],r=s[h],u=h;u<=i-1;u++)t.set(u,h,t.get(u,h)-(o*s[u]+r*e[u]));e[h]=t.get(i-1,h),t.set(i,h,0)}}e[i]=l}for(i=0;i<n-1;i++){if(t.set(n-1,i,t.get(i,i)),t.set(i,i,1),l=e[i+1],l!==0){for(u=0;u<=i;u++)e[u]=t.get(u,i+1)/l;for(h=0;h<=i;h++){for(r=0,u=0;u<=i;u++)r+=t.get(u,i+1)*t.get(u,h);for(u=0;u<=i;u++)t.set(u,h,t.get(u,h)-r*e[u])}}for(u=0;u<=i;u++)t.set(u,i+1,0)}for(h=0;h<n;h++)e[h]=t.get(n-1,h),t.set(n-1,h,0);t.set(n-1,n-1,1),s[0]=0}function Ee(n,s,e,t){let o,r,l,i,h,u,g,f,a,M,w,p,E,c,j,b,N;for(l=1;l<n;l++)s[l-1]=s[l];s[n-1]=0;let q=0,$=0,R=Number.EPSILON;for(u=0;u<n;u++){for($=Math.max($,Math.abs(e[u])+Math.abs(s[u])),g=u;g<n&&!(Math.abs(s[g])<=R*$);)g++;if(g>u){N=0;do{for(N=N+1,o=e[u],f=(e[u+1]-o)/(2*s[u]),a=X(f,1),f<0&&(a=-a),e[u]=s[u]/(f+a),e[u+1]=s[u]*(f+a),M=e[u+1],r=o-e[u],l=u+2;l<n;l++)e[l]-=r;for(q=q+r,f=e[g],w=1,p=w,E=w,c=s[u+1],j=0,b=0,l=g-1;l>=u;l--)for(E=p,p=w,b=j,o=w*s[l],r=w*f,a=X(f,s[l]),s[l+1]=j*a,j=s[l]/a,w=f/a,f=w*e[l]-j*o,e[l+1]=r+j*(w*o+j*e[l]),h=0;h<n;h++)r=t.get(h,l+1),t.set(h,l+1,j*t.get(h,l)+w*r),t.set(h,l,w*t.get(h,l)-j*r);f=-j*b*E*c*s[u]/M,s[u]=j*f,e[u]=w*f}while(Math.abs(s[u])>R*$)}e[u]=e[u]+q,s[u]=0}for(l=0;l<n-1;l++){for(h=l,f=e[l],i=l+1;i<n;i++)e[i]<f&&(h=i,f=e[i]);if(h!==l)for(e[h]=e[l],e[l]=f,i=0;i<n;i++)f=t.get(i,l),t.set(i,l,t.get(i,h)),t.set(i,h,f)}}function ke(n,s,e,t){let o=0,r=n-1,l,i,h,u,g,f,a;for(f=o+1;f<=r-1;f++){for(a=0,u=f;u<=r;u++)a=a+Math.abs(s.get(u,f-1));if(a!==0){for(h=0,u=r;u>=f;u--)e[u]=s.get(u,f-1)/a,h+=e[u]*e[u];for(i=Math.sqrt(h),e[f]>0&&(i=-i),h=h-e[f]*i,e[f]=e[f]-i,g=f;g<n;g++){for(l=0,u=r;u>=f;u--)l+=e[u]*s.get(u,g);for(l=l/h,u=f;u<=r;u++)s.set(u,g,s.get(u,g)-l*e[u])}for(u=0;u<=r;u++){for(l=0,g=r;g>=f;g--)l+=e[g]*s.get(u,g);for(l=l/h,g=f;g<=r;g++)s.set(u,g,s.get(u,g)-l*e[g])}e[f]=a*e[f],s.set(f,f-1,a*i)}}for(u=0;u<n;u++)for(g=0;g<n;g++)t.set(u,g,u===g?1:0);for(f=r-1;f>=o+1;f--)if(s.get(f,f-1)!==0){for(u=f+1;u<=r;u++)e[u]=s.get(u,f-1);for(g=f;g<=r;g++){for(i=0,u=f;u<=r;u++)i+=e[u]*t.get(u,g);for(i=i/e[f]/s.get(f,f-1),u=f;u<=r;u++)t.set(u,g,t.get(u,g)+i*e[u])}}}function be(n,s,e,t,o){let r=n-1,l=0,i=n-1,h=Number.EPSILON,u=0,g=0,f=0,a=0,M=0,w=0,p=0,E=0,c,j,b,N,q,$,R,I,D,C,m,d,k,y,F;for(c=0;c<n;c++)for((c<l||c>i)&&(e[c]=o.get(c,c),s[c]=0),j=Math.max(c-1,0);j<n;j++)g=g+Math.abs(o.get(c,j));for(;r>=l;){for(N=r;N>l&&(w=Math.abs(o.get(N-1,N-1))+Math.abs(o.get(N,N)),w===0&&(w=g),!(Math.abs(o.get(N,N-1))<h*w));)N--;if(N===r)o.set(r,r,o.get(r,r)+u),e[r]=o.get(r,r),s[r]=0,r--,E=0;else if(N===r-1){if(R=o.get(r,r-1)*o.get(r-1,r),f=(o.get(r-1,r-1)-o.get(r,r))/2,a=f*f+R,p=Math.sqrt(Math.abs(a)),o.set(r,r,o.get(r,r)+u),o.set(r-1,r-1,o.get(r-1,r-1)+u),I=o.get(r,r),a>=0){for(p=f>=0?f+p:f-p,e[r-1]=I+p,e[r]=e[r-1],p!==0&&(e[r]=I-R/p),s[r-1]=0,s[r]=0,I=o.get(r,r-1),w=Math.abs(I)+Math.abs(p),f=I/w,a=p/w,M=Math.sqrt(f*f+a*a),f=f/M,a=a/M,j=r-1;j<n;j++)p=o.get(r-1,j),o.set(r-1,j,a*p+f*o.get(r,j)),o.set(r,j,a*o.get(r,j)-f*p);for(c=0;c<=r;c++)p=o.get(c,r-1),o.set(c,r-1,a*p+f*o.get(c,r)),o.set(c,r,a*o.get(c,r)-f*p);for(c=l;c<=i;c++)p=t.get(c,r-1),t.set(c,r-1,a*p+f*t.get(c,r)),t.set(c,r,a*t.get(c,r)-f*p)}else e[r-1]=I+f,e[r]=I+f,s[r-1]=p,s[r]=-p;r=r-2,E=0}else{if(I=o.get(r,r),D=0,R=0,N<r&&(D=o.get(r-1,r-1),R=o.get(r,r-1)*o.get(r-1,r)),E===10){for(u+=I,c=l;c<=r;c++)o.set(c,c,o.get(c,c)-I);w=Math.abs(o.get(r,r-1))+Math.abs(o.get(r-1,r-2)),I=D=.75*w,R=-.4375*w*w}if(E===30&&(w=(D-I)/2,w=w*w+R,w>0)){for(w=Math.sqrt(w),D<I&&(w=-w),w=I-R/((D-I)/2+w),c=l;c<=r;c++)o.set(c,c,o.get(c,c)-w);u+=w,I=D=R=.964}for(E=E+1,q=r-2;q>=N&&(p=o.get(q,q),M=I-p,w=D-p,f=(M*w-R)/o.get(q+1,q)+o.get(q,q+1),a=o.get(q+1,q+1)-p-M-w,M=o.get(q+2,q+1),w=Math.abs(f)+Math.abs(a)+Math.abs(M),f=f/w,a=a/w,M=M/w,!(q===N||Math.abs(o.get(q,q-1))*(Math.abs(a)+Math.abs(M))<h*(Math.abs(f)*(Math.abs(o.get(q-1,q-1))+Math.abs(p)+Math.abs(o.get(q+1,q+1))))));)q--;for(c=q+2;c<=r;c++)o.set(c,c-2,0),c>q+2&&o.set(c,c-3,0);for(b=q;b<=r-1&&(y=b!==r-1,b!==q&&(f=o.get(b,b-1),a=o.get(b+1,b-1),M=y?o.get(b+2,b-1):0,I=Math.abs(f)+Math.abs(a)+Math.abs(M),I!==0&&(f=f/I,a=a/I,M=M/I)),I!==0);b++)if(w=Math.sqrt(f*f+a*a+M*M),f<0&&(w=-w),w!==0){for(b!==q?o.set(b,b-1,-w*I):N!==q&&o.set(b,b-1,-o.get(b,b-1)),f=f+w,I=f/w,D=a/w,p=M/w,a=a/f,M=M/f,j=b;j<n;j++)f=o.get(b,j)+a*o.get(b+1,j),y&&(f=f+M*o.get(b+2,j),o.set(b+2,j,o.get(b+2,j)-f*p)),o.set(b,j,o.get(b,j)-f*I),o.set(b+1,j,o.get(b+1,j)-f*D);for(c=0;c<=Math.min(r,b+3);c++)f=I*o.get(c,b)+D*o.get(c,b+1),y&&(f=f+p*o.get(c,b+2),o.set(c,b+2,o.get(c,b+2)-f*M)),o.set(c,b,o.get(c,b)-f),o.set(c,b+1,o.get(c,b+1)-f*a);for(c=l;c<=i;c++)f=I*t.get(c,b)+D*t.get(c,b+1),y&&(f=f+p*t.get(c,b+2),t.set(c,b+2,t.get(c,b+2)-f*M)),t.set(c,b,t.get(c,b)-f),t.set(c,b+1,t.get(c,b+1)-f*a)}}}if(g!==0){for(r=n-1;r>=0;r--)if(f=e[r],a=s[r],a===0)for(N=r,o.set(r,r,1),c=r-1;c>=0;c--){for(R=o.get(c,c)-f,M=0,j=N;j<=r;j++)M=M+o.get(c,j)*o.get(j,r);if(s[c]<0)p=R,w=M;else if(N=c,s[c]===0?o.set(c,r,R!==0?-M/R:-M/(h*g)):(I=o.get(c,c+1),D=o.get(c+1,c),a=(e[c]-f)*(e[c]-f)+s[c]*s[c],$=(I*w-p*M)/a,o.set(c,r,$),o.set(c+1,r,Math.abs(I)>Math.abs(p)?(-M-R*$)/I:(-w-D*$)/p)),$=Math.abs(o.get(c,r)),h*$*$>1)for(j=c;j<=r;j++)o.set(j,r,o.get(j,r)/$)}else if(a<0)for(N=r-1,Math.abs(o.get(r,r-1))>Math.abs(o.get(r-1,r))?(o.set(r-1,r-1,a/o.get(r,r-1)),o.set(r-1,r,-(o.get(r,r)-f)/o.get(r,r-1))):(F=Rt(0,-o.get(r-1,r),o.get(r-1,r-1)-f,a),o.set(r-1,r-1,F[0]),o.set(r-1,r,F[1])),o.set(r,r-1,0),o.set(r,r,1),c=r-2;c>=0;c--){for(C=0,m=0,j=N;j<=r;j++)C=C+o.get(c,j)*o.get(j,r-1),m=m+o.get(c,j)*o.get(j,r);if(R=o.get(c,c)-f,s[c]<0)p=R,M=C,w=m;else if(N=c,s[c]===0?(F=Rt(-C,-m,R,a),o.set(c,r-1,F[0]),o.set(c,r,F[1])):(I=o.get(c,c+1),D=o.get(c+1,c),d=(e[c]-f)*(e[c]-f)+s[c]*s[c]-a*a,k=(e[c]-f)*2*a,d===0&&k===0&&(d=h*g*(Math.abs(R)+Math.abs(a)+Math.abs(I)+Math.abs(D)+Math.abs(p))),F=Rt(I*M-p*C+a*m,I*w-p*m-a*C,d,k),o.set(c,r-1,F[0]),o.set(c,r,F[1]),Math.abs(I)>Math.abs(p)+Math.abs(a)?(o.set(c+1,r-1,(-C-R*o.get(c,r-1)+a*o.get(c,r))/I),o.set(c+1,r,(-m-R*o.get(c,r)-a*o.get(c,r-1))/I)):(F=Rt(-M-D*o.get(c,r-1),-w-D*o.get(c,r),p,a),o.set(c+1,r-1,F[0]),o.set(c+1,r,F[1]))),$=Math.max(Math.abs(o.get(c,r-1)),Math.abs(o.get(c,r))),h*$*$>1)for(j=c;j<=r;j++)o.set(j,r-1,o.get(j,r-1)/$),o.set(j,r,o.get(j,r)/$)}for(c=0;c<n;c++)if(c<l||c>i)for(j=c;j<n;j++)t.set(c,j,o.get(c,j));for(j=n-1;j>=l;j--)for(c=l;c<=i;c++){for(p=0,b=l;b<=Math.min(j,i);b++)p=p+t.get(c,b)*o.get(b,j);t.set(c,j,p)}}}function Rt(n,s,e,t){let o,r;return Math.abs(e)>Math.abs(t)?(o=t/e,r=e+o*t,[(n+o*s)/r,(s-o*n)/r]):(o=e/t,r=t+o*e,[(o*n+s)/r,(o*s-n)/r])}var mt=class{constructor(s){if(s=P.checkMatrix(s),!s.isSymmetric())throw new Error("Matrix is not symmetric");let e=s,t=e.rows,o=new S(t,t),r=!0,l,i,h;for(i=0;i<t;i++){let u=0;for(h=0;h<i;h++){let g=0;for(l=0;l<h;l++)g+=o.get(h,l)*o.get(i,l);g=(e.get(i,h)-g)/o.get(h,h),o.set(i,h,g),u=u+g*g}for(u=e.get(i,i)-u,r&=u>0,o.set(i,i,Math.sqrt(Math.max(u,0))),h=i+1;h<t;h++)o.set(i,h,0)}this.L=o,this.positiveDefinite=!!r}isPositiveDefinite(){return this.positiveDefinite}solve(s){s=P.checkMatrix(s);let e=this.L,t=e.rows;if(s.rows!==t)throw new Error("Matrix dimensions do not match");if(this.isPositiveDefinite()===!1)throw new Error("Matrix is not positive definite");let o=s.columns,r=s.clone(),l,i,h;for(h=0;h<t;h++)for(i=0;i<o;i++){for(l=0;l<h;l++)r.set(h,i,r.get(h,i)-r.get(l,i)*e.get(h,l));r.set(h,i,r.get(h,i)/e.get(h,h))}for(h=t-1;h>=0;h--)for(i=0;i<o;i++){for(l=h+1;l<t;l++)r.set(h,i,r.get(h,i)-r.get(l,i)*e.get(l,h));r.set(h,i,r.get(h,i)/e.get(h,h))}return r}get lowerTriangularMatrix(){return this.L}};import{isAnyArray as Re}from"/v120/is-any-array@2.0.1/deno/is-any-array.mjs";var gt=class{constructor(s,e={}){s=P.checkMatrix(s);let{Y:t}=e,{scaleScores:o=!1,maxIterations:r=1e3,terminationCriteria:l=1e-10}=e,i;if(t){if(Re(t)&&typeof t[0]=="number"?t=S.columnVector(t):t=P.checkMatrix(t),t.rows!==s.rows)throw new Error("Y should have the same number of rows as X");i=t.getColumnVector(0)}else i=s.getColumnVector(0);let h=1,u,g,f,a;for(let M=0;M<r&&h>l;M++)f=s.transpose().mmul(i).div(i.transpose().mmul(i).get(0,0)),f=f.div(f.norm()),u=s.mmul(f).div(f.transpose().mmul(f).get(0,0)),M>0&&(h=u.clone().sub(a).pow(2).sum()),a=u.clone(),t?(g=t.transpose().mmul(u).div(u.transpose().mmul(u).get(0,0)),g=g.div(g.norm()),i=t.mmul(g).div(g.transpose().mmul(g).get(0,0))):i=u;if(t){let M=s.transpose().mmul(u).div(u.transpose().mmul(u).get(0,0));M=M.div(M.norm());let w=s.clone().sub(u.clone().mmul(M.transpose())),p=i.transpose().mmul(u).div(u.transpose().mmul(u).get(0,0)),E=t.clone().sub(u.clone().mulS(p.get(0,0)).mmul(g.transpose()));this.t=u,this.p=M.transpose(),this.w=f.transpose(),this.q=g,this.u=i,this.s=u.transpose().mmul(u),this.xResidual=w,this.yResidual=E,this.betas=p}else this.w=f.transpose(),this.s=u.transpose().mmul(u).sqrt(),o?this.t=u.clone().div(this.s.get(0,0)):this.t=u,this.xResidual=s.sub(u.mmul(f.transpose()))}};export{v as AbstractMatrix,mt as CHO,mt as CholeskyDecomposition,ct as EVD,ct as EigenvalueDecomposition,x as LU,x as LuDecomposition,S as Matrix,dt as MatrixColumnSelectionView,pt as MatrixColumnView,yt as MatrixFlipColumnView,jt as MatrixFlipRowView,St as MatrixRowSelectionView,Mt as MatrixRowView,tt as MatrixSelectionView,Et as MatrixSubView,kt as MatrixTransposeView,gt as NIPALS,gt as Nipals,nt as QR,nt as QrDecomposition,Z as SVD,Z as SingularValueDecomposition,ht as WrapperMatrix1D,P as WrapperMatrix2D,Me as correlation,ye as covariance,S as default,bt as determinant,me as inverse,ae as linearDependencies,pe as pseudoInverse,Ht as solve,ce as wrap};
//# sourceMappingURL=ml-matrix.mjs.map