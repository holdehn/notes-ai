/* esm.sh - esbuild bundle(js-tiktoken@1.0.6/lite) deno production */
var m=Object.defineProperty,w=(e,s,t)=>s in e?m(e,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[s]=t,g=(e,s,t)=>(w(e,typeof s!="symbol"?s+"":s,t),t);import T from"/v126/base64-js@1.5.1/deno/base64-js.mjs";function _(e,s){let t=Array.from({length:e.length},(a,n)=>({start:n,end:n+1}));for(;t.length>1;){let a=null;for(let n=0;n<t.length-1;n++){let c=e.slice(t[n].start,t[n+1].end),i=s.get(c.join(","));i!=null&&(a==null||i<a[0])&&(a=[i,n])}if(a!=null){let n=a[1];t[n]={start:t[n].start,end:t[n+1].end},t.splice(n+1,1)}else break}return t}function v(e,s){return e.length===1?[s.get(e.join(","))]:_(e,s).map(t=>s.get(e.slice(t.start,t.end).join(","))).filter(t=>t!=null)}function y(e){return e.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")}var p=class{specialTokens;inverseSpecialTokens;patStr;textEncoder=new TextEncoder;textDecoder=new TextDecoder("utf-8");rankMap=new Map;textMap=new Map;constructor(e,s){this.patStr=e.pat_str;let t=e.bpe_ranks.split(`
`).filter(Boolean).reduce((a,n)=>{let[c,i,...o]=n.split(" "),d=Number.parseInt(i,10);return o.forEach((r,l)=>a[r]=d+l),a},{});for(let[a,n]of Object.entries(t)){let c=T.toByteArray(a);this.rankMap.set(c.join(","),n),this.textMap.set(n,c)}this.specialTokens={...e.special_tokens,...s},this.inverseSpecialTokens=Object.entries(this.specialTokens).reduce((a,[n,c])=>(a[c]=this.textEncoder.encode(n),a),{})}encode(e,s=[],t="all"){let a=new RegExp(this.patStr,"ug"),n=p.specialTokenRegex(Object.keys(this.specialTokens)),c=[],i=new Set(s==="all"?Object.keys(this.specialTokens):s),o=new Set(t==="all"?Object.keys(this.specialTokens).filter(r=>!i.has(r)):t);if(o.size>0){let r=p.specialTokenRegex([...o]),l=e.match(r);if(l!=null)throw new Error(`The text contains a special token that is not allowed: ${l[0]}`)}let d=0;for(;;){let r=null,l=d;for(;n.lastIndex=l,r=n.exec(e),!(r==null||i.has(r[0]));)l=r.index+1;let b=r?.index??e.length;for(let k of e.substring(d,b).matchAll(a)){let u=this.textEncoder.encode(k[0]),h=this.rankMap.get(u.join(","));if(h!=null){c.push(h);continue}c.push(...v(u,this.rankMap))}if(r==null)break;let f=this.specialTokens[r[0]];c.push(f),d=r.index+r[0].length}return c}decode(e){let s=[],t=0;for(let c=0;c<e.length;++c){let i=e[c],o=this.textMap.get(i)??this.inverseSpecialTokens[i];o!=null&&(s.push(o),t+=o.length)}let a=new Uint8Array(t),n=0;for(let c of s)a.set(c,n),n+=c.length;return this.textDecoder.decode(a)}},x=p;g(x,"specialTokenRegex",e=>new RegExp(e.map(s=>y(s)).join("|"),"g"));function M(e){switch(e){case"gpt2":return"gpt2";case"code-cushman-001":case"code-cushman-002":case"code-davinci-001":case"code-davinci-002":case"cushman-codex":case"davinci-codex":case"text-davinci-002":case"text-davinci-003":return"p50k_base";case"code-davinci-edit-001":case"text-davinci-edit-001":return"p50k_edit";case"ada":case"babbage":case"code-search-ada-code-001":case"code-search-babbage-code-001":case"curie":case"davinci":case"text-ada-001":case"text-babbage-001":case"text-curie-001":case"text-davinci-001":case"text-search-ada-doc-001":case"text-search-babbage-doc-001":case"text-search-curie-doc-001":case"text-search-davinci-doc-001":case"text-similarity-ada-001":case"text-similarity-babbage-001":case"text-similarity-curie-001":case"text-similarity-davinci-001":return"r50k_base";case"gpt-3.5-turbo-0301":case"gpt-3.5-turbo":case"gpt-4-0314":case"gpt-4-32k-0314":case"gpt-4-32k":case"gpt-4":case"text-embedding-ada-002":return"cl100k_base";default:throw new Error("Unknown model")}}export{x as Tiktoken,M as getEncodingNameForModel};
//# sourceMappingURL=lite.js.map