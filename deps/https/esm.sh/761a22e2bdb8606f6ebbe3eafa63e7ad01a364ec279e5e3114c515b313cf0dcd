/* esm.sh - esbuild bundle(@fortaine/fetch-event-source@3.0.6) deno production */
async function T(r,e){let n=r.getReader(),t;for(;!(t=await n.read()).done;)e(t.value)}function k(r){let e,n,t,o=!1;return function(s){e===void 0?(e=s,n=0,t=-1):e=_(e,s);let a=e.length,i=0;for(;n<a;){o&&(e[n]===10&&(i=++n),o=!1);let c=-1;for(;n<a&&c===-1;++n)switch(e[n]){case 58:t===-1&&(t=n-i);break;case 13:o=!0;case 10:c=n;break}if(c===-1)break;r(e.subarray(i,c),t),i=n,t=-1}i===a?e=void 0:i!==0&&(e=e.subarray(i),n-=i)}}function S(r,e,n){let t=x(),o=new TextDecoder;return function(s,a){if(s.length===0)r?.(t),t=x();else if(a>0){let i=o.decode(s.subarray(0,a)),c=a+(s[a+1]===32?2:1),d=o.decode(s.subarray(c));switch(i){case"data":t.data=t.data?t.data+`
`+d:d;break;case"event":t.event=d;break;case"id":e?.(t.id=d);break;case"retry":let u=parseInt(d,10);isNaN(u)||n?.(t.retry=u);break}}}}function _(r,e){let n=new Uint8Array(r.length+e.length);return n.set(r),n.set(e,r.length),n}function x(){return{data:"",event:"",id:"",retry:void 0}}var A=function(r,e){var n={};for(var t in r)Object.prototype.hasOwnProperty.call(r,t)&&e.indexOf(t)<0&&(n[t]=r[t]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,t=Object.getOwnPropertySymbols(r);o<t.length;o++)e.indexOf(t[o])<0&&Object.prototype.propertyIsEnumerable.call(r,t[o])&&(n[t[o]]=r[t[o]]);return n},y="text/event-stream",H=1e3,j="last-event-id";function I(r,e){var{signal:n,headers:t,onopen:o,onmessage:h,onclose:s,onerror:a,openWhenHidden:i,fetch:c}=e,d=A(e,["signal","headers","onopen","onmessage","onclose","onerror","openWhenHidden","fetch"]);return new Promise((u,C)=>{let f=Object.assign({},t);f.accept||(f.accept=y);let v;function O(){v.abort(),document.hidden||m()}typeof document<"u"&&!i&&document.addEventListener("visibilitychange",O);let E=H,b=0;function g(){typeof document<"u"&&!i&&document.removeEventListener("visibilitychange",O),clearTimeout(b),v.abort()}n?.addEventListener("abort",()=>{g(),u()});let L=c??fetch,P=o??N;async function m(){var w;v=new AbortController;try{let p=await L(r,Object.assign(Object.assign({},d),{headers:f,signal:v.signal}));await P(p),await T(p.body,k(S(h,l=>{l?f[j]=l:delete f[j]},l=>{E=l}))),s?.(),g(),u()}catch(p){if(!v.signal.aborted)try{let l=(w=a?.(p))!==null&&w!==void 0?w:E;clearTimeout(b),b=setTimeout(m,l)}catch(l){g(),C(l)}}}m()})}function N(r){let e=r.headers.get("content-type");if(!e?.startsWith(y))throw new Error(`Expected content-type to be ${y}, Actual: ${e}`)}export{y as EventStreamContentType,I as fetchEventSource};
//# sourceMappingURL=fetch-event-source.mjs.map