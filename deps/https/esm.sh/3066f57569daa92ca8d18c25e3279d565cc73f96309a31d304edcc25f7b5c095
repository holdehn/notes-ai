/* esm.sh - esbuild bundle(langchain@0.0.66/prompts) deno production */
var Z=Object.defineProperty;var w=(n,e)=>()=>(n&&(e=n(n=0)),e);var Y=(n,e)=>{for(var t in e)Z(n,t,{get:e[t],enumerable:!0})};var f,h,V,O,T,E,L=w(()=>{f=class{constructor(e){Object.defineProperty(this,"text",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.text=e}},h=class extends f{_getType(){return"human"}},V=class extends f{_getType(){return"ai"}},O=class extends f{_getType(){return"system"}},T=class extends f{constructor(e,t){super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=t}_getType(){return"generic"}},E=class{}});var H,B,k,ee,b,A,y,_=w(()=>{H=n=>{let e=n.split(""),t=[],a=(s,i)=>{for(let o=i;o<e.length;o+=1)if(s.includes(e[o]))return o;return-1},r=0;for(;r<e.length;)if(e[r]==="{"&&r+1<e.length&&e[r+1]==="{")t.push({type:"literal",text:"{"}),r+=2;else if(e[r]==="}"&&r+1<e.length&&e[r+1]==="}")t.push({type:"literal",text:"}"}),r+=2;else if(e[r]==="{"){let s=a("}",r);if(s<0)throw new Error("Unclosed '{' in template.");t.push({type:"variable",name:e.slice(r+1,s).join("")}),r=s+1}else{if(e[r]==="}")throw new Error("Single '}' in template.");{let s=a("{}",r),i=(s<0?e.slice(r):e.slice(r,s)).join("");t.push({type:"literal",text:i}),r=s<0?e.length:s}}return t},B=(n,e)=>H(n).reduce((t,a)=>{if(a.type==="variable"){if(a.name in e)return t+e[a.name];throw new Error(`Missing value for input ${a.name}`)}return t+a.text},""),k={"f-string":B,jinja2:(n,e)=>""},ee={"f-string":H,jinja2:n=>[]},b=(n,e,t)=>k[e](n,t),A=(n,e)=>ee[e](n),y=(n,e,t)=>{if(!(e in k)){let a=Object.keys(k);throw new Error(`Invalid template format. Got \`${e}\`;
                         should be one of ${a}`)}try{let a=t.reduce((r,s)=>(r[s]="foo",r),{});b(n,e,a)}catch{throw new Error("Invalid prompt schema.")}}});var I={};Y(I,{PromptTemplate:()=>l});var l,x=w(()=>{v();_();l=class extends m{constructor(e){if(super(e),Object.defineProperty(this,"template",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.assign(this,e),this.validateTemplate){let t=this.inputVariables;this.partialVariables&&(t=t.concat(Object.keys(this.partialVariables))),y(this.template,this.templateFormat,t)}}_getPromptType(){return"prompt"}async format(e){let t=await this.mergePartialAndUserVariables(e);return b(this.template,this.templateFormat,t)}static fromExamples(e,t,a,r=`

`,s=""){let i=[s,...e,t].join(r);return new l({inputVariables:a,template:i})}static fromTemplate(e,{templateFormat:t="f-string",...a}={}){let r=new Set;return A(e,t).forEach(s=>{s.type==="variable"&&r.add(s.name)}),new l({inputVariables:[...r],templateFormat:t,template:e,...a})}async partial(e){let t={...this};return t.inputVariables=this.inputVariables.filter(a=>!(a in e)),t.partialVariables={...this.partialVariables??{},...e},new l(t)}serialize(){if(this.outputParser!==void 0)throw new Error("Cannot serialize a prompt template with an output parser");return{_type:this._getPromptType(),input_variables:this.inputVariables,template:this.template,template_format:this.templateFormat}}static async deserialize(e){if(!e.template)throw new Error("Prompt template must have a template");return new l({inputVariables:e.input_variables,template:e.template,templateFormat:e.template_format})}}});var Q={};Y(Q,{FewShotPromptTemplate:()=>c});var c,F=w(()=>{v();_();x();c=class extends m{constructor(e){if(super(e),Object.defineProperty(this,"examples",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleSelector",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"examplePrompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"suffix",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"exampleSeparator",{enumerable:!0,configurable:!0,writable:!0,value:`

`}),Object.defineProperty(this,"prefix",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.assign(this,e),this.examples!==void 0&&this.exampleSelector!==void 0)throw new Error("Only one of 'examples' and 'example_selector' should be provided");if(this.examples===void 0&&this.exampleSelector===void 0)throw new Error("One of 'examples' and 'example_selector' should be provided");if(this.validateTemplate){let t=this.inputVariables;this.partialVariables&&(t=t.concat(Object.keys(this.partialVariables))),y(this.prefix+this.suffix,this.templateFormat,t)}}_getPromptType(){return"few_shot"}async getExamples(e){if(this.examples!==void 0)return this.examples;if(this.exampleSelector!==void 0)return this.exampleSelector.selectExamples(e);throw new Error("One of 'examples' and 'example_selector' should be provided")}async partial(e){let t={...this};return t.inputVariables=this.inputVariables.filter(a=>!(a in e)),t.partialVariables={...this.partialVariables??{},...e},new c(t)}async format(e){let t=await this.mergePartialAndUserVariables(e),a=await this.getExamples(t),r=await Promise.all(a.map(i=>this.examplePrompt.format(i))),s=[this.prefix,...r,this.suffix].join(this.exampleSeparator);return b(s,this.templateFormat,t)}serialize(){if(this.exampleSelector||!this.examples)throw new Error("Serializing an example selector is not currently supported");if(this.outputParser!==void 0)throw new Error("Serializing an output parser is not currently supported");return{_type:this._getPromptType(),input_variables:this.inputVariables,example_prompt:this.examplePrompt.serialize(),example_separator:this.exampleSeparator,suffix:this.suffix,prefix:this.prefix,template_format:this.templateFormat,examples:this.examples}}static async deserialize(e){let{example_prompt:t}=e;if(!t)throw new Error("Missing example prompt");let a=await l.deserialize(t),r;if(Array.isArray(e.examples))r=e.examples;else throw new Error("Invalid examples format. Only list or string are supported.");return new c({inputVariables:e.input_variables,examplePrompt:a,examples:r,exampleSeparator:e.example_separator,prefix:e.prefix,suffix:e.suffix,templateFormat:e.template_format})}}});var S,d,m,N,v=w(()=>{L();S=class{constructor(e){Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.value=e}toString(){return this.value}toChatMessages(){return[new h(this.value)]}},d=class{constructor(e){Object.defineProperty(this,"inputVariables",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputParser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"partialVariables",{enumerable:!0,configurable:!0,writable:!0,value:void 0});let{inputVariables:t}=e;if(t.includes("stop"))throw new Error("Cannot have an input variable named 'stop', as it is used internally, please rename.");Object.assign(this,e)}async mergePartialAndUserVariables(e){let t=this.partialVariables??{},a={};for(let[s,i]of Object.entries(t))typeof i=="string"?a[s]=i:a[s]=await i();return{...a,...e}}static async deserialize(e){switch(e._type){case"prompt":{let{PromptTemplate:t}=await Promise.resolve().then(()=>(x(),I));return t.deserialize(e)}case void 0:{let{PromptTemplate:t}=await Promise.resolve().then(()=>(x(),I));return t.deserialize({...e,_type:"prompt"})}case"few_shot":{let{FewShotPromptTemplate:t}=await Promise.resolve().then(()=>(F(),Q));return t.deserialize(e)}default:throw new Error(`Invalid prompt type in config: ${e._type}`)}}},m=class extends d{async formatPromptValue(e){let t=await this.format(e);return new S(t)}},N=class{}});v();x();function W(n){return n.split(/\n| /).length}var P=class{constructor(e){Object.defineProperty(this,"examples",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"examplePrompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"getTextLength",{enumerable:!0,configurable:!0,writable:!0,value:W}),Object.defineProperty(this,"maxLength",{enumerable:!0,configurable:!0,writable:!0,value:2048}),Object.defineProperty(this,"exampleTextLengths",{enumerable:!0,configurable:!0,writable:!0,value:[]}),this.examplePrompt=e.examplePrompt,this.maxLength=e.maxLength??2048,this.getTextLength=e.getTextLength??W}async addExample(e){this.examples.push(e);let t=await this.examplePrompt.format(e);this.exampleTextLengths.push(this.getTextLength(t))}async calculateExampleTextLengths(e,t){if(e.length>0)return e;let{examples:a,examplePrompt:r}=t;return(await Promise.all(a.map(i=>r.format(i)))).map(i=>this.getTextLength(i))}async selectExamples(e){let t=Object.values(e).join(" "),a=this.maxLength-this.getTextLength(t),r=0,s=[];for(;a>0&&r<this.examples.length;){let i=a-this.exampleTextLengths[r];if(i<0)break;s.push(this.examples[r]),a=i,r+=1}return s}static async fromExamples(e,t){let a=new P(t);return await Promise.all(e.map(r=>a.addExample(r))),a}};var K=class{constructor(e){Object.defineProperty(this,"pageContent",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.pageContent=e.pageContent?e.pageContent.toString():this.pageContent,this.metadata=e.metadata??{}}};function D(n){return Object.keys(n).sort().map(e=>n[e])}var j=class{constructor(e){Object.defineProperty(this,"vectorStore",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"k",{enumerable:!0,configurable:!0,writable:!0,value:4}),Object.defineProperty(this,"exampleKeys",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputKeys",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.vectorStore=e.vectorStore,this.k=e.k??4,this.exampleKeys=e.exampleKeys,this.inputKeys=e.inputKeys}async addExample(e){let t=this.inputKeys??Object.keys(e),a=D(t.reduce((r,s)=>({...r,[s]:e[s]}),{})).join(" ");await this.vectorStore.addDocuments([new K({pageContent:a,metadata:{example:e}})])}async selectExamples(e){let t=this.inputKeys??Object.keys(e),a=D(t.reduce((i,o)=>({...i,[o]:e[o]}),{})).join(" "),s=(await this.vectorStore.similaritySearch(a,this.k)).map(i=>i.metadata);return this.exampleKeys?s.map(i=>this.exampleKeys.reduce((o,p)=>({...o,[p]:i[p]}),{})):s}static async fromExamples(e,t,a,r={}){let s=r.inputKeys??null,i=e.map(p=>D(s?s.reduce((X,q)=>({...X,[q]:p[q]}),{}):p).join(" ")),o=await a.fromTexts(i,e,t,r);return new j({vectorStore:o,k:r.k??4,exampleKeys:r.exampleKeys,inputKeys:r.inputKeys})}};F();L();v();x();var M=class{serialize(){return{_type:this.constructor.name,...JSON.parse(JSON.stringify(this))}}},U=class extends E{constructor(e){super(),Object.defineProperty(this,"messages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.messages=e}toString(){return JSON.stringify(this.messages)}toChatMessages(){return this.messages}},$=class extends M{constructor(e){super(),Object.defineProperty(this,"variableName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.variableName=e}get inputVariables(){return[this.variableName]}formatMessages(e){return Promise.resolve(e[this.variableName])}},g=class extends M{constructor(e){super(),Object.defineProperty(this,"prompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.prompt=e}get inputVariables(){return this.prompt.inputVariables}async formatMessages(e){return[await this.format(e)]}},z=class extends d{constructor(e){super(e)}async format(e){return(await this.formatPromptValue(e)).toString()}async formatPromptValue(e){let t=await this.formatMessages(e);return new U(t)}},C=class extends g{async format(e){return new T(await this.prompt.format(e),this.role)}constructor(e,t){super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=t}static fromTemplate(e,t){return new this(l.fromTemplate(e),t)}},R=class extends g{async format(e){return new h(await this.prompt.format(e))}constructor(e){super(e)}static fromTemplate(e){return new this(l.fromTemplate(e))}},G=class extends g{async format(e){return new V(await this.prompt.format(e))}constructor(e){super(e)}static fromTemplate(e){return new this(l.fromTemplate(e))}},J=class extends g{async format(e){return new O(await this.prompt.format(e))}constructor(e){super(e)}static fromTemplate(e){return new this(l.fromTemplate(e))}},u=class extends z{constructor(e){if(super(e),Object.defineProperty(this,"promptMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.assign(this,e),this.validateTemplate){let t=new Set;for(let i of this.promptMessages)for(let o of i.inputVariables)t.add(o);let a=new Set(this.partialVariables?this.inputVariables.concat(Object.keys(this.partialVariables)):this.inputVariables),r=new Set([...a].filter(i=>!t.has(i)));if(r.size>0)throw new Error(`Input variables \`${[...r]}\` are not used in any of the prompt messages.`);let s=new Set([...t].filter(i=>!a.has(i)));if(s.size>0)throw new Error(`Input variables \`${[...s]}\` are used in prompt messages but not in the prompt template.`)}}_getPromptType(){return"chat"}async formatMessages(e){let t=await this.mergePartialAndUserVariables(e),a=[];for(let r of this.promptMessages){let s=r.inputVariables.reduce((o,p)=>{if(!(p in t))throw new Error(`Missing value for input variable \`${p}\``);return o[p]=t[p],o},{}),i=await r.formatMessages(s);a=a.concat(i)}return a}serialize(){if(this.outputParser!==void 0)throw new Error("ChatPromptTemplate cannot be serialized if outputParser is set");return{input_variables:this.inputVariables,prompt_messages:this.promptMessages.map(e=>e.serialize())}}async partial(e){let t={...this};return t.inputVariables=this.inputVariables.filter(a=>!(a in e)),t.partialVariables={...this.partialVariables??{},...e},new u(t)}static fromPromptMessages(e){let t=e.reduce((s,i)=>s.concat(i instanceof u?i.promptMessages:[i]),[]),a=e.reduce((s,i)=>i instanceof u?Object.assign(s,i.partialVariables):s,Object.create(null)),r=new Set;for(let s of t)for(let i of s.inputVariables)i in a||r.add(i);return new u({inputVariables:[...r],promptMessages:t,partialVariables:a})}};_();export{G as AIMessagePromptTemplate,z as BaseChatPromptTemplate,N as BaseExampleSelector,d as BasePromptTemplate,m as BaseStringPromptTemplate,C as ChatMessagePromptTemplate,u as ChatPromptTemplate,c as FewShotPromptTemplate,R as HumanMessagePromptTemplate,P as LengthBasedExampleSelector,$ as MessagesPlaceholder,l as PromptTemplate,j as SemanticSimilarityExampleSelector,S as StringPromptValue,J as SystemMessagePromptTemplate,y as checkValidTemplate,A as parseTemplate,b as renderTemplate};
//# sourceMappingURL=prompts.js.map